import{u as ge,k as ye,z as _e,L as ke,r as u,M as we,O as xe,c as v,w as s,V as be,o as d,a as o,f as c,S as B,G as J,T as F,d as E,U as V,b as _,n as N,F as $,W as T,C as m,X as Ce,H as L,A as h,e as K,i as D,g as Se,h as Ee,Y as W,Z as Ve}from"./app-ac939634.js";import{c as f}from"./clientApi-fa3ef3a0.js";import{m as Q,a as Te}from"./mdi-5e26928d.js";import{_ as Pe}from"./KpiContent-8c9a5fd6.js";import{_ as Ie}from"./EmployeeCard-0b989277.js";import{_ as Ae}from"./ConfirmDialog-416dbd6e.js";import{_ as Re}from"./SnackBar-05e30a7b.js";import{u as Me}from"./industry-832d230c.js";import"./vue-datepicker-fe3ef257.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const Le={class:"v-col-12 v-col-md-3 pb-0"},Ke=c("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Oe={key:0,class:"v-col-12 v-col-md-3 text-right pb-0"},Ue={class:"v-col-12 v-col-md-3 pb-0"},Ye=c("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),ze={key:1,class:"v-col-12 v-col-md-2 text-right pb-0"},Be=c("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"},"Employee Status",-1),Fe={class:"v-col-12"},Ne={class:"v-col-12 v-col-md-3 d-flex align-center"},$e={class:"v-col-12 v-col-md-2 d-flex flex-column"},De=c("div",{class:"text-caption text-grey"},"Reporting To",-1),We={class:"text-body-2"},je={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ge=c("div",{class:"text-caption text-grey"},"Business Unit",-1),He={class:"text-body-2"},Xe={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ze=c("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),qe={class:"text-body-2"},Je={class:"v-col-12 v-col-md-1 d-flex flex-column"},Qe=c("div",{class:"text-caption text-grey"},"Total KPI",-1),et={class:"text-body-2"},tt={key:0,class:"v-col-12 v-col-md-2 d-flex align-center"},ft={__name:"SingleEmployee",setup(at){const P=Me(),r=ge(),ee=ye(),te=_e(),ae=ke(),g=u({}),y=u(""),I=u("Active"),j=u(""),le=u([{title:"Active",color:"success"},{title:"Inactive",color:"error"}]),k=u([]),se=async()=>{P.industries.length==0?P.getIndustries(r.authToken).then(()=>{k.value=P.industries}):k.value=P.industries},G=u([]),oe=async()=>{await f(r.authToken).get("/api/fetch/measures/non-paginated").then(e=>{G.value=e.data}).catch(e=>{})},A=u([]),H=u([]),X=u(new Date().getFullYear()),ie=e=>{X.value=e,ne(e)},ne=async e=>{await f(r.authToken).get("/api/dashboard/my-kpi/"+a.value.id+"/"+e).then(t=>{t.data.result==null?a.value={...a.value,reviews:[]}:a.value={...a.value,reviews:[t.data.result]}}).catch(t=>{})},ue=async()=>{await f(r.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{k.value&&k.value.length>0&&e.data&&e.data.length>0&&k.value.map((t,l)=>{A.value[l]=t,A.value[l].kpis=[];let n=0,p=0;e.data.map((M,lt)=>{t.id==M.industry_id?(A.value[l].kpis[n]=M,n++):M.type=="ecd"&&(H.value[p]=M,p++)})})})},ce=e=>{let t=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((l,n)=>{t+=l.weightage}),t},w=u(""),O=u(!1),re=()=>{var l,n;let e=(n=(l=a.value)==null?void 0:l.reviews[0])==null?void 0:n.id;O.value=!0;let t={reviewID:e,state:w.value,title:y.value,profile_id:r.authProfile.id};f(r.authToken).post("/api/hr-change/state",t).then(p=>{g.value={status:!0,type:"success",text:p.data.message},x()}).catch(p=>{console.log("getEmployee",p)})},a=u({}),x=async()=>{await f(r.authToken).get("/api/hr/employee/ecode/"+ae.params.ecode).then(e=>{var t,l,n,p;a.value=e.data,e.data.reviews[0].type=="regular"?(y.value="Mid Year",w.value="midyear",((l=(t=e.data)==null?void 0:t.reviews[0])==null?void 0:l.state)=="midyear"&&(y.value="Year End",w.value="yearend")):(y.value="First Review",w.value="first_review",((p=(n=e.data)==null?void 0:n.reviews[0])==null?void 0:p.state)=="first_review"&&(y.value="Final Review",w.value="final_review")),O.value=!1,I.value=e.data.status,C.value=e.data.slave_ecode}).catch(e=>{console.log("getEmployee",e)})},U=we(()=>ee.filteredSetting(a.value.company_id));r.authToken&&(x(),se(),ue(),oe());const de=e=>{j.value=e.title,i.value={dialog:!0,title:"Confirm Status Update",text:"Please confirm that you want to update the status of "+a.value.display_name+" into "+e.title+".",btnColor:e.title=="Active"?"success":"error",btnTitle:"Confirm"}},ve=async()=>{let e={profile_id:r.authProfile.id,ecode:a.value.ecode,status:j.value};i.value={...i.value,loading:!0},await f(r.authToken).post("/api/hr/employee/status/update",e).then(t=>{x().then(()=>{i.value={...i.value,loading:!1,dialog:!1},g.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{console.log("getEmployee",t),i.value={...i.value,loading:!1},g.value={status:!0,type:"error",text:"Error while updating employee"}})},b=u(""),C=u(""),S=u(!1),Y=u([]),z=u({}),pe=async e=>{S.value=!0,await f(r.authToken).get("/api/hr/search/employee?&filter[search]="+e).then(t=>{S.value=!1,C.value?z.value=t.data:b.value&&(Y.value=t.data)}).catch(t=>{S.value=!1,console.log("getEmployee",t)})},Z=async(e,t)=>{let l={profile_id:r.authProfile.id,slave_ecode:t?"":e.ecode,ecode:a.value.ecode};i.value={...i.value,loading:!0},C.value=e==null?void 0:e.ecode,await f(r.authToken).post("/api/employee/secondary-manager/update",l).then(n=>{x().then(()=>{i.value={...i.value,loading:!1,dialog:!1},g.value={status:!0,type:"success",text:n.data.message}})}).catch(n=>{i.value={...i.value,loading:!1},g.value={status:!0,type:"error",text:"Error while updating employee"}})},me=e=>{a.value=e,I.value=e.status,te.push({name:"SingleEmployee",params:{ecode:e.ecode}}).catch(t=>{})};xe(b,(e,t)=>{e&&e!=t&&e.length>3&&pe(b.value)});const R=u({data:{},loading:!1}),q=()=>{i.value={dialog:!0,title:"Confirm to Open KPI",text:"Please confirm that you want to open the KPI for "+a.value.display_name+".",btnColor:"secondary",btnTitle:"Confirm"}},he=async()=>{i.value={...i.value,loading:!0};let e={profile_id:r.authProfile.id,name:r.authProfile.display_name,ecode:a.value.ecode,year:X.value};await f(r.authToken).post("/api/hr/employee/reopen",e).then(t=>{i.value={...i.value,loading:!1,dialog:!1},R.value.loading=!0,x().then(()=>{R.value.loading=!1,g.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{i.value={...i.value,loading:!1},g.value={status:!0,type:"error",text:"Error while updating employee"}})},i=u(),fe=e=>{i.value.title=="Confirm Status Update"?ve():i.value.title=="Confirm to Open KPI"&&he()};return(e,t)=>(d(),v(be,{class:"pb-16"},{default:s(()=>[o(D,{class:"mt-5 justify-space-between"},{default:s(()=>[c("div",Le,[o(B,null,{activator:s(({props:l})=>[o(J,F(l,{modelValue:b.value,"onUpdate:modelValue":t[0]||(t[0]=n=>b.value=n),loading:S.value,variant:"outlined",density:"compact",class:"bg-white",label:"Search Employee","hide-details":"","append-inner-icon":E(Q)}),null,16,["modelValue","loading","append-inner-icon"])]),default:s(()=>[Y.value.length>0?(d(),v(V,{key:0,density:"compact",style:{"max-height":"300px"}},{default:s(()=>[(d(!0),_($,null,N(Y.value,(l,n)=>(d(),v(T,{key:n,onClick:()=>me(l)},{default:s(()=>[o(W,null,{default:s(()=>[m(h(l.display_name+" - "+l.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(d(),v(V,{key:1,density:"compact"},{default:s(()=>[o(T,null,{default:s(()=>[m(" No results found ")]),_:1})]),_:1}))]),_:1}),Ke]),o(Ce),a.value.status=="Active"&&a.value.reviews&&a.value.reviews.length>0&&a.value.reviews[0].status=="submitted"?(d(),_("div",Oe,[o(L,{color:"secondary",loading:O.value,onClick:re},{default:s(()=>[m("Change to "+h(y.value),1)]),_:1},8,["loading"])])):K("",!0),c("div",Ue,[o(B,null,{activator:s(({props:l})=>[o(J,F(l,{modelValue:C.value,"onUpdate:modelValue":t[1]||(t[1]=n=>C.value=n),loading:S.value,variant:"outlined",density:"compact",class:"bg-white",label:"Secondary Manager","hide-details":"","onClick:clear":t[2]||(t[2]=n=>Z(e.item,"clear")),clearable:"","append-inner-icon":E(Q)}),null,16,["modelValue","loading","append-inner-icon"])]),default:s(()=>[z.value.length>0?(d(),v(V,{key:0,density:"compact",style:{"max-height":"300px"}},{default:s(()=>[(d(!0),_($,null,N(z.value,(l,n)=>(d(),v(T,{key:n,onClick:()=>Z(l)},{default:s(()=>[o(W,null,{default:s(()=>[m(h(l.display_name+" - "+l.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(d(),v(V,{key:1,density:"compact"},{default:s(()=>[o(T,null,{default:s(()=>[m(" No results found ")]),_:1})]),_:1}))]),_:1}),Ye]),["hr_admin","app_admin","hrbp"].includes(E(r).authProfile.role)?(d(),_("div",ze,[c("div",null,[o(B,null,{activator:s(({props:l})=>[o(L,F(l,{color:`${I.value=="Active"?"success":"error"}`,width:"120"}),{default:s(()=>[m(h(I.value),1)]),_:2},1040,["color"])]),default:s(()=>[o(V,{density:"compact"},{default:s(()=>[(d(!0),_($,null,N(le.value,(l,n)=>(d(),v(T,{key:n,onClick:()=>de(l)},{default:s(()=>[o(W,null,{default:s(()=>[o(Ve,{size:"16",color:l.color,icon:E(Te)},null,8,["color","icon"]),m(" "+h(l.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),Be])):K("",!0)]),_:1}),o(D,null,{default:s(()=>[c("div",Fe,[o(Se,{class:"elevation-0"},{default:s(()=>[o(Ee,null,{default:s(()=>[o(D,null,{default:s(()=>[c("div",Ne,[o(Ie,{profile:a.value},null,8,["profile"])]),c("div",$e,[De,c("div",We,h(a.value.managed_by&&a.value.managed_by.display_name?a.value.managed_by.display_name:""),1)]),c("div",je,[Ge,c("div",He,h(a.value&&a.value.company?a.value.company.title:""),1)]),c("div",Xe,[Ze,c("div",qe,h(U.value.year),1)]),c("div",Je,[Qe,c("div",et,h(ce(a.value))+"/100",1)]),["hr_admin","app_admin","hrbp"].includes(E(r).authProfile.role)?(d(),_("div",tt,[a.value.status=="Active"&&a.value.reviews&&(a.value.reviews.length>0&&(a.value.reviews[0].status=="closed"||a.value.reviews[0].status=="locked"||a.value.reviews[0].status=="submitted")||a.value.reviews.length==0&&(U.value.status=="closed"||U.value.status=="locked"))?(d(),v(L,{key:0,loading:R.value.loading,onClick:q,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:s(()=>[m("Reopen")]),_:1},8,["loading"])):a.value.status=="Active"&&a.value.reviews.length==0&&a.value.is_regular==0?(d(),v(L,{key:1,loading:R.value.loading,onClick:q,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:s(()=>[m("Open")]),_:1},8,["loading"])):K("",!0)])):K("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),o(Pe,{"selected-employee":a.value,"measures-list":G.value,"industry-list":A.value,"ecd-list":H.value,onErrorcheck:e.errorCheck,onYearchange:ie,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list","onErrorcheck"]),o(Ae,{options:i.value,onConfirm:fe},null,8,["options"]),o(Re,{options:g.value},null,8,["options"])]),_:1}))}};export{ft as default};
