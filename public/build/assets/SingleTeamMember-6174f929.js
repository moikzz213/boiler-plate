import{k as ne,x as re,r as n,u as ue,l as ce,O as de,A as ve,c as N,w as c,V as me,o as L,a as r,f as i,P as pe,L as fe,v as T,n as f,g as O,h as j,i as U,t as _,d as _e,e as he,N as ge}from"./app-bd93c558.js";import{_ as ye}from"./KpiContent-7a8f0953.js";import{_ as we}from"./EmployeeCard-050cd511.js";import{c as p}from"./clientApi-94de2a45.js";import{u as be}from"./industry-50bea1f4.js";import{_ as xe}from"./SnackBar-257cab0c.js";import"./mdi-5e26928d.js";import"./vue-datepicker-48281def.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const ke={class:"v-col-12 v-col-md-3"},Se={class:"v-col-12 v-col-md-3 my-auto text-right"},Te={href:"https://growth.gagroup.net/#!/module/4235/446",target:"_blank"},Ve=i("br",null,null,-1),Pe=i("small",{class:"text-caption mr-4"},"Growth Academy",-1),Ce={class:"v-col-12"},De={class:"v-col-12 v-col-md-3 d-flex align-center"},Re={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ie=i("div",{class:"text-caption text-grey"}," Reporting To ",-1),Ee={class:"text-body-2"},Me={class:"v-col-12 v-col-md-2 d-flex flex-column"},Be=i("div",{class:"text-caption text-grey"}," Business Unit ",-1),Ke={class:"text-body-2"},Ae={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ne=i("div",{class:"text-caption text-grey"}," KPI's Target Year ",-1),Le={class:"text-body-2"},Oe={class:"v-col-12 v-col-md-1 d-flex flex-column"},je=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),Ue={class:"text-body-2"},We={class:"v-col-12 v-col-md-2 d-flex align-center"},ze={class:"pa-3 mt-3 d-flex justify-end"},st={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(Fe){var A;const W=ne(),z=re(),h=n(!1),C=n(""),D=n(z.params.id),l=ue(),F=ce(),w=be(),g=n({}),Y=(A=l==null?void 0:l.authProfile)==null?void 0:A.display_name,u=n([]),y=n(D.value),t=n({}),$=()=>{t.value=y.value,W.push({name:"SingleTeamMember",params:{id:y.value.ecode}}).catch(e=>{})},R=n(0),G=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,o)=>{a+=s.weightage}),R.value=a,a},m=n([]),q=async()=>{w.industries.length==0?w.getIndustries(l.authToken).then(()=>{m.value=w.industries}):m.value=w.industries},b=n([]),V=n([]),H=async()=>{await p(l.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{m.value&&m.value.length>0&&e.data&&e.data.length>0&&m.value.map((a,s)=>{b.value[s]=a,b.value[s].kpis=[];let o=0,d=0;e.data.map((S,Ye)=>{a.id==S.industry_id?(b.value[s].kpis[o]=S,o++):S.type=="ecd"&&(V.value[d]=S,d++)})})})},J=async()=>{await p(l.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+l.authProfile.ecode).then(e=>{m.value&&m.value.length>0&&e.data&&e.data.length>0&&m.value.map((a,s)=>{let o=0;e.data.map(d=>{a.id==d.industry_id?a.kpis.unshift(d):d.type=="ecd"&&(V.value[o]=d,o++)})})})},Q=()=>{h.value=!1,x.value=!1,P.value=!1},I=n(""),X=e=>{I.value=e},x=n(!1),P=n(!1),Z=()=>{x.value=!0;let e=!1,a="inprogress",s=t.value.reviews[0].id;if(!s)return g.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.reviews[0].type=="regular"&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?a="inreview":a="submitted":((t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(a="submitted"),t.value.reviews[0].state=="yearend"&&(e=!0,h.value=!0,C.value="The Final PMS rating of "+t.value.first_name+" for the year "+t.value.reviews[0].year+" is: "+I.value)),e||E(s,a)},ee=()=>{E(t.value.reviews[0].id,"submitted"),h.value=!1},E=(e,a)=>{let s={reviewID:e,newStatus:a,user_ecode:l.authProfile.ecode,employee_ecode:y.value,allowedDays:t.value.reviews[0].type=="regular"?v.value.employee_review_allowed_days:v.value.probation_kpi_setting,closingDateSetting:t.value.reviews[0].type=="regular"?v.value.annual_kpi_setting_end:v.value.probation_kpi_setting,closingDateMid:t.value.reviews[0].type=="regular"?v.value.mid_year_review_end:v.value.probation_first_review_end,closingDateFinal:t.value.reviews[0].type=="regular"?v.value.end_year_review_end:v.value.probation_final_review_end};p(l.authToken).post("/api/manager/employee-kpi/submit",s).then(o=>{g.value={status:!0,type:"success",text:o.data.message};let d=[];d=o.data.profile.slave_ecode,u.value=o.data.profile.teams,u.value=[...u.value,...d],l.setProfile(o.data.profile).then(()=>{k(),setTimeout(()=>{x.value=!1,P.value=!0},2e3)})}).catch(o=>{})},M=n(!1),te=e=>{M.value=e.hasError},ae=e=>{let a={id:e.id,user_ecode:l.authProfile.ecode};p(l.authToken).post("/api/delete/employee-kpi-year",a).then(s=>{let o=[];o=s.data.profile.slave_ecode,u.value=s.data.profile.teams,u.value=[...u.value,...o],l.setProfile(s.data.profile).then(()=>{k(),g.value={status:!0,type:"success",text:s.data.message}})}).catch(s=>{})},se=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:l.authProfile.ecode};p(l.authToken).post("/api/create/employee-kpi-year",a).then(s=>{g.value={status:!0,type:"success",text:s.data.message};let o=[];o=s.data.profile.slave_ecode,u.value=s.data.profile.teams,u.value=[...u.value,...o],l.setProfile(s.data.profile).then(()=>{k()})}).catch(s=>{})},le=e=>{B(e)},B=async e=>{await p(l.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},K=n([]),ie=async()=>{await p(l.authToken).get("/api/fetch/measures/non-paginated").then(e=>{K.value=e.data}).catch(e=>{})},k=()=>{t.value={};let e=u.value.filter(a=>a.username==D.value);t.value=Object.assign({},e[0]),B(2023)},v=de(()=>F.filteredSetting(t.value.company_id)),oe=async()=>{await p(l.authToken).get("/api/fetch/team-members/"+l.authProfile.ecode).then(e=>{e.data&&e.data.length>0&&(u.value=e.data.filter(a=>a.reviews.length>0))}).catch(e=>{})};return ve(()=>{l.authToken&&oe().then(()=>{k(),q().then(()=>{H().then(()=>{J().then(()=>{ie()})})})})}),(e,a)=>(L(),N(me,{class:"pb-16",style:{"max-width":"95%"}},{default:c(()=>[r(U,{class:"my-5"},{default:c(()=>[i("div",ke,[r(pe,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>y.value=s),$],items:u.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),r(fe),i("div",Se,[i("a",Te,[r(T,{size:"small",color:"secondary"},{default:c(()=>[f("Watch Tutorial")]),_:1})]),f(),Ve,Pe]),i("div",Ce,[r(O,{class:"mb-3 elevation-0"},{default:c(()=>[r(j,null,{default:c(()=>[r(U,null,{default:c(()=>[i("div",De,[r(we,{profile:t.value},null,8,["profile"])]),i("div",Re,[Ie,i("div",Ee,_(_e(Y)),1)]),i("div",Me,[Be,i("div",Ke,_(t.value.company&&t.value.company.title),1)]),i("div",Ae,[Ne,i("div",Le,_(v.value.year),1)]),i("div",Oe,[je,i("div",Ue,_(G(t.value))+"/100 ",1)]),i("div",We,[!M.value&&R.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(L(),N(T,{key:0,size:"large",onClick:Z,loading:x.value,block:"",disabled:P.value,color:"secondary",class:"text-capitalize rounded-lg text-md-caption text-lg-body-2"},{default:c(()=>[f(_(t.value.reviews[0].type=="regular"&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading","disabled"])):he("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),r(ye,{"selected-employee":t.value,"measures-list":K.value,"industry-list":b.value,"ecd-list":V.value,onSavedResponse:se,onErrorcheck:te,onYearchange:le,onRemoveKPI:ae,onRating:X,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list"]),r(ge,{modelValue:h.value,"onUpdate:modelValue":a[1]||(a[1]=s=>h.value=s),width:"450"},{default:c(()=>[r(O,{class:"rounded-lg"},{default:c(()=>[r(j,null,{default:c(()=>[f(_(C.value)+". Do you want to Submit? ",1)]),_:1}),i("div",ze,[r(T,{color:"primary",variant:"text",class:"mr-2",onClick:Q},{default:c(()=>[f("Close")]),_:1}),r(T,{color:"secondary",onClick:ee},{default:c(()=>[f("Confirm")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),r(xe,{options:g.value},null,8,["options"])]),_:1}))}};export{st as default};
