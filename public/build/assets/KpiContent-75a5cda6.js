import{r as c,N as E,o as r,b as I,a as s,w as u,g as Y,i as $,f as t,Y as G,A as y,c as g,M as fe,G as U,O as $e,P as Ie,I as ne,Z as Re,$ as _e,a0 as ie,H as x,C as _,e as f,J as he,F as le,U as Te,S as Fe,z as De,K as Se,u as Pe,k as Oe,L as Q,d as j,X as K,B as we,h as te,q as ke,n as ce,v as Ve}from"./app-b640eeb9.js";import{b as je,c as me,d as Ke,e as pe,f as ge,g as ye}from"./mdi-7fd0807e.js";import{e as Ue}from"./vue-datepicker-40a1c65d.js";import{_ as be}from"./SnackBar-c10c6c7b.js";const Ee={class:"v-col-12"},Be={class:"v-col-12 v-col-md-6 py-0"},Ae={class:"v-col-12 v-col-md-6 py-0"},Le={class:"v-col-12 v-col-md-3 py-0 mb-2"},Me={class:"v-col-12 v-col-md-3 py-0 mb-2"},We={class:"v-col-12 v-col-md-3 py-0 mb-2"},ze={class:"v-col-12 v-col-md-3 py-0 mb-2"},Ne={class:"v-col-12 py-0"},Ye={class:"v-col-12 pt-0"},Ge={class:"v-col-12 py-0"},He={class:"v-col-12 py-0"},qe={class:"v-col-12 py-0"},Je={class:"v-col-12 py-0 hidden hide",hidden:""},Xe={class:"v-col-12 py-0"},Ze={key:0,class:"v-col-12 d-flex justify-end"},Qe={key:0,class:"v-col-12 v-col-md-4 bg-grey-lighten-4"},et=t("div",{class:"v-col-12 px-1"},y("Review"),-1),tt={class:"v-col-12 py-0 px-1 mt-3 mb-3 text-body-2"},lt={class:"v-col-12 v-col-md-12 py-0 px-1"},at={class:"v-col-12 v-col-md-6 py-0 px-1"},st={class:"v-col-12 v-col-md-6 py-0 px-1 mb-3"},it={class:"v-col-12 v-col-md-12 py-0 px-1"},nt={class:"v-col-12 py-0 px-1 mt-3 mb-3 text-body-2"},ut={class:"v-col-12 v-col-md-12 py-0 px-1"},ot={class:"v-col-12 py-0 px-1"},dt={class:"v-col-12 py-0 px-1 text-center mb-3"},rt={class:"v-col-12 d-flex justify-end"},vt={__name:"KpiDialog",props:{kpiOptions:{type:Object,default:null},submitButton:{type:Boolean,default:!0},industryList:{type:Object,default:null},remainWeightage:{type:Number,default:70},measuresList:{type:Object,default:null},finalReview:{type:Boolean,default:!1}},emits:["savedResponse"],setup(V,{emit:z}){const k=V,N=c({}),C=c(["min","max"]),q=c([]),b=c(["5%","10%","15%","20%","25%","30%"]),M=c(null),e=c({}),i=c({measures:null}),F=c([]),X=c([]),B=c(""),D=c(""),p=c(""),h=c(""),m=c(""),R=c(""),A=c(!1),S=c(!0),P=c([]),ae=()=>{A.value=!0,e.value.data=i.value,e.value.industryTitle=R.value,setTimeout(()=>{A.value=!1,e.value.dialog=!1,z("savedResponse",e.value)},1200),B.value=k.kpiOptions.data.industry},w=()=>{e.value.dialog=!1,(e.value.action=="edit"||e.value.action=="review")&&(B.value=k.kpiOptions.data.industry,D.value=k.kpiOptions.data.title)},se=()=>{k.finalReview.isFinal?e.value.state="final":e.value.state="mid",ae()},Z=d=>{h.value="",p.value="";let a=i.value.target/2;d.data.achievement_midyear&&(i.value.target_type=="max"?p.value=(a-d.data.achievement_midyear).toFixed(2):p.value=(d.data.achievement_midyear-a).toFixed(2),i.value.measures!="%"?h.value=i.value.target-d.data.achievement_midyear:h.value=i.value.target)},O=d=>{let a=d.data.target;d.data.revised_annual_target&&(a=d.data.revised_annual_target);let l=0;d.data.achievement_yearend&&(i.value.target_type=="max"?l=parseFloat(a/d.data.achievement_yearend).toFixed(2):l=parseFloat(d.data.achievement_yearend/a).toFixed(2),l>=100?m.value="Extremely Excellent":l>=90&&l<=99.99?m.value="Excellent":l>=70&&l<=89.99?m.value="Very Good":l>=50&&l<=69.99?m.value="Good":l>=35&&l<=49.99?m.value="Satisfactory":m.value="Poor")};E(()=>k.kpiOptions,d=>{A.value=!1,X.value=k.industryList,i.value=Object.assign({},d.data),e.value=Object.assign({},d),Z(d),O(d),e.value.action=="edit"||e.value.action=="review"||e.value.action=="readonly"?(B.value=d.data.industry,D.value=d.data.title,M.value=d.data.weightage,S.value=!1):(B.value=null,D.value=null,M.value=null,S.value=!0)}),E(()=>i.value.achievement_midyear,d=>{h.value="",p.value="";let a=i.value.target/2,l="";i.value.measures=="%"&&(l="%"),d&&(i.value.target_type=="max"?p.value=(a-d).toFixed(2)+l:p.value=(d-a).toFixed(2)+l,i.value.measures!="%"?h.value=i.value.target-d:h.value=i.value.target)}),E(()=>i.value.achievement_yearend,d=>{m.value="";let a=i.value.target;i.value.revised_annual_target&&(a=i.value.revised_annual_target);let l=0;d&&(i.value.target_type=="max"?l=(a/d*100).toFixed(2):l=(d/a*100).toFixed(2),l>=100?m.value="Extremely Excellent":l>=90&&l<=99.99?m.value="Excellent":l>=70&&l<=89.99?m.value="Very Good":l>=50&&l<=69.99?m.value="Good":l>=35&&l<=49.99?m.value="Satisfactory":m.value="Poor")}),E(()=>B.value,d=>{F.value=[],q.value=k.measuresList,e.value.action=="add"?(S.value=!0,i.value={},D.value=null,d&&(P.value.push("industry"),T(),R.value=d.title,X.value.map(a=>{a.id==d.id&&(F.value=a.kpis)}))):(P.value.push("industry"),S.value=!1)}),E(()=>D.value,d=>{if(e.value.action=="add"){i.value={};let a=F.value.filter(l=>l.id==d);a&&a.length>0&&(i.value=a[0],S.value=!1,P.value.push("kpi"),T())}else P.value.push("kpi")}),E(()=>i.value.weightage,d=>{let a=!1;if(!isNaN(d)||d==null||d==null)a=!1;else if(e.value.action=="add")parseInt(d)>k.remainWeightage?(a=!1,N.value={status:!0,type:"error",text:"Weightage is over the limit!"}):a=!0;else{let l=parseInt(k.remainWeightage)+parseInt(M.value)-parseInt(d);parseInt(l)<0?(a=!1,N.value={status:!0,type:"error",text:"Weightage is over the limit!"}):M.value>parseInt(d)||parseInt(l)>=0?a=!0:a=!1}a?(P.value.push("weightage"),T()):W("weightage")});const T=()=>{P.value=P.value.filter((d,a)=>P.value.indexOf(d)===a)},W=d=>{const a=P.value.indexOf(d);a>-1&&P.value.splice(a,1)};return E(()=>i.value.target,d=>{d?(P.value.push("target"),T()):W("target")}),E(()=>i.value.measures,d=>{d?(P.value.push("measures"),T()):W("measures")}),E(()=>i.value.target_type,d=>{P.value.push("target_type"),T(),d=="min"?i.value.evaluation_pattern='<span style="color:green">Positive Ranking = Exceeding the Target</span> <br/><span style="color:red">Negative Ranking = Falling short of the Target</span>':d=="max"?i.value.evaluation_pattern='<span style="color:green">Positive Ranking = Falling short of the Target</span> <br/><span style="color:red">Negative Ranking = Exceeding the Target</span>':(W("target_type"),i.value.evaluation_pattern="")}),(d,a)=>(r(),I(le,null,[s(he,{modelValue:e.value.dialog,"onUpdate:modelValue":a[22]||(a[22]=l=>e.value.dialog=l),width:"100%","max-width":`${e.value.is_review==!0?"1240":"900"} `,persistent:""},{default:u(()=>[s(Y,{class:"rounded-lg"},{default:u(()=>[s($,{class:"ma-0 pa-0"},{default:u(()=>[t("div",{class:G(`v-col-12 ${e.value.is_review==!0?"v-col-md-8":""} px-4`)},[s($,null,{default:u(()=>[t("div",Ee,y(e.value.title),1),t("div",Be,[e.value.action=="add"?(r(),g(fe,{key:0,modelValue:B.value,"onUpdate:modelValue":a[0]||(a[0]=l=>B.value=l),items:V.industryList,"item-title":"title","item-value":"title","hide-details":"","return-object":"",variant:"outlined",density:"compact",label:"Select Industry*"},null,8,["modelValue","items"])):(r(),g(U,{key:1,modelValue:B.value,"onUpdate:modelValue":a[1]||(a[1]=l=>B.value=l),"hide-details":"",variant:"outlined",density:"compact",label:"Select Industry*",class:"bg-grey-lighten-4 mb-3"},null,8,["modelValue"]))]),t("div",Ae,[e.value.action=="add"?(r(),g(fe,{key:0,modelValue:D.value,"onUpdate:modelValue":a[2]||(a[2]=l=>D.value=l),items:F.value,"item-title":"title","item-value":"id",variant:"outlined",density:"compact",label:"Select KPI*"},{selection:u(({props:l,item:L})=>[t("span",$e(Ie(l)),y((L==null?void 0:L.title.substring(0,35))+"..."),17)]),_:1},8,["modelValue","items"])):(r(),g(U,{key:1,modelValue:D.value,"onUpdate:modelValue":a[3]||(a[3]=l=>D.value=l),"hide-details":"",variant:"outlined",density:"compact",label:"Select KPI*",class:"bg-grey-lighten-4 mb-3"},null,8,["modelValue"]))]),t("div",Le,[!S.value&&!e.value.is_review?(r(),g(ne,{key:0,modelValue:i.value.target_type,"onUpdate:modelValue":a[4]||(a[4]=l=>i.value.target_type=l),items:C.value,label:"Target Type*",variant:"outlined",density:"compact"},null,8,["modelValue","items"])):(r(),g(U,{key:1,modelValue:i.value.target_type,"onUpdate:modelValue":a[5]||(a[5]=l=>i.value.target_type=l),"hide-details":"",variant:"outlined",density:"compact",label:"Target Type*",class:"bg-grey-lighten-4 mb-3"},null,8,["modelValue"]))]),t("div",Me,[s(U,{readonly:S.value||e.value.is_review,class:G(`${S.value||e.value.is_review?"bg-grey-lighten-4 mb-3":""}`),"hide-details":"",type:"number",modelValue:i.value.target,"onUpdate:modelValue":a[6]||(a[6]=l=>i.value.target=l),label:"Target*",variant:"outlined",density:"compact","persistent-hint":""},null,8,["readonly","class","modelValue"])]),t("div",We,[!S.value&&!e.value.is_review?(r(),g(ne,{key:0,modelValue:i.value.measures,"onUpdate:modelValue":a[7]||(a[7]=l=>i.value.measures=l),items:q.value,label:"Measures*",variant:"outlined",density:"compact"},null,8,["modelValue","items"])):(r(),g(U,{key:1,modelValue:i.value.measures,"onUpdate:modelValue":a[8]||(a[8]=l=>i.value.measures=l),"hide-details":"",variant:"outlined",density:"compact",label:"Measures*",class:"bg-grey-lighten-4 mb-3"},null,8,["modelValue"]))]),t("div",ze,[!S.value&&!e.value.is_review?(r(),g(ne,{key:0,modelValue:i.value.weightage,"onUpdate:modelValue":a[9]||(a[9]=l=>i.value.weightage=l),items:b.value,label:"KPI's Weightage (%)*",variant:"outlined",density:"compact"},null,8,["modelValue","items"])):(r(),g(U,{key:1,modelValue:i.value.weightage,"onUpdate:modelValue":a[10]||(a[10]=l=>i.value.weightage=l),"hide-details":"",variant:"outlined",density:"compact",label:"KPI's Weightage (%)*",class:"bg-grey-lighten-4 mb-3"},null,8,["modelValue"]))]),t("div",Ne,[s($,{class:"mx-0 mb-3"},{default:u(()=>[s(Re,{class:"pa-3 bg-grey-lighten-4",style:{border:"1px solid #b1b1b1","border-radius":"5px","min-height":"70px"},innerHTML:i.value.evaluation_pattern},null,8,["innerHTML"])]),_:1})]),t("div",Ye,[s(_e,{class:"mx-auto"})]),t("div",Ge,[s(ie,{"auto-grow":"",modelValue:i.value.definition,"onUpdate:modelValue":a[11]||(a[11]=l=>i.value.definition=l),readonly:S.value||e.value.action=="edit"||e.value.is_review,label:"KPI Definition*",variant:"outlined",rows:"2"},null,8,["modelValue","readonly"])]),t("div",He,[s(ie,{"auto-grow":"",modelValue:i.value.formula,"onUpdate:modelValue":a[12]||(a[12]=l=>i.value.formula=l),class:"bg-grey-lighten-4 mb-4","hide-details":"",readonly:"",label:"Calculation Formula*",variant:"outlined",rows:"2"},null,8,["modelValue"])]),t("div",qe,[s(ie,{"auto-grow":"",modelValue:i.value.subordinate_measures,"onUpdate:modelValue":a[13]||(a[13]=l=>i.value.subordinate_measures=l),class:"bg-grey-lighten-4 mb-4","hide-details":"",readonly:"",label:"Subordinate Measures*",variant:"outlined",rows:"2"},null,8,["modelValue"])]),t("div",Je,[s(ie,{"auto-grow":"",modelValue:i.value.calculation_example,"onUpdate:modelValue":a[14]||(a[14]=l=>i.value.calculation_example=l),class:"bg-grey-lighten-4 mb-4","hide-details":"",readonly:"",label:"KPI Calculation Example*",variant:"outlined",rows:"2"},null,8,["modelValue"])]),t("div",Xe,[s(_e,{class:"mx-auto"})]),e.value.is_review?f("",!0):(r(),I("div",Ze,[s(x,{color:"primary",variant:"text",onClick:w},{default:u(()=>[_("Cancel")]),_:1}),s(x,{loading:A.value,disabled:P.value.length<6,color:"secondary",class:"ml-2 px-8",onClick:ae},{default:u(()=>[_("save")]),_:1},8,["loading","disabled"])]))]),_:1})],2),e.value.is_review?(r(),I("div",Qe,[V.finalReview.isFinal?f("",!0):(r(),g($,{key:0,class:"px-3"},{default:u(()=>[et,t("div",tt,y(e.value.is_regular?"Mid-year Achievement":"First Review Achievement"),1),t("div",lt,[s(U,{type:"number",readonly:V.finalReview.isFinal||e.value.action=="readonly","hide-details":"",class:G(`${V.finalReview.isFinal||e.value.action=="readonly"?"bg-grey-lighten-2":""} mb-4`),modelValue:i.value.achievement_midyear,"onUpdate:modelValue":a[15]||(a[15]=l=>i.value.achievement_midyear=l),label:"Achievement*",variant:"outlined",density:"compact","persistent-hint":""},null,8,["readonly","class","modelValue"])]),t("div",at,[s(U,{readonly:"",modelValue:p.value,"onUpdate:modelValue":a[16]||(a[16]=l=>p.value=l),label:"Target Variation",class:G(`${p.value&&p.value>=0?"text-success":"text-red"} bg-grey-lighten-2`),"hide-details":"",variant:"outlined",density:"compact","persistent-hint":""},null,8,["modelValue","class"])]),t("div",st,[s(U,{readonly:"",modelValue:h.value,"onUpdate:modelValue":a[17]||(a[17]=l=>h.value=l),label:"Remainder Annual Target",class:"bg-grey-lighten-2","hide-details":"",variant:"outlined",density:"compact","persistent-hint":""},null,8,["modelValue"])]),t("div",it,[s(U,{type:"number",readonly:V.finalReview.isFinal||e.value.action=="readonly","hide-details":"",class:G(`${V.finalReview.isFinal||e.value.action=="readonly"?"bg-grey-lighten-2":""} mb-4`),modelValue:i.value.revised_annual_target,"onUpdate:modelValue":a[18]||(a[18]=l=>i.value.revised_annual_target=l),label:"Revised Annual Target",variant:"outlined",density:"compact","persistent-hint":""},null,8,["readonly","class","modelValue"])])]),_:1})),V.finalReview.isFinal||e.value.action=="readonly"?(r(),g($,{key:1,class:"px-3"},{default:u(()=>[t("div",nt,y(e.value.is_regular?"Year-End Achievement":"Final Review Achievement"),1),t("div",ut,[e.value.action!="readonly"?(r(),g(U,{key:0,type:"number",readonly:"","hide-details":"",class:"bg-grey-lighten-2 mb-4",modelValue:i.value.revised_annual_target,"onUpdate:modelValue":a[19]||(a[19]=l=>i.value.revised_annual_target=l),label:"Revised Annual Target",variant:"outlined",density:"compact","persistent-hint":""},null,8,["modelValue"])):f("",!0)]),t("div",ot,[s(U,{modelValue:i.value.achievement_yearend,"onUpdate:modelValue":a[20]||(a[20]=l=>i.value.achievement_yearend=l),readonly:e.value.action=="readonly","hide-details":"",class:G(`${e.value.action=="readonly"?"bg-grey-lighten-2":""} mb-4`),label:"Total Achievement*",variant:"outlined",density:"compact","persistent-hint":""},null,8,["modelValue","readonly","class"])]),t("div",dt,[t("h3",{class:G(`${m.value&&m.value=="Poor"?"text-red":"text-success"}`)},y(m.value),3)])]),_:1})):f("",!0),s($,null,{default:u(()=>[t("div",rt,[s(x,{class:"bg-grey-lighten-2 text-primary",variant:"text",onClick:a[21]||(a[21]=l=>e.value.dialog=!1)},{default:u(()=>[_("Cancel")]),_:1}),e.value.action!="readonly"&&k.submitButton&&V.finalReview.saveBtn?(r(),g(x,{key:0,loading:A.value,color:"secondary",class:"ml-2",onClick:se},{default:u(()=>[_("Save")]),_:1},8,["loading"])):f("",!0)])]),_:1})])):f("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","max-width"]),s(be,{options:N.value},null,8,["options"])],64))}},ct={class:"v-col-12"},mt={class:"v-col-12 py-0"},pt={class:"v-col-12 py-0"},gt={class:"v-col-12 py-0"},yt={key:0,class:"v-col-12 d-flex justify-end"},ft={key:0,class:"v-col-12 v-col-md-4 bg-grey-lighten-4"},_t=t("div",{class:"v-col-12 px-1"},y("Review"),-1),ht={class:"v-col-12 py-0 px-1 mt-3 mb-3 text-body-2"},bt={class:"v-col-12 v-col-md-12 py-0 px-1"},xt={class:"v-col-12 py-0 px-1 mt-3 mb-3 text-body-2"},wt={class:"v-col-12 py-0 px-1"},kt={class:"v-col-12 d-flex justify-end"},Vt={__name:"EcdDialog",props:{ecdOptions:{type:Object,default:null},ecdList:{type:Object,default:null},remainWeightage:{type:Number,default:30},submitButton:{type:Boolean,default:!0},finalReview:{type:Boolean,default:!1}},emits:["savedResponse"],setup(V,{emit:z}){const k=V,N=c(null),C=c({}),q=c([]),b=c({}),M=c(null),e=c(null),i=c(!1),F=c(["5%","10%","15%","20%"]),X=()=>{i.value=!0,C.value.weightage=e.value,C.value.ecd_type=k.ecdOptions.ecdType,b.value.data=C.value,setTimeout(()=>{i.value=!1,b.value.dialog=!1,z("savedResponse",b.value)},1200)};E(()=>k.ecdOptions,h=>{C.value=Object.assign({},h.data),q.value=k.ecdList.filter(m=>m.ecd_type==h.ecdType||m.ecd_type=="both"),b.value=Object.assign({},h),b.value.action=="edit"||b.value.action=="review"||b.value.action=="readonly"?(N.value=h.data.weightage,M.value=h.data.title,e.value=h.data.weightage):(N.value=null,M.value=null,e.value=null)});const B=()=>{k.finalReview.isFinal?b.value.state="final":b.value.state="mid",X()};E(()=>M.value,h=>{b.value.action=="add"&&(C.value={},C.value=h)});const D=c({}),p=c(!1);return E(()=>e.value,h=>{if(!isNaN(h)||h==null||h==null)p.value=!1;else if(b.value.action=="add")parseInt(h)>k.remainWeightage?(p.value=!1,D.value={status:!0,type:"error",text:"Weightage is over the limit!"}):p.value=!0;else{let m=parseInt(k.remainWeightage)+parseInt(N.value)-parseInt(h);parseInt(m)<0?(p.value=!1,D.value={status:!0,type:"error",text:"Weightage is over the limit!"}):N.value>parseInt(h)||parseInt(m)>=0?p.value=!0:p.value=!1}}),(h,m)=>(r(),I(le,null,[s(he,{modelValue:b.value.dialog,"onUpdate:modelValue":m[6]||(m[6]=R=>b.value.dialog=R),width:"100%","max-width":`${V.ecdOptions.is_review==!0?"1240":"700"} `,persistent:""},{default:u(()=>[s(Y,{class:"rounded-lg",minHeight:"300"},{default:u(()=>[s($,{class:"ma-0 pa-0"},{default:u(()=>[t("div",{class:G(`v-col-12 ${V.ecdOptions.is_review==!0?"v-col-md-8":""} px-4`)},[s($,null,{default:u(()=>[t("div",ct,y(b.value.title),1),t("div",mt,[s(fe,{modelValue:M.value,"onUpdate:modelValue":m[0]||(m[0]=R=>M.value=R),items:q.value,"item-title":"title","item-value":"id","return-object":"",variant:"outlined",density:"compact",label:"Select *"},{item:u(({props:R,item:A})=>{var S;return[s(Te,Fe({style:`${A.raw.profile_ecode?"background-color:#f1f1f1":""} `},R,{title:(S=A==null?void 0:A.raw)==null?void 0:S.title}),null,16,["style","title"])]}),_:1},8,["modelValue","items"])]),t("div",pt,[s(ne,{modelValue:e.value,"onUpdate:modelValue":m[1]||(m[1]=R=>e.value=R),items:F.value,label:"Development Weightage (%)*",variant:"outlined",density:"compact"},null,8,["modelValue","items"])]),t("div",gt,[s(_e,{class:"mx-auto"})]),b.value.is_review?f("",!0):(r(),I("div",yt,[s(x,{color:"primary",variant:"text",onClick:m[2]||(m[2]=R=>b.value.dialog=!1)},{default:u(()=>[_("Cancel")]),_:1}),s(x,{disabled:!p.value,loading:i.value,color:"secondary",class:"ml-2 px-8",onClick:X},{default:u(()=>[_("save")]),_:1},8,["disabled","loading"])]))]),_:1})],2),b.value.is_review?(r(),I("div",ft,[V.finalReview.isFinal?f("",!0):(r(),g($,{key:0,class:"px-3"},{default:u(()=>[_t,t("div",ht,y(b.value.is_regular?"Mid-Year Achievement":"First Review Achievement"),1),t("div",bt,[s(U,{modelValue:C.value.mid_year_achievement,"onUpdate:modelValue":m[3]||(m[3]=R=>C.value.mid_year_achievement=R),label:"Achievement*",variant:"outlined",density:"compact","persistent-hint":""},null,8,["modelValue"])])]),_:1})),V.finalReview.isFinal?f("",!0):(r(),g($,{key:1,class:"px-3"},{default:u(()=>[t("div",xt,y(b.value.is_regular?"Year-End Achievement":"Final Review Achievement"),1),t("div",wt,[s(U,{modelValue:C.value.year_end_achievement,"onUpdate:modelValue":m[4]||(m[4]=R=>C.value.year_end_achievement=R),label:"Achievement*",variant:"outlined",density:"compact","persistent-hint":""},null,8,["modelValue"])])]),_:1})),V.finalReview.isFinal?(r(),g($,{key:2,class:"pb-4"},{default:u(()=>[t("div",kt,[s(x,{class:"bg-grey-lighten-2 text-primary",variant:"text",onClick:m[5]||(m[5]=R=>b.value.dialog=!1)},{default:u(()=>[_("Cancel")]),_:1}),b.value.action!="readonly"&&k.submitButton&&V.finalReview.saveBtn?(r(),g(x,{key:0,loading:i.value,color:"secondary",class:"ml-2",onClick:B},{default:u(()=>[_("Submit")]),_:1},8,["loading"])):f("",!0)])]),_:1})):f("",!0)])):f("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue","max-width"]),s(be,{options:D.value},null,8,["options"])],64))}};const Ct={class:"v-col-12 v-col-md-2"},$t={class:"v-col-12 v-col-md-2"},It={class:"v-col-12"},Rt={class:"d-flex align-center px-3"},Tt={key:1,class:"ml-auto text-h6"},Ft={key:1,class:"text-uppercase text-primary"},Dt={key:2,class:"text-uppercase text-center",style:{display:"block !important",width:"100%"}},St={key:3,class:"text-uppercase text-center"},Pt={key:4,class:"ml-auto text-body-1"},Ot={class:"v-col-12 pb-0"},jt={class:"v-col-12"},Kt={class:"v-col-12 pb-0 d-flex justify-space-between"},Ut=t("div",{class:"text-grey text-caption"},"KPI",-1),Et={class:"text-primary text-body-1"},Bt={class:"v-col-3"},At=t("div",{class:"text-grey text-caption"},"Industry",-1),Lt={class:"text-primary text-body-1"},Mt={class:"v-col-3"},Wt={class:"text-grey text-caption"},zt={class:"text-primary text-body-1"},Nt={class:"v-col-3"},Yt=t("div",{class:"text-grey text-caption"},"Measure",-1),Gt={class:"text-primary text-body-1"},Ht={class:"v-col-3"},qt={class:"text-grey text-caption"},Jt={class:"text-primary text-body-1"},Xt={key:1,class:"v-col-12 pb-0 text-center"},Zt={class:"v-col-6 pb-0"},Qt={key:1},el={class:"v-col-6 pb-0"},tl={key:1},ll={class:"v-col-6 pb-0"},al={class:"v-col-12 pb-0 d-flex justify-space-between"},sl=t("div",{class:"text-grey text-caption"},"Training",-1),il={class:"text-primary text-body-1"},nl={class:"v-col-3"},ul={class:"text-grey text-caption"},ol={class:"text-primary text-body-1"},dl={class:"v-col-3"},rl=t("div",{class:"text-grey text-caption"},"Type",-1),vl={class:"text-primary text-body-1"},cl={class:"v-col-6 pb-0"},ml={class:"v-col-12 pb-0 d-flex justify-space-between"},pl=t("div",{class:"text-grey text-caption"},"Training",-1),gl={class:"text-primary text-body-1"},yl={class:"v-col-3"},fl={class:"text-grey text-caption"},_l={class:"text-primary text-body-1"},hl={class:"v-col-3"},bl=t("div",{class:"text-grey text-caption"},"Type",-1),xl={class:"text-primary text-body-1"},wl={class:"pb-3 text-grey"},kl={class:"text-primary"},Vl={class:"d-flex justify-end mt-5"},Tl={__name:"KpiContent",props:{selectedEmployee:{type:Object,default:null},industryList:{type:Object,default:null},ecdList:{type:Object,default:null},submitButton:{type:Boolean,default:!0},measuresList:{type:Object,default:null}},emits:["yearchange","savedResponse","errorcheck"],setup(V,{emit:z}){const k=V,N=De(),C=Se(),q=Pe(),b=c({}),M=Oe(),e=c(k.selectedEmployee),i=Q(()=>!e.value||e.value&&(!e.value.reviews||e.value.reviews.length==0)?[]:e.value.reviews[0].key_review.filter(n=>n.type=="kpi")),F=Q(()=>!e.value||e.value&&(!e.value.reviews||e.value.reviews.length==0)?[]:e.value.reviews[0].key_review.filter(n=>n.type=="ecd")),X=Q(()=>!e.value||e.value&&(!e.value.reviews||e.value.reviews.length==0)?[]:e.value.reviews[0].key_review.filter(n=>n.type=="ecd"&&n.ecd_type=="tech")),B=Q(()=>!e.value||e.value&&(!e.value.reviews||e.value.reviews.length==0)?[]:e.value.reviews[0].key_review.filter(n=>n.type=="ecd"&&n.ecd_type=="soft")),D=c(!1);E(()=>k.selectedEmployee,n=>{D.value=!0,n.length>0?e.value=Object.assign({},n[0]):e.value=Object.assign({},n),C.name=="SingleTeamMember"&&R()});const p=Q(()=>M.filteredSetting(e.value.company_id)),h=c(!1),m=c(!1),R=()=>{if(e.value&&e.value.reviews&&e.value.reviews.length>0&&(e.value.reviews[0].state=="midyear"||e.value.reviews[0].state=="first_review")){let n=e.value.reviews[0].key_review.filter(v=>v.achievement_midyear==null),o=!1;n&&n.length>0&&(o=!0),z("errorcheck",{hasError:o})}else if(e.value&&e.value.reviews&&e.value.reviews.length>0&&(e.value.reviews[0].state=="yearend"||e.value.reviews[0].state=="final_review")){let n=e.value.reviews[0].key_review.filter(v=>v.achievement_yearend==null),o=!1;n&&n.length>0&&(o=!0),z("errorcheck",{hasError:o})}else S().then(()=>{z("errorcheck",{hasError:m.value})})},A=c(""),S=async()=>{let n="",o=!1;w.value=="kpi"&&i.value.length<4&&H("kpi")==0?(n="Invalid: Minimum 4 KPI's needed, kindly update the weightage.",o=!0):(n="Invalid: Should have 1 each, technical and soft skill, kindly update the weightage.",o=P(o)),h.value=o,o&&(A.value=n),ae()},P=n=>{if(H("ecd")==0&&F.value&&F.value.length>0&&F.value.length<2)n=!0;else if(F.value.length>1){let o=[];F.value.map((v,ee)=>{o.push(v.ecd_type)}),o=[...new Set(o)],H("ecd")==0&&o.length<2&&(n=!0)}return n},ae=async()=>{let n=!1;i.value.length<4&&H("kpi")==0&&(n=!0),n=P(n),m.value=n},w=c("kpi"),se=n=>{w.value=n,C.name=="SingleTeamMember"&&S()},Z=c(new Date),O=Q(()=>{if(e.value&&e.value.reviews&&e.value.reviews.length>0)return!!(q.authRole.includes("manager")&&C.name=="SingleTeamMember"&&e.value.reviews[0].state=="setting"&&(e.value.reviews[0].status=="open"||e.value.reviews[0].status=="inprogress"||e.value.reviews[0].status=="inreview"));if(C.name=="SingleTeamMember"&&p&&p.state=="setting"&&(p.status=="open"||p.status=="inprogress"))return!0;if(e.value&&e.value.is_regular==0&&C.name=="SingleTeamMember"){let n=new Date(e.value.doj);if(n.setDate(n.getDate()+parseInt(p.probation_kpi_setting)),n>=Z.value)return!0}return!1}),T=c({saveBtn:!1,isFinal:!1}),W=Q(()=>{if(T.value={saveBtn:!1,isFinal:!1},C.name=="SingleTeamMember"&&p&&p.state=="yearend"&&(T.value={saveBtn:!1,isFinal:!0}),C.name=="SingleTeamMember"&&p&&(p.state=="midyear"||p.state=="yearend")&&(p.status=="open"||p.status=="inprogress"))return T.value={saveBtn:!0,isFinal:!0},!0;if(e.value&&e.value.is_regular==0&&C.name=="SingleTeamMember"){if(T.value={saveBtn:!1,isFinal:!1},p){let n=new Date(e.value.doj),o=new Date(e.value.doj);if(n.setDate(n.getDate()+parseInt(p.probation_first_review_start)),o.setDate(o.getDate()+parseInt(p.probation_first_review_end)),e.value.reviews[0].state=="first_review"&&(e.value.reviews[0].status=="open"||e.value.reviews[0].status=="inprogress"))return T.value={saveBtn:!0,isFinal:!1},!0;if(n<=Z.value&&o>=Z.value)return T.value={saveBtn:!0,isFinal:!1},!0;let v=new Date(e.value.doj),ee=new Date(e.value.doj);if(v.setDate(v.getDate()+parseInt(p.probation_final_review_start)),ee.setDate(ee.getDate()+parseInt(p.probation_final_review_end)),e.value.reviews[0].state=="final_review"&&(e.value.reviews[0].status=="open"||e.value.reviews[0].status=="inprogress"))return T.value={saveBtn:!0,isFinal:!0},!0;if(v<=Z.value&&ee>=Z.value)return T.value={saveBtn:!0,isFinal:!0},!0}}else if(e.value&&e.value.reviews&&e.value.reviews.length>0)return e.value.reviews[0].status=="open"||e.value.reviews[0].status=="inprogress"?T.value.saveBtn=!0:e.value.reviews[0].state=="yearend"&&(T.value.isFinal=!0),!!(q.authRole.includes("manager")&&C.name=="SingleTeamMember"&&(e.value.reviews[0].state=="midyear"||e.value.reviews[0].state=="yearend"));return!1}),d=c(new Date().getFullYear()),a=()=>{const n=N.resolve({path:"/print/kpi/"+d.value+"/"+e.value.username,params:{year:d.value},query:{print:1}});window.open(n.href,"_blank")};E(d,async(n,o)=>{z("yearchange",n)});const l=c({title:"",dialog:!1,data:{},type:"",action:"",is_review:!1}),L=c({title:"",dialog:!1,data:{},type:"",action:"",is_review:!1}),ue=async(n,o)=>{if(H(w.value)<=0)b.value={status:!0,type:"error",text:"Denied: You've reached the weightage limit."};else if(n=="kpi")i.value.length>5?b.value={status:!0,type:"error",text:"Denied: Max of 6 KPI only. Minimum is 4 KPI"}:l.value={title:"Add KPI ",data:{},dialog:!0,type:n,action:"add",is_review:!1};else{let v="Identify Technical Skill Development";o=="soft"&&(v="Identify Behavioral Program"),L.value={...L.value,title:v,data:{},dialog:!0,type:n,ecdType:o,action:"add",is_review:!1}}},oe=async(n,o="kpi",v)=>{o=="kpi"?l.value={...l.value,title:"Edit KPI ",data:Object.assign({},n),dialog:!0,type:o,action:"edit",is_review:!1}:L.value={...L.value,title:"Edit ECD ",data:Object.assign({},n),dialog:!0,type:o,action:"edit",ecdType:v,is_review:!1}},de=async(n,o="kpi")=>{o=="kpi"&&(l.value={...l.value,title:o.toUpperCase(),data:Object.assign({},n),dialog:!0,type:o,action:"readonly",is_review:!0,state:e.value.reviews[0].state,is_regular:e.value.is_regular}),o=="ecd"&&(L.value={...L.value,title:o.toUpperCase(),data:Object.assign({},n),dialog:!0,type:o,action:"readonly",is_review:!0,is_regular:e.value.is_regular})},re=async(n,o="kpi")=>{o=="kpi"&&(l.value={...l.value,title:o.toUpperCase(),data:Object.assign({},n),dialog:!0,type:o,action:"review",is_review:!0,state:e.value.reviews[0].state,is_regular:e.value.is_regular}),o=="ecd"&&(L.value={...L.value,title:o.toUpperCase(),data:Object.assign({},n),dialog:!0,type:o,action:"review",is_review:!0,is_regular:e.value.is_regular})},xe=n=>{let o={reviewID:e.value.reviews[0].id,data:n,industryTitle:n.industryTitle,state:n.state};R(),z("savedResponse",o)},J=c({data:{},dialog:!1,loading:!1}),ve=async n=>{J.value={...J.value,data:Object.assign({},n),dialog:!0}},Ce=async()=>{let n=J.value.data;J.value.dialog=!1,z("removeKPI",n)},H=n=>{let o=70;return e.value&&e.value.is_regular==0&&(o=100),n=="ecd"?(o=30,F.value&&F.value.length>0&&F.value.map((v,ee)=>{o-=v.weightage})):i.value&&i.value.length>0&&i.value.map((v,ee)=>{o-=v.weightage}),o};return(n,o)=>(r(),g($,null,{default:u(()=>[t("div",Ct,[s(j(Ue),{modelValue:d.value,"onUpdate:modelValue":o[0]||(o[0]=v=>d.value=v),"year-picker":"",class:"pms-date-picker"},null,8,["modelValue"])]),t("div",$t,[e.value&&e.value.reviews&&e.value.reviews.length>0?(r(),g(x,{key:0,onClick:a,color:"white",class:"text-capitalize text-md-caption text-lg-body-2"},{default:u(()=>[_("View/Print"),s(K,{icon:j(je),class:"ml-1"},null,8,["icon"])]),_:1})):f("",!0)]),t("div",It,[t("div",Rt,[s(Y,{onClick:o[1]||(o[1]=()=>se("kpi")),flat:"",class:G(`
          ${w.value=="kpi"?"":"bg-grey-darken-3 text-white"}
          d-flex align-center justify-center px-3 text-center pms-tab`)},{default:u(()=>[_(" KPI "+y(i.value?"("+i.value.length+")":"(0)"),1)]),_:1},8,["class"]),e.value&&e.value.is_regular?(r(),g(Y,{key:0,onClick:o[2]||(o[2]=()=>se("ecd")),flat:"",class:G(`${w.value=="ecd"?"":"bg-grey-darken-3 text-white"} d-flex align-center justify-center px-3 text-caption text-center pms-tab`)},{default:u(()=>[_(" Employee Capability Development "+y("("+F.value.length+")"),1)]),_:1},8,["class"])):f("",!0),e.value&&e.value.reviews&&e.value.reviews.length>0&&e.value.reviews[0].state=="yearend"&&e.value.reviews[0].status=="submitted"?(r(),I("div",Tt,"Rate: Coming Soon")):f("",!0)]),s(Y,{flat:""},{default:u(()=>[s(we,{class:"px-5 py-5 d-flex align-center"},{default:u(()=>[O.value&&w.value=="kpi"?(r(),g(x,{key:0,onClick:o[3]||(o[3]=()=>ue(w.value)),density:"compact",size:"35",class:"rounded-xl elevation-2 mr-2"},{default:u(()=>[s(K,{size:"small",icon:j(me)},null,8,["icon"])]),_:1})):f("",!0),w.value=="kpi"&&i.value&&i.value.length>0||w.value=="ecd"&&F.value&&F.value.length>0?(r(),I("div",Ft,y(w.value=="ecd"?"Employee Capability Development":w.value)+" List ",1)):O.value?(r(),I("div",St,y(w.value=="ecd"?"Employee Capability Development":e.value.is_regular?w.value:"Probation KPI")+" List ",1)):(r(),I("div",Dt,y(w.value)+" not set ",1)),O.value&&H(w.value)>0?(r(),I("div",Pt,"Remaining "+y(w.value.toUpperCase())+" weightage: "+y(H(w.value))+"%",1)):f("",!0)]),_:1}),s(te,{class:"px-5 pb-10"},{default:u(()=>[h.value?(r(),g($,{key:0,class:"mb-2"},{default:u(()=>[t("div",Ot,[s(Y,{class:"rounded-lg",style:{border:"2px solid red"}},{default:u(()=>[s(te,null,{default:u(()=>[s($,null,{default:u(()=>[t("div",jt,[s(K,{size:"large",color:"red",class:"mr-1",icon:j(Ke)},null,8,["icon"]),_(" "+y(A.value),1)])]),_:1})]),_:1})]),_:1})])]),_:1})):f("",!0),ke(s($,{class:"mt-3"},{default:u(()=>[i.value&&i.value.length>0?(r(!0),I(le,{key:0},ce(i.value,v=>(r(),I("div",{class:"v-col-12 pb-0",key:v.id},[s(Y,{class:"rounded-lg content-card"},{default:u(()=>[s(te,null,{default:u(()=>[s($,null,{default:u(()=>[t("div",Kt,[t("div",null,[Ut,t("div",Et,y(v.title),1)]),t("div",null,[!W.value&&D.value?(r(),g(x,{key:0,onClick:()=>de(v,"kpi"),density:"compact",color:"primary",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_(" View"),s(K,{size:"small",icon:j(pe),class:"ml-1"},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0),W.value?(r(),g(x,{key:1,color:"secondary",class:"rounded-xl px-5",size:"small",onClick:()=>re(v,"kpi")},{default:u(()=>[_("review")]),_:2},1032,["onClick"])):f("",!0),O.value?(r(),g(x,{key:2,onClick:()=>oe(v,"kpi"),density:"compact",color:"teal",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_("Edit"),s(K,{size:"small",class:"ml-1",icon:j(ge)},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0),O.value?(r(),g(x,{key:3,onClick:()=>ve(v),density:"compact",color:"error",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_("Delete"),s(K,{size:"small",class:"ml-1",icon:j(ye)},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0)])]),t("div",Bt,[At,t("div",Lt,y(v.industry),1)]),t("div",Mt,[t("div",Wt,"Target ("+y(v.target_type)+")",1),t("div",zt,y(v.target),1)]),t("div",Nt,[Yt,t("div",Gt,y(v.measures),1)]),t("div",Ht,[t("div",qt,y("KPI's Weightage(%)"),1),t("div",Jt,y(v.weightage)+"%",1)])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)):(r(),I("div",Xt," No records yet. "))]),_:1},512),[[Ve,w.value=="kpi"]]),ke(s($,{class:"mt-n3"},{default:u(()=>[t("div",Zt,[O.value?(r(),g(x,{key:0,onClick:o[4]||(o[4]=()=>ue(w.value,"tech")),density:"compact",size:"35",class:"rounded-xl elevation-2 mr-2"},{default:u(()=>[s(K,{size:"small",icon:j(me)},null,8,["icon"])]),_:1})):f("",!0),O.value?(r(),I("span",Qt,"Technical Skill")):f("",!0)]),t("div",el,[O.value?(r(),g(x,{key:0,onClick:o[5]||(o[5]=()=>ue(w.value,"soft")),density:"compact",size:"35",class:"rounded-xl elevation-2 mr-2"},{default:u(()=>[s(K,{size:"small",icon:j(me)},null,8,["icon"])]),_:1})):f("",!0),_(),O.value?(r(),I("span",tl,"Soft Skill")):f("",!0)]),t("div",ll,[s($,null,{default:u(()=>[(r(!0),I(le,null,ce(X.value,v=>(r(),I("div",{class:"v-col-12 pb-0",key:v.id},[s(Y,{class:"rounded-lg"},{default:u(()=>[s(te,null,{default:u(()=>[s($,null,{default:u(()=>[t("div",al,[t("div",null,[sl,t("div",il,y(v.title),1)]),t("div",null,[!W.value&&D.value?(r(),g(x,{key:0,onClick:()=>de(v,"ecd"),density:"compact",color:"primary",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_(" View"),s(K,{size:"small",icon:j(pe),class:"ml-1"},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0),W.value?(r(),g(x,{key:1,color:"secondary",class:"rounded-xl px-5",size:"small",onClick:()=>re(v,"ecd")},{default:u(()=>[_("review")]),_:2},1032,["onClick"])):f("",!0),O.value?(r(),g(x,{key:2,onClick:()=>oe(v,"ecd","tech"),density:"compact",color:"teal",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_("Edit"),s(K,{size:"small",class:"ml-1",icon:j(ge)},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0),O.value?(r(),g(x,{key:3,onClick:()=>ve(v),density:"compact",color:"error",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_("Delete"),s(K,{size:"small",class:"ml-1",icon:j(ye)},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0)])]),t("div",nl,[t("div",ul,y("KPI's Weightage(%)"),1),t("div",ol,y(v.weightage),1)]),t("div",dl,[rl,t("div",vl,y(v.ecd_type),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})]),t("div",cl,[s($,null,{default:u(()=>[(r(!0),I(le,null,ce(B.value,v=>(r(),I("div",{class:"v-col-12 pb-0",key:v.id},[s(Y,{class:"rounded-lg"},{default:u(()=>[s(te,null,{default:u(()=>[s($,null,{default:u(()=>[t("div",ml,[t("div",null,[pl,t("div",gl,y(v.title),1)]),t("div",null,[!W.value&&D.value?(r(),g(x,{key:0,onClick:()=>de(v,"ecd"),density:"compact",color:"primary",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_(" View"),s(K,{size:"small",icon:j(pe),class:"ml-1"},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0),W.value?(r(),g(x,{key:1,color:"secondary",class:"rounded-xl px-5",size:"small",onClick:()=>re(v,"ecd")},{default:u(()=>[_("review")]),_:2},1032,["onClick"])):f("",!0),O.value?(r(),g(x,{key:2,onClick:()=>oe(v,"ecd","soft"),density:"compact",color:"teal",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_("Edit"),s(K,{size:"small",class:"ml-1",icon:j(ge)},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0),O.value?(r(),g(x,{key:3,onClick:()=>ve(v),density:"compact",color:"error",class:"rounded-xl elevation-2 ml-1 text-caption"},{default:u(()=>[_("Delete"),s(K,{size:"small",class:"ml-1",icon:j(ye)},null,8,["icon"])]),_:2},1032,["onClick"])):f("",!0)])]),t("div",yl,[t("div",fl,y("KPI's Weightage(%)"),1),t("div",_l,y(v.weightage),1)]),t("div",hl,[bl,t("div",xl,y(v.ecd_type),1)])]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))]),_:1})])]),_:1},512),[[Ve,w.value=="ecd"]])]),_:1})]),_:1})]),s(he,{modelValue:J.value.dialog,"onUpdate:modelValue":o[7]||(o[7]=v=>J.value.dialog=v),width:"100%","max-width":"480",persistent:""},{default:u(()=>[s(Y,{class:"rounded-lg"},{default:u(()=>[s(we,{class:"pa-3"},{default:u(()=>[_("Confirm Remove")]),_:1}),s(te,{class:"px-3"},{default:u(()=>[t("div",wl,[_(" Please confirm that you want to remove "),t("span",kl,y("'"+J.value.data.title.substring(0,35)+"...'"),1)]),t("div",Vl,[s(x,{class:"bg-grey-lighten-2 text-primary",variant:"text",onClick:o[6]||(o[6]=v=>J.value.dialog=!1)},{default:u(()=>[_("Cancel")]),_:1}),s(x,{color:"primary",class:"ml-2",onClick:Ce},{default:u(()=>[_("Remove")]),_:1})])]),_:1})]),_:1})]),_:1},8,["modelValue"]),s(vt,{"final-review":T.value,"measures-list":V.measuresList,"kpi-options":l.value,"remain-weightage":H(w.value),"industry-list":V.industryList,"submit-button":k.submitButton,onSavedResponse:xe},null,8,["final-review","measures-list","kpi-options","remain-weightage","industry-list","submit-button"]),s(Vt,{"final-review":T.value,"ecd-options":L.value,"remain-weightage":H(w.value),"ecd-list":V.ecdList,"submit-button":k.submitButton,onSavedResponse:xe},null,8,["final-review","ecd-options","remain-weightage","ecd-list","submit-button"]),s(be,{options:b.value},null,8,["options"])]),_:1}))}};export{Tl as _};
