import{u as ye,l as _e,k as ke,x as xe,r as u,O as we,Q as J,c as v,w as s,V as be,o as d,a as o,f as c,U as F,s as ee,y as N,d as E,W as T,b as k,C as $,F as z,X as V,n as m,L as Ce,v as M,t as h,e as K,i as D,g as Se,h as Ee,Y as W,Z as Te}from"./app-07292aad.js";import{c as f}from"./clientApi-86b20a3c.js";import{m as te,a as Ve}from"./mdi-9c5e96e3.js";import{_ as Pe}from"./KpiContent-2bc5a110.js";import{_ as Ie}from"./EmployeeCard-df12d480.js";import{_ as Re}from"./ConfirmDialog-37afeba6.js";import{_ as Ae}from"./SnackBar-505cf931.js";import{u as Le}from"./industry-960b998d.js";import"./vue-datepicker-42153220.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const Me={class:"v-col-12 v-col-md-3 pb-0"},Ke=c("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Oe={key:0,class:"v-col-12 v-col-md-3 text-right pb-0"},Ue={class:"v-col-12 v-col-md-3 pb-0"},Ye=c("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Be={key:1,class:"v-col-12 v-col-md-2 text-right pb-0"},Fe=c("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"},"Employee Status",-1),Ne={class:"v-col-12"},$e={class:"v-col-12 v-col-md-3 d-flex align-center"},ze={class:"v-col-12 v-col-md-2 d-flex flex-column"},De=c("div",{class:"text-caption text-grey"},"Reporting To",-1),We={class:"text-body-2"},je={class:"v-col-12 v-col-md-2 d-flex flex-column"},Qe=c("div",{class:"text-caption text-grey"},"Business Unit",-1),Xe={class:"text-body-2"},Ze={class:"v-col-12 v-col-md-2 d-flex flex-column"},qe=c("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),Ge={class:"text-body-2"},He={class:"v-col-12 v-col-md-1 d-flex flex-column"},Je=c("div",{class:"text-caption text-grey"},"Total KPI",-1),et={class:"text-body-2"},tt={key:0,class:"v-col-12 v-col-md-2 d-flex align-center"},ft={__name:"SingleEmployee",setup(at){const P=Le(),r=ye(),ae=_e(),le=ke(),se=xe(),g=u({}),_=u(""),I=u("Active"),j=u(""),oe=u([{title:"Active",color:"success"},{title:"Inactive",color:"error"}]),x=u([]),ie=async()=>{P.industries.length==0?P.getIndustries(r.authToken).then(()=>{x.value=P.industries}):x.value=P.industries},Q=u([]),ne=async()=>{await f(r.authToken).get("/api/fetch/measures/non-paginated").then(e=>{Q.value=e.data}).catch(e=>{})},R=u([]),X=u([]),Z=u(new Date().getFullYear()),ue=e=>{Z.value=e,ce(e)},ce=async e=>{await f(r.authToken).get("/api/dashboard/my-kpi/"+a.value.id+"/"+e).then(t=>{t.data.result==null?a.value={...a.value,reviews:[]}:a.value={...a.value,reviews:[t.data.result]}}).catch(t=>{})},re=async()=>{await f(r.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{x.value&&x.value.length>0&&e.data&&e.data.length>0&&x.value.map((t,l)=>{R.value[l]=t,R.value[l].kpis=[];let n=0,p=0;e.data.map((L,lt)=>{t.id==L.industry_id?(R.value[l].kpis[n]=L,n++):L.type=="ecd"&&(X.value[p]=L,p++)})})})},de=e=>{let t=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((l,n)=>{t+=l.weightage}),t},w=u(""),O=u(!1),ve=()=>{var l,n;let e=(n=(l=a.value)==null?void 0:l.reviews[0])==null?void 0:n.id;O.value=!0;let t={reviewID:e,state:w.value,title:_.value,profile_id:r.authProfile.id};f(r.authToken).post("/api/hr-change/state",t).then(p=>{g.value={status:!0,type:"success",text:p.data.message},b()}).catch(p=>{console.log("getEmployee",p)})},a=u({}),b=async()=>{await f(r.authToken).get("/api/hr/employee/ecode/"+se.params.ecode).then(e=>{var t,l,n,p;a.value=e.data,e.data.reviews[0].type=="regular"?(_.value="Mid Year",w.value="midyear",((l=(t=e.data)==null?void 0:t.reviews[0])==null?void 0:l.state)=="midyear"&&(_.value="Year End",w.value="yearend")):(_.value="First Review",w.value="first_review",((p=(n=e.data)==null?void 0:n.reviews[0])==null?void 0:p.state)=="first_review"&&(_.value="Final Review",w.value="final_review")),O.value=!1,I.value=e.data.status,y.value=e.data.slave_ecode}).catch(e=>{console.log("getEmployee",e)})},U=we(()=>ae.filteredSetting(a.value.company_id));r.authToken&&(b(),ie(),re(),ne());const pe=e=>{j.value=e.title,i.value={dialog:!0,title:"Confirm Status Update",text:"Please confirm that you want to update the status of "+a.value.display_name+" into "+e.title+".",btnColor:e.title=="Active"?"success":"error",btnTitle:"Confirm"}},me=async()=>{let e={profile_id:r.authProfile.id,ecode:a.value.ecode,status:j.value};i.value={...i.value,loading:!0},await f(r.authToken).post("/api/hr/employee/status/update",e).then(t=>{b().then(()=>{i.value={...i.value,loading:!1,dialog:!1},g.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{console.log("getEmployee",t),i.value={...i.value,loading:!1},g.value={status:!0,type:"error",text:"Error while updating employee"}})},C=u(""),y=u(""),S=u(!1),Y=u([]),B=u({}),q=async e=>{S.value=!0,await f(r.authToken).get("/api/hr/search/employee?&filter[search]="+e).then(t=>{S.value=!1,y.value?B.value=t.data:C.value&&(Y.value=t.data)}).catch(t=>{S.value=!1,console.log("getEmployee",t)})},G=async(e,t)=>{let l={profile_id:r.authProfile.id,slave_ecode:t?"":e.ecode,ecode:a.value.ecode};i.value={...i.value,loading:!0},y.value=e==null?void 0:e.ecode,await f(r.authToken).post("/api/employee/secondary-manager/update",l).then(n=>{b().then(()=>{i.value={...i.value,loading:!1,dialog:!1},g.value={status:!0,type:"success",text:n.data.message}})}).catch(n=>{i.value={...i.value,loading:!1},g.value={status:!0,type:"error",text:"Error while updating employee"}})},he=e=>{a.value=e,I.value=e.status,le.push({name:"SingleEmployee",params:{ecode:e.ecode}}).catch(t=>{})};J(C,(e,t)=>{e&&e!=t&&e.length>3&&q(C.value)}),J(y,(e,t)=>{e&&e!=t&&e.length>3&&q(y.value)});const A=u({data:{},loading:!1}),H=()=>{i.value={dialog:!0,title:"Confirm to Open KPI",text:"Please confirm that you want to open the KPI for "+a.value.display_name+".",btnColor:"secondary",btnTitle:"Confirm"}},fe=async()=>{i.value={...i.value,loading:!0};let e={profile_id:r.authProfile.id,name:r.authProfile.display_name,ecode:a.value.ecode,year:Z.value};await f(r.authToken).post("/api/hr/employee/reopen",e).then(t=>{i.value={...i.value,loading:!1,dialog:!1},A.value.loading=!0,b().then(()=>{A.value.loading=!1,g.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{i.value={...i.value,loading:!1},g.value={status:!0,type:"error",text:"Error while updating employee"}})},i=u(),ge=e=>{i.value.title=="Confirm Status Update"?me():i.value.title=="Confirm to Open KPI"&&fe()};return(e,t)=>(d(),v(be,{class:"pb-16"},{default:s(()=>[o(D,{class:"mt-5 justify-space-between"},{default:s(()=>[c("div",Me,[o(F,null,{activator:s(({props:l})=>[o(ee,N(l,{modelValue:C.value,"onUpdate:modelValue":t[0]||(t[0]=n=>C.value=n),loading:S.value,variant:"outlined",density:"compact",class:"bg-white",label:"Search Employee","hide-details":"","append-inner-icon":E(te)}),null,16,["modelValue","loading","append-inner-icon"])]),default:s(()=>[Y.value.length>0?(d(),v(T,{key:0,density:"compact",style:{"max-height":"300px"}},{default:s(()=>[(d(!0),k(z,null,$(Y.value,(l,n)=>(d(),v(V,{key:n,onClick:()=>he(l)},{default:s(()=>[o(W,null,{default:s(()=>[m(h(l.display_name+" - "+l.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(d(),v(T,{key:1,density:"compact"},{default:s(()=>[o(V,null,{default:s(()=>[m(" No results found ")]),_:1})]),_:1}))]),_:1}),Ke]),o(Ce),a.value.status=="Active"&&a.value.reviews&&a.value.reviews.length>0&&a.value.reviews[0].status=="submitted"?(d(),k("div",Oe,[o(M,{color:"secondary",loading:O.value,onClick:ve},{default:s(()=>[m("Change to "+h(_.value),1)]),_:1},8,["loading"])])):K("",!0),c("div",Ue,[o(F,null,{activator:s(({props:l})=>[o(ee,N(l,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=n=>y.value=n),loading:S.value,variant:"outlined",density:"compact",class:"bg-white",label:"Secondary Manager","hide-details":"","onClick:clear":t[2]||(t[2]=n=>G(e.item,"clear")),clearable:"","append-inner-icon":E(te)}),null,16,["modelValue","loading","append-inner-icon"])]),default:s(()=>[B.value.length>0?(d(),v(T,{key:0,density:"compact",style:{"max-height":"300px"}},{default:s(()=>[(d(!0),k(z,null,$(B.value,(l,n)=>(d(),v(V,{key:n,onClick:()=>G(l)},{default:s(()=>[o(W,null,{default:s(()=>[m(h(l.display_name+" - "+l.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(d(),v(T,{key:1,density:"compact"},{default:s(()=>[o(V,null,{default:s(()=>[m(" No results found ")]),_:1})]),_:1}))]),_:1}),Ye]),["hr_admin","app_admin","hrbp"].includes(E(r).authProfile.role)?(d(),k("div",Be,[c("div",null,[o(F,null,{activator:s(({props:l})=>[o(M,N(l,{color:`${I.value=="Active"?"success":"error"}`,width:"120"}),{default:s(()=>[m(h(I.value),1)]),_:2},1040,["color"])]),default:s(()=>[o(T,{density:"compact"},{default:s(()=>[(d(!0),k(z,null,$(oe.value,(l,n)=>(d(),v(V,{key:n,onClick:()=>pe(l)},{default:s(()=>[o(W,null,{default:s(()=>[o(Te,{size:"16",color:l.color,icon:E(Ve)},null,8,["color","icon"]),m(" "+h(l.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),Fe])):K("",!0)]),_:1}),o(D,null,{default:s(()=>[c("div",Ne,[o(Se,{class:"elevation-0"},{default:s(()=>[o(Ee,null,{default:s(()=>[o(D,null,{default:s(()=>[c("div",$e,[o(Ie,{profile:a.value},null,8,["profile"])]),c("div",ze,[De,c("div",We,h(a.value.managed_by&&a.value.managed_by.display_name?a.value.managed_by.display_name:""),1)]),c("div",je,[Qe,c("div",Xe,h(a.value&&a.value.company?a.value.company.title:""),1)]),c("div",Ze,[qe,c("div",Ge,h(U.value.year),1)]),c("div",He,[Je,c("div",et,h(de(a.value))+"/100",1)]),["hr_admin","app_admin","hrbp"].includes(E(r).authProfile.role)?(d(),k("div",tt,[a.value.status=="Active"&&a.value.reviews&&(a.value.reviews.length>0&&(a.value.reviews[0].status=="closed"||a.value.reviews[0].status=="locked"||a.value.reviews[0].status=="submitted")||a.value.reviews.length==0&&(U.value.status=="closed"||U.value.status=="locked"))?(d(),v(M,{key:0,loading:A.value.loading,onClick:H,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:s(()=>[m("Reopen")]),_:1},8,["loading"])):a.value.status=="Active"&&a.value.reviews.length==0&&a.value.is_regular==0?(d(),v(M,{key:1,loading:A.value.loading,onClick:H,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:s(()=>[m("Open")]),_:1},8,["loading"])):K("",!0)])):K("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),o(Pe,{"selected-employee":a.value,"measures-list":Q.value,"industry-list":R.value,"ecd-list":X.value,onErrorcheck:e.errorCheck,onYearchange:ue,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list","onErrorcheck"]),o(Re,{options:i.value,onConfirm:ge},null,8,["options"]),o(Ae,{options:g.value},null,8,["options"])]),_:1}))}};export{ft as default};
