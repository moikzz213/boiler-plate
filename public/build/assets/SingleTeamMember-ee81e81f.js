import{z as ne,L as ue,r as n,u as re,k as ce,M as de,l as ve,c as N,w as c,V as me,o as A,a as r,f as o,N as pe,g as j,h as O,i as U,A as f,d as fe,H as V,C as S,e as ge,K as _e}from"./app-9fa1dba9.js";import{_ as he}from"./KpiContent-b539b289.js";import{_ as ye}from"./EmployeeCard-9bcb472e.js";import{c as m}from"./clientApi-d08a3813.js";import{u as we}from"./industry-b6bae5a0.js";import{_ as be}from"./SnackBar-87ab9c6b.js";import"./mdi-5e26928d.js";import"./vue-datepicker-11901abf.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const xe={class:"v-col-12 v-col-md-3"},ke={class:"v-col-12"},Se={class:"v-col-12 v-col-md-3 d-flex align-center"},Pe={class:"v-col-12 v-col-md-2 d-flex flex-column"},Te=o("div",{class:"text-caption text-grey"}," Reporting To ",-1),Ve={class:"text-body-2"},Ce={class:"v-col-12 v-col-md-2 d-flex flex-column"},De=o("div",{class:"text-caption text-grey"}," Business Unit ",-1),Re={class:"text-body-2"},Ie={class:"v-col-12 v-col-md-2 d-flex flex-column"},Me=o("div",{class:"text-caption text-grey"}," KPI's Target Year ",-1),Ee={class:"text-body-2"},Le={class:"v-col-12 v-col-md-1 d-flex flex-column"},Ke=o("div",{class:"text-caption text-grey"}," Total KPI ",-1),Be={class:"text-body-2"},Ne={class:"v-col-12 v-col-md-2 d-flex align-center"},Ae={class:"pa-3 mt-3 d-flex justify-end"},Xe={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(je){var B;const z=ne(),F=ue(),g=n(!1),C=n(""),D=n(F.params.id),l=re(),W=ce(),h=we(),_=n({}),Y=(B=l==null?void 0:l.authProfile)==null?void 0:B.display_name,u=n([]),y=n(D.value),t=n({}),$=()=>{t.value=y.value,z.push({name:"SingleTeamMember",params:{id:y.value.ecode}}).catch(e=>{})},R=n(0),H=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,i)=>{a+=s.weightage}),R.value=a,a},v=n([]),q=async()=>{h.industries.length==0?h.getIndustries(l.authToken).then(()=>{v.value=h.industries}):v.value=h.industries},w=n([]),P=n([]),G=async()=>{await m(l.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{v.value&&v.value.length>0&&e.data&&e.data.length>0&&v.value.map((a,s)=>{w.value[s]=a,w.value[s].kpis=[];let i=0,p=0;e.data.map((k,Oe)=>{a.id==k.industry_id?(w.value[s].kpis[i]=k,i++):k.type=="ecd"&&(P.value[p]=k,p++)})})})},J=async()=>{await m(l.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+l.authProfile.ecode).then(e=>{v.value&&v.value.length>0&&e.data&&e.data.length>0&&v.value.map((a,s)=>{let i=0;e.data.map(p=>{a.id==p.industry_id?a.kpis.unshift(p):p.type=="ecd"&&(P.value[i]=p,i++)})})})},Q=()=>{g.value=!1,b.value=!1,T.value=!1},I=n(""),X=e=>{I.value=e},b=n(!1),T=n(!1),Z=()=>{b.value=!0;let e=!1,a="inprogress",s=t.value.reviews[0].id;if(!s)return _.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.is_regular&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?a="inreview":a="submitted":((t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(a="submitted"),t.value.reviews[0].state=="yearend"&&(e=!0,g.value=!0,C.value="The Final PMS rating of "+t.value.first_name+" for the year "+t.value.reviews[0].year+" is: "+I.value)),e||M(s,a)},ee=()=>{M(t.value.reviews[0].id,"submitted"),g.value=!1},M=(e,a)=>{let s={reviewID:e,newStatus:a,user_ecode:l.authProfile.ecode,managerEmail:l.authProfile.email,managerName:l.authProfile.display_name,allowedDays:t.value.is_regular?d.value.employee_review_allowed_days:d.value.probation_kpi_setting,closingDateSetting:t.value.is_regular?d.value.annual_kpi_setting_end:d.value.probation_kpi_setting,closingDateMid:t.value.is_regular?d.value.mid_year_review_end:d.value.probation_first_review_end,closingDateFinal:t.value.is_regular?d.value.end_year_review_end:d.value.probation_final_review_end};m(l.authToken).post("/api/manager/employee-kpi/submit",s).then(i=>{_.value={status:!0,type:"success",text:i.data.message},u.value=i.data.profile.teams,l.setProfile(i.data.profile).then(()=>{x(),setTimeout(()=>{b.value=!1,T.value=!0},2e3)})}).catch(i=>{})},E=n(!1),te=e=>{E.value=e.hasError},ae=e=>{let a={id:e.id,user_ecode:l.authProfile.ecode};m(l.authToken).post("/api/delete/employee-kpi-year",a).then(s=>{let i=[];i=s.data.profile.slave_ecode,u.value=s.data.profile.teams,u.value=[...u.value,...i],console.log("teamList.value",u.value),console.log("res.data.profile",s.data.profile),l.setProfile(s.data.profile).then(()=>{x(),_.value={status:!0,type:"success",text:s.data.message}})}).catch(s=>{})},se=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:l.authProfile.ecode};m(l.authToken).post("/api/create/employee-kpi-year",a).then(s=>{_.value={status:!0,type:"success",text:s.data.message};let i=[];i=s.data.profile.slave_ecode,u.value=s.data.profile.teams,u.value=[...u.value,...i],console.log("teamList.value#######",u.value),console.log("res.data#######",s.data),l.setProfile(s.data.profile).then(()=>{x()})}).catch(s=>{})},le=e=>{L(e)},L=async e=>{await m(l.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},K=n([]),ie=async()=>{await m(l.authToken).get("/api/fetch/measures/non-paginated").then(e=>{K.value=e.data}).catch(e=>{})},x=()=>{t.value={};let e=u.value.filter(a=>a.username==D.value);t.value=Object.assign({},e[0]),console.log("teamList.value employeePassData()",u.value),L(2023)},d=de(()=>W.filteredSetting(t.value.company_id)),oe=async()=>{await m(l.authToken).get("/api/fetch/team-members/"+l.authProfile.ecode).then(e=>{e.data&&e.data.length>0&&(u.value=e.data.filter(a=>a.reviews.length>0),console.log("teamList.value******",u.value))}).catch(e=>{})};return ve(()=>{l.authToken&&oe().then(()=>{x(),q().then(()=>{G().then(()=>{J().then(()=>{ie()})})})})}),(e,a)=>(A(),N(me,{class:"pb-16",style:{"max-width":"95%"}},{default:c(()=>[r(U,{class:"my-5"},{default:c(()=>[o("div",xe,[r(pe,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>y.value=s),$],items:u.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),o("div",ke,[r(j,{class:"mb-3 elevation-0"},{default:c(()=>[r(O,null,{default:c(()=>[r(U,null,{default:c(()=>[o("div",Se,[r(ye,{profile:t.value},null,8,["profile"])]),o("div",Pe,[Te,o("div",Ve,f(fe(Y)),1)]),o("div",Ce,[De,o("div",Re,f(t.value.company&&t.value.company.title),1)]),o("div",Ie,[Me,o("div",Ee,f(d.value.year),1)]),o("div",Le,[Ke,o("div",Be,f(H(t.value))+"/100 ",1)]),o("div",Ne,[!E.value&&R.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(A(),N(V,{key:0,size:"large",onClick:Z,loading:b.value,block:"",disabled:T.value,color:"secondary",class:"text-capitalize rounded-lg text-md-caption text-lg-body-2"},{default:c(()=>[S(f(t.value.is_regular&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading","disabled"])):ge("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),r(he,{"selected-employee":t.value,"measures-list":K.value,"industry-list":w.value,"ecd-list":P.value,onSavedResponse:se,onErrorcheck:te,onYearchange:le,onRemoveKPI:ae,onRating:X,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list"]),r(_e,{modelValue:g.value,"onUpdate:modelValue":a[1]||(a[1]=s=>g.value=s),width:"450"},{default:c(()=>[r(j,{class:"rounded-lg"},{default:c(()=>[r(O,null,{default:c(()=>[S(f(C.value)+". Do you want to Submit? ",1)]),_:1}),o("div",Ae,[r(V,{color:"primary",variant:"text",class:"mr-2",onClick:Q},{default:c(()=>[S("Close")]),_:1}),r(V,{color:"secondary",onClick:ee},{default:c(()=>[S("Confirm")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),r(be,{options:_.value},null,8,["options"])]),_:1}))}};export{Xe as default};
