import{a7 as Z,o as V,b as N,p as j,s as ee,r as _,C as A,A as y,k as te,u as se,c as W,w as v,V as ae,a as f,f as l,d as B,J as le,H as I,i as M,g as P,h as H,a2 as z,F as J,n as K,ao as ne,Y as q,aj as X,e as Y,ap as oe,K as ie,I as re}from"./app-376b7120.js";import{c as de}from"./clientApi-2f9c434c.js";import{e as ue}from"./vue-datepicker-63b1f7f0.js";import{h as ce,k as pe}from"./mdi-5e26928d.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";var fe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function he(s,n){return n={exports:{}},s(n,n.exports),n.exports}var me=he(function(s,n){(function(t,o){s.exports=o()})(fe,function(){return function t(o,u,p){var c=window,r="application/octet-stream",g=p||r,i=o,k=!u&&!p&&i,w=document.createElement("a"),$=function(m){return String(m)},x=c.Blob||c.MozBlob||c.WebKitBlob||$,S=u||"download",b,F;if(x=x.call?x.bind(c):Blob,String(this)==="true"&&(i=[i,g],g=i[0],i=i[1]),k&&k.length<2048&&(S=k.split("/").pop().split("?")[0],w.href=k,w.href.indexOf(k)!==-1)){var T=new XMLHttpRequest;return T.open("GET",k,!0),T.responseType="blob",T.onload=function(m){t(m.target.response,S,r)},setTimeout(function(){T.send()},0),T}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(i))if(i.length>1024*1024*1.999&&x!==$)i=d(i),g=i.type||r;else return navigator.msSaveBlob?navigator.msSaveBlob(d(i),S):C(i);else if(/([\x80-\xff])/.test(i)){var h=0,e=new Uint8Array(i.length),a=e.length;for(h;h<a;++h)e[h]=i.charCodeAt(h);i=new x([e],{type:g})}b=i instanceof x?i:new x([i],{type:g});function d(m){var E=m.split(/[:;,]/),R=E[1],Q=E[2]=="base64"?atob:decodeURIComponent,U=Q(E.pop()),O=U.length,D=0,G=new Uint8Array(O);for(D;D<O;++D)G[D]=U.charCodeAt(D);return new x([G],{type:R})}function C(m,E){if("download"in w)return w.href=m,w.setAttribute("download",S),w.className="download-js-link",w.innerHTML="downloading...",w.style.display="none",document.body.appendChild(w),setTimeout(function(){w.click(),document.body.removeChild(w),E===!0&&setTimeout(function(){c.URL.revokeObjectURL(w.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(m)&&(m="data:"+m.replace(/^data:([\w\/\-\+]+)/,r)),window.open(m)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=m),!0;var R=document.createElement("iframe");document.body.appendChild(R),!E&&/^data:/.test(m)&&(m="data:"+m.replace(/^data:([\w\/\-\+]+)/,r)),R.src=m,setTimeout(function(){document.body.removeChild(R)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(b,S);if(c.URL)C(c.URL.createObjectURL(b),!0);else{if(typeof b=="string"||b.constructor===$)try{return C("data:"+g+";base64,"+c.btoa(b))}catch{return C("data:"+g+","+encodeURIComponent(b))}F=new FileReader,F.onload=function(m){C(this.result)},F.readAsDataURL(b)}return!0}})}),L=Z({props:{emitBlob:{type:Boolean,default:!1},debounce:{type:Number,default:500},type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},perColumnsHeaders:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},setup(){return{isDisabled:_(!1)}},computed:{idName(){var s=new Date().getTime();return"export_"+s},downloadFields(){if(this.fields)return this.fields;if(this.exportFields)return this.exportFields}},methods:{async generate(){if(this.isDisabled)return;this.isDisabled=!0;const s=this.$props.debounce;let n=null;return new Promise((t,o)=>{const u=async()=>{typeof this.beforeGenerate=="function"&&await this.beforeGenerate();let c=this.data;if((typeof this.fetch=="function"||!c)&&(c=await this.fetch()),!c||!c.length){typeof this.beforeFinish=="function"&&await this.beforeFinish();return}let r=await this.getProcessedJson(c,this.downloadFields);return this.type==="html"?this.export(this.jsonToXLS(r),this.name.replace(".xls",".html"),"text/html"):this.type==="csv"?this.export(this.jsonToCSV(r),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(r),this.name,"application/vnd.ms-excel")};(()=>{let c=this;n&&clearTimeout(n),n=setTimeout(()=>{u().then(t).catch(o),c.isDisabled=!1},s)})()})},export:async function(s,n,t){let o=this.base64ToBlob(s,t);typeof this.beforeFinish=="function"&&await this.beforeFinish(),this.emitBlob?this.$emit("blob",o):me(o,n,t)},jsonToXLS(s){let n='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',t="<thead>";const o=Object.keys(s[0]).length;let u=this;const p=this.header||this.$attrs.title;p&&(t+=this.parseExtraData(p,'<tr><th colspan="'+o+'">${data}</th></tr>'));const c=this.perColumnsHeaders;if(Array.isArray(c)){t+="<tr>";for(let r in c)t+="<th>"+c[r]+"</th>";t+="</tr>"}t+="<tr>";for(let r in s[0])t+="<th>"+r+"</th>";return t+="</tr>",t+="</thead>",t+="<tbody>",s.map(function(r,g){t+="<tr>";for(let i in r)t+="<td>"+u.preprocessLongNum(u.valueReformattedForMultilines(r[i]))+"</td>";t+="</tr>"}),t+="</tbody>",this.footer!=null&&(t+="<tfoot>",t+=this.parseExtraData(this.footer,'<tr><td colspan="'+o+'">${data}</td></tr>'),t+="</tfoot>"),n.replace("${table}",t).replace("${worksheet}",this.worksheet)},jsonToCSV(s){let n=this;var t=[];const o=this.header||this.$attrs.title;o&&t.push(this.parseExtraData(o,"${data}\r\n"));const u=this.perColumnsHeaders;if(Array.isArray(u)){for(let p in u)t.push(u[p]),t.push(",");t.pop(),t.push(`\r
`)}for(let p in s[0])t.push(p),t.push(",");return t.pop(),t.push(`\r
`),s.map(function(p){for(let c in p){let r=p[c]+"";n.escapeCsv&&(r='="'+r+'"',r.match(/[,"\n]/)&&(r='"'+r.replace(/\"/g,'""')+'"')),t.push(r),t.push(",")}t.pop(),t.push(`\r
`)}),this.footer!=null&&t.push(this.parseExtraData(this.footer,"${data}\r\n")),t.join("")},async getProcessedJson(s,n){let t=this.getKeys(s,n),o=[],u=this;return await s.reduce(async function(p,c){await p;let r={};for(let g in t){let i=t[g];r[g]=await u.getValue(i,c)}return o.push(r),!0},[]),o},getKeys(s,n){if(n)return n;let t={};for(let o in s[0])t[o]=o;return t},parseExtraData(s,n){let t="";if(Array.isArray(s))for(var o=0;o<s.length;o++)s[o]&&(t+=n.replace("${data}",s[o]));else t+=n.replace("${data}",s);return t},async getValue(s,n){const t=typeof s!="object"?s:s.field;let o=typeof t!="string"?[]:t.split("."),u=this.defaultValue;return t?o.length>1?u=await this.getValueFromNestedItem(n,o):u=this.parseValue(n[t]):u=n,s.hasOwnProperty("callback")&&(u=await this.getValueFromCallback(u,s.callback)),u},valueReformattedForMultilines(s){return typeof s=="string"?s.replace(/\n/gi,"<br/>"):s},preprocessLongNum(s){if(this.stringifyLongNum){if(String(s).startsWith("0x"))return s;if(!isNaN(s)&&s!=""&&(s>99999999999||s<1e-13))return'="'+s+'"'}return s},getValueFromNestedItem(s,n){let t=s;for(let o of n)t&&(t=t[o]);return this.parseValue(t)},async getValueFromCallback(s,n){if(typeof n!="function")return this.defaultValue;const t=await n(s);return this.parseValue(t)},parseValue(s){return s||s===0||typeof s=="boolean"?s:this.defaultValue},base64ToBlob(s,n){let t=window.btoa(window.unescape(encodeURIComponent(s))),o=atob(t),u=o.length,p=new Uint8ClampedArray(u);for(;u--;)p[u]=o.charCodeAt(u);return new Blob([p],{type:n})}}});const ye=["id"];function be(s,n,t,o,u,p){return V(),N("div",{id:s.idName,onClick:n[0]||(n[0]=(...c)=>s.generate&&s.generate(...c)),style:ee(s.isDisabled?{opacity:"0.5","pointer-events":"none"}:{})},[j(s.$slots,"default",{},()=>[A(" Download "+y(s.name),1)])],12,ye)}L.render=be;L.__file="JsonExcel.vue";const ve={class:"v-col-12 v-col-md-2"},ge={class:"v-col-12 v-col-md-2"},we={class:"v-col-12 v-col-md-3"},ke={class:"d-flex justify-space-between"},_e={class:"v-col-12"},xe=l("thead",null,[l("tr",null,[l("th",{class:"text-center"},"#"),l("th",{class:"text-left"},"Entity"),l("th",{class:"text-center"},"Status"),l("th",{class:"text-center"},"Locked"),l("th",{class:"text-center"},"Open"),l("th",{class:"text-center"},"InProgress"),l("th",{class:"text-center"},"InReview"),l("th",{class:"text-center"},"Submitted")])],-1),Ce={key:0},Ve={class:"text-center"},Se={class:"text-left"},Ne={class:"text-center text-capitalize py-2"},Te=["onClick"],Ee=["onClick"],$e=["onClick"],Fe=["onClick"],Re=["onClick"],De={key:1},Be=l("tr",null,[l("td",{colspan:"8",class:"text-center"}," No record found. ")],-1),Ie=[Be],Ae={class:"text-center"},Le={class:"text-uppercase"},Ue=l("thead",null,[l("tr",null,[l("th",null,"#"),l("th",null,"Emp.ID"),l("th",null,"Emp.Name"),l("th",null,"Manager"),l("th",null,"Job Title"),l("th",null,"Department"),l("th",null,"Email")])],-1),Oe={key:0},Je={__name:"Report",setup(s){const n=te(),t=se(),o=_(new Date().getFullYear()),u=_([{value:1,title:"Regular"},{value:0,title:"Probation"}]),p=_({loadingFilter:!1,data:{company_id:null,is_regular:1}}),c=async()=>{p.value.loadingFilter=!0,F().then(()=>{p.value.loadingFilter=!1}).catch(h=>{p.value.loadingFilter=!1})},r=_(!1),g=_(""),i=_([]),k=(h,e,a)=>{r.value=!0,g.value=e,i.value=h,i.value.statusReview=a};_(!1);const w=async()=>i.value,$=_({EmpID:"ecode",EmpName:"display_name",Manager:{field:"managed_by.display_name",callback:h=>`${h}`},JobTitle:"designation",Company:{field:"company.title",callback:h=>`${h}`},Department:"department",Email:"email",Status:"statusReview"}),x=_([]),S=_([]),b=_([]),F=async()=>{let h="/api/reports/business-entity/kpi-employees?&filter[is_regular]="+p.value.data.is_regular+"&year="+o.value+"&filter[hrbp_email]="+t.authProfile.email;await de(t.authToken).get(h).then(e=>{x.value=e.data,e.data&&e.data.length>0&&(e.data.map((a,d)=>{S.value.includes(a.company_id)||(S.value.push(a.company_id),b.value.push({id:a.company_id,title:a.company.title}))}),T())}).catch(e=>{console.log("getEmployees",e)})},T=()=>{let h={};b.value&&b.value.length>0&&b.value.map((e,a)=>{h=n.filterAllSettings(e.id,o.value),h.state?(e.state=h.state,e.status=h.status,e.sort=a):(e.state="no-setting",e.status="locked",e.sort=99),e.lock="-",e.open="-",e.inprogress="-",e.inreview="-",e.submitted="-",e.employees={open:[],locked:[],inprogress:[],inreview:[],submitted:[]},x.value.map(d=>{d.company_id==e.id&&(d.reviews.length>0?d.reviews[0].status&&(d.reviews[0].status=="locked"||d.reviews[0].status=="closed")?(e.lock=isNaN(e.lock)?0:e.lock,e.lock=parseInt(e.lock)+1,e.employees.locked.push(d)):d.reviews[0].status&&d.reviews[0].status=="open"?(e.open=isNaN(e.open)?0:e.open,e.open=parseInt(e.open)+1,e.employees.open.push(d)):d.reviews[0].status&&d.reviews[0].status=="inprogress"?(e.inprogress=isNaN(e.inprogress)?0:e.inprogress,e.inprogress=parseInt(e.inprogress)+1,e.employees.inprogress.push(d)):d.reviews[0].status&&d.reviews[0].status=="inreview"?(e.inreview=isNaN(e.inreview)?0:e.inreview,e.inreview=parseInt(e.inreview)+1,e.employees.inreview.push(d)):d.reviews[0].status&&d.reviews[0].status=="submitted"&&(e.submitted=isNaN(e.submitted)?0:e.submitted,e.submitted=parseInt(e.submitted)+1,e.employees.submitted.push(d)):e.state=="no-setting"||e.status=="closed"||e.status=="locked"?(e.lock=isNaN(e.lock)?0:e.lock,e.lock=parseInt(e.lock)+1,e.employees.locked.push(d)):(e.open=isNaN(e.open)?0:e.open,e.open=parseInt(e.open)+1,e.employees.open.push(d)))})}),b.value.sort((e,a)=>e.sort-a.sort),console.log(b.value)};return(h,e)=>(V(),W(ae,{class:"pb-16"},{default:v(()=>[f(M,{class:"mt-5"},{default:v(()=>[l("div",ve,[f(B(ue),{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=a=>o.value=a),"year-picker":"",class:"pms-date-picker"},null,8,["modelValue"])]),l("div",ge,[f(le,{modelValue:p.value.data.is_regular,"onUpdate:modelValue":e[1]||(e[1]=a=>p.value.data.is_regular=a),items:u.value,"item-title":"title","item-value":"value",variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),l("div",we,[l("div",ke,[f(I,{onClick:c,height:"40px",color:"secondary",class:"text-capitalize",loading:p.value.loadingFilter},{default:v(()=>[A("Generate Report")]),_:1},8,["loading"])])])]),_:1}),f(M,null,{default:v(()=>[l("div",_e,[f(P,{class:"mb-3 elevation-0"},{default:v(()=>[f(H,null,{default:v(()=>[f(z,{density:"compact"},{default:v(()=>[xe,b.value.length>0?(V(),N("tbody",Ce,[(V(!0),N(J,null,K(b.value,(a,d)=>(V(),N("tr",{key:a.id},[l("td",Ve,y(d+=1),1),l("td",Se,y(a.title),1),l("td",Ne,[l("span",{class:re(`${a.state=="no-setting"?"text-error":"text-info"}`)},y(a.state=="no-setting"?"( No Setting )":"( "+a.state+" - "+a.status+" )"),3)]),l("td",{class:"text-center cursor-pointer",onClick:C=>k(a.employees.locked,a.title,"locked")},y(a.lock),9,Te),l("td",{class:"text-center cursor-pointer",onClick:C=>k(a.employees.open,a.title,"open")},y(a.open),9,Ee),l("td",{class:"text-center cursor-pointer",onClick:C=>k(a.employees.inprogress,a.title,"inprogress")},y(a.inprogress),9,$e),l("td",{class:"text-center cursor-pointer",onClick:C=>k(a.employees.inreview,a.title,"inreview")},y(a.inreview),9,Fe),l("td",{class:"text-center cursor-pointer",onClick:C=>k(a.employees.submitted,a.title,"submitted")},y(a.submitted),9,Re)]))),128))])):(V(),N("tbody",De,Ie))]),_:1})]),_:1})]),_:1})])]),_:1}),l("div",Ae,[f(ie,{modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value=a),width:"auto"},{default:v(()=>[f(P,null,{default:v(()=>[f(ne,{dark:"",color:"primary"},{default:v(()=>[f(I,{icon:"",dark:"",onClick:e[2]||(e[2]=a=>r.value=!1)},{default:v(()=>[f(q,{size:"16",icon:B(ce)},null,8,["icon"])]),_:1}),f(X),l("div",Le,y(g.value)+" - ( "+y(i.value.statusReview)+" )",1),f(X),i.value.length>0?(V(),W(B(L),{key:0,fetch:w,fields:$.value,worksheet:"Report",name:"PMS-Report.csv",type:"csv",disabled:"",class:"mr-3"},{default:v(()=>[f(I,{color:"green",icon:"",disabled:Object.keys(i.value).length==0,dark:""},{default:v(()=>[f(q,{size:"32",icon:B(pe)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1},8,["fields"])):Y("",!0)]),_:1}),f(H,null,{default:v(()=>[f(z,{density:"compact"},{default:v(()=>[Ue,i.value&&i.value.length>0?(V(),N("tbody",Oe,[(V(!0),N(J,null,K(i.value,(a,d)=>(V(),N("tr",{key:a.id},[l("td",null,y(d+1),1),l("td",null,y(a.ecode),1),l("td",null,y(a.display_name),1),l("td",null,y(a.managed_by?a.managed_by.display_name:""),1),l("td",null,y(a.designation),1),l("td",null,y(a.department),1),l("td",null,y(a.email),1)]))),128))])):Y("",!0)]),_:1})]),_:1}),f(oe,null,{default:v(()=>[f(I,{color:"primary",block:"",onClick:e[3]||(e[3]=a=>r.value=!1)},{default:v(()=>[A("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{Je as default};
