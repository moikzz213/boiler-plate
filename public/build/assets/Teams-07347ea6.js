import{z as U,r as n,u as $,k as R,c as T,w as s,V as z,o as m,a,f as o,A as y,d as k,G,E as L,I as Y,H as g,C as d,i as b,b as h,F as H,n as J,g as w,h as x,B as W,J as D,e as q}from"./app-d2fb1262.js";import Q from"./KpiProgress-3cf08e3a.js";import{_ as X}from"./EmployeeCard-d6e2f4e2.js";import{c as I}from"./clientApi-2b4a321a.js";import{_ as Z}from"./SnackBar-28e14e9f.js";import"./printInitials-a54a9c4a.js";import"./mdi-a0a77bee.js";const ee={class:"v-col-12 pb-0"},te={class:"text-h6"},le={class:"v-col-12 v-col-md-3"},ae={class:"v-col-12 v-col-md-3"},se={class:"v-col-12 v-col-md-2"},oe=o("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[o("div",{class:"text-h6"},"Year: 2023")],-1),ie={key:0,class:"v-col-12"},ne={class:"v-col-12 v-col-md-3"},re={class:"v-col-12 v-col-md-8"},de={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},ue={key:0},ce=o("div",{class:"text-caption text-grey"},"Total KPI",-1),me={key:1,class:"v-col-12"},ve={class:"pa-3 mt-3 d-flex justify-end"},pe={class:"pa-3 mt-3 d-flex justify-end"},be={__name:"Teams",setup(fe){const K=U(),C=(l,t=null)=>{let e=t?Object.assign({},t):!1;K.push({name:l,params:e}).catch(p=>{})},P=n({}),i=$(),f=R(),_=n(i.authProfile.teams),M=n(new Date().getFullYear()),j=n(new Date),E=n(["All","Regular","Probation"]),V=n("Employee doesn`t have a KPI review setup for this year."),r=n({data:{employee:"",employee_type:"All"}}),S=async()=>{N()},F=l=>{let t=0;return l.reviews&&l.reviews.length>0&&l.reviews[0].key_review&&l.reviews[0].key_review.map((e,p)=>{t+=e.weightage}),t},u=n({}),v=n(!1),c=n(!1),B=()=>{r.value.data.employee="",_.value=i.authProfile.teams},O=()=>{I(i.authToken).post("/api/create/employee-review/year",{ecode:u.value.ecode,is_regular:u.value.is_regular,setting:f.filteredSetting(u.value.company_id),year:M.value,author:i.authProfile.display_name+" "+i.authProfile.ecode}).then(l=>{P.value={status:!0,type:"success",text:l.data.message}}),I(i.authToken).get("/api/fetch/auth-profile/kpi/"+i.authProfile.ecode).then(l=>{i.setProfile(l.data.result).then(()=>{C("SingleTeamMember",{id:u.value.ecode})})}).catch(l=>{})},A=l=>{let t="KPI review is currently closed",e=f.filteredSetting(l.company_id);if(u.value=Object.assign({},l),l.reviews&&l.reviews.length>0)l.is_regular==1&&l.reviews[0].status=="locked"&&l.reviews[0].state=="closed"?(V.value=t,c.value=!0):C("SingleTeamMember",{id:l.ecode});else if(e.status=="open"&&e.state=="setting")v.value=!0;else if(l.is_regular==0){let p=new Date(l.doj);p.setDate(p.getDate()+parseInt(e.probation_kpi_setting)),p>=j.value?v.value=!0:c.value=!0}else e.status=="locked"&&e.state=="closed"&&(V.value=t),c.value=!0},N=()=>{let l=i.authProfile.teams.filter(function(t){return r.value.data.employee?t.ecode==r.value.data.employee:r.value.data.employee_type=="Probation"?t.is_regular==0:r.value.data.employee_type=="Regular"?t.is_regular==1:t});_.value=l};return(l,t)=>(m(),T(z,{class:"pb-16"},{default:s(()=>[a(b,{class:"mt-5"},{default:s(()=>[o("div",ee,[o("div",te," My Team "+y("("+k(i).authProfile.teams.length+")"),1)]),o("div",le,[a(G,{modelValue:r.value.data.employee,"onUpdate:modelValue":t[0]||(t[0]=e=>r.value.data.employee=e),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:L(S,["enter"]),"onClick:clear":B},null,8,["modelValue","onKeydown"])]),o("div",ae,[a(Y,{modelValue:r.value.data.employee_type,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value.data.employee_type=e),items:E.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),o("div",se,[a(g,{onClick:S,block:"",color:"primary",class:"text-capitalize"},{default:s(()=>[d("Filter")]),_:1})]),oe]),_:1}),a(b,null,{default:s(()=>[_.value.length>0?(m(),h("div",ie,[(m(!0),h(H,null,J(_.value,e=>(m(),T(w,{key:e.id,class:"mb-3 elevation-0",onClick:()=>A(e)},{default:s(()=>[a(x,null,{default:s(()=>[a(b,null,{default:s(()=>[o("div",ne,[a(X,{profile:e},null,8,["profile"])]),o("div",re,[a(Q,{density:"compact","selected-employee":e},null,8,["selected-employee"])]),o("div",de,[k(f).pmsSettings&&k(f).pmsSettings.state!="yearend"||e.reviews&&e.reviews.length>0&&e.reviews[0].type=="probation"&&e.reviews[0].state!="final_review"?(m(),h("div",ue,[o("div",null,y(F(e))+" / 100 ",1),ce])):q("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):(m(),h("div",me,[a(w,null,{default:s(()=>[a(x,{class:"text-center"},{default:s(()=>[d(" No records found ")]),_:1})]),_:1})]))]),_:1}),a(D,{modelValue:v.value,"onUpdate:modelValue":t[3]||(t[3]=e=>v.value=e),width:"450"},{default:s(()=>[a(w,{class:"rounded-lg"},{default:s(()=>[a(W,null,{default:s(()=>[d(" Do you want to set KPI for "+y(u.value.username)+"? ",1)]),_:1}),o("div",ve,[a(g,{color:"primary",variant:"text",onClick:t[2]||(t[2]=e=>v.value=!1)},{default:s(()=>[d("Cancel")]),_:1}),a(g,{color:"primary",class:"ml-2 px-8",onClick:O},{default:s(()=>[d("yes")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),a(D,{modelValue:c.value,"onUpdate:modelValue":t[5]||(t[5]=e=>c.value=e),width:"450"},{default:s(()=>[a(w,{class:"rounded-lg"},{default:s(()=>[a(x,null,{default:s(()=>[d(y(V.value),1)]),_:1}),o("div",pe,[a(g,{color:"primary",variant:"text",onClick:t[4]||(t[4]=e=>c.value=!1)},{default:s(()=>[d("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),a(Z,{options:P.value},null,8,["options"])]),_:1}))}};export{be as default};
