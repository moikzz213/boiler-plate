import{z as ne,L as ue,r as n,u as re,k as ce,M as de,l as ve,c as A,w as c,V as me,o as L,a as u,f as o,N as pe,g as j,h as O,i as U,A as f,d as fe,H as P,C as S,e as _e,K as he}from"./app-00536877.js";import{_ as ge}from"./KpiContent-e65c5103.js";import{_ as ye}from"./EmployeeCard-0a003bc8.js";import{c as p}from"./clientApi-b8f92d4f.js";import{u as we}from"./industry-aa315c44.js";import{_ as be}from"./SnackBar-124f1193.js";import"./mdi-5e26928d.js";import"./vue-datepicker-1412a14f.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const xe={class:"v-col-12 v-col-md-3"},ke={class:"v-col-12"},Se={class:"v-col-12 v-col-md-3 d-flex align-center"},Te={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ve=o("div",{class:"text-caption text-grey"}," Reporting To ",-1),Pe={class:"text-body-2"},Ce={class:"v-col-12 v-col-md-2 d-flex flex-column"},De=o("div",{class:"text-caption text-grey"}," Business Unit ",-1),Re={class:"text-body-2"},Ie={class:"v-col-12 v-col-md-2 d-flex flex-column"},Me=o("div",{class:"text-caption text-grey"}," KPI's Target Year ",-1),Ee={class:"text-body-2"},Ke={class:"v-col-12 v-col-md-1 d-flex flex-column"},Be=o("div",{class:"text-caption text-grey"}," Total KPI ",-1),Ne={class:"text-body-2"},Ae={class:"v-col-12 v-col-md-2 d-flex align-center"},Le={class:"pa-3 mt-3 d-flex justify-end"},Xe={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(je){var N;const z=ne(),F=ue(),_=n(!1),C=n(""),D=n(F.params.id),l=re(),W=ce(),y=we(),h=n({}),Y=(N=l==null?void 0:l.authProfile)==null?void 0:N.display_name,r=n([]),g=n(D.value),t=n({}),$=()=>{t.value=g.value,z.push({name:"SingleTeamMember",params:{id:g.value.ecode}}).catch(e=>{})},R=n(0),H=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,i)=>{a+=s.weightage}),R.value=a,a},m=n([]),q=async()=>{y.industries.length==0?y.getIndustries(l.authToken).then(()=>{m.value=y.industries}):m.value=y.industries},w=n([]),T=n([]),G=async()=>{await p(l.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{m.value&&m.value.length>0&&e.data&&e.data.length>0&&m.value.map((a,s)=>{w.value[s]=a,w.value[s].kpis=[];let i=0,d=0;e.data.map((k,Oe)=>{a.id==k.industry_id?(w.value[s].kpis[i]=k,i++):k.type=="ecd"&&(T.value[d]=k,d++)})})})},J=async()=>{await p(l.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+l.authProfile.ecode).then(e=>{m.value&&m.value.length>0&&e.data&&e.data.length>0&&m.value.map((a,s)=>{let i=0;e.data.map(d=>{a.id==d.industry_id?a.kpis.unshift(d):d.type=="ecd"&&(T.value[i]=d,i++)})})})},Q=()=>{_.value=!1,b.value=!1,V.value=!1},I=n(""),X=e=>{I.value=e},b=n(!1),V=n(!1),Z=()=>{b.value=!0;let e=!1,a="inprogress",s=t.value.reviews[0].id;if(!s)return h.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.is_regular&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?a="inreview":a="submitted":((t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(a="submitted"),t.value.reviews[0].state=="yearend"&&(e=!0,_.value=!0,C.value="The Final PMS rating of "+t.value.first_name+" for the year "+t.value.reviews[0].year+" is: "+I.value)),e||M(s,a)},ee=()=>{M(t.value.reviews[0].id,"submitted"),_.value=!1},M=(e,a)=>{let s={reviewID:e,newStatus:a,user_ecode:l.authProfile.ecode,employee_ecode:g.value,allowedDays:t.value.is_regular?v.value.employee_review_allowed_days:v.value.probation_kpi_setting,closingDateSetting:t.value.is_regular?v.value.annual_kpi_setting_end:v.value.probation_kpi_setting,closingDateMid:t.value.is_regular?v.value.mid_year_review_end:v.value.probation_first_review_end,closingDateFinal:t.value.is_regular?v.value.end_year_review_end:v.value.probation_final_review_end};p(l.authToken).post("/api/manager/employee-kpi/submit",s).then(i=>{h.value={status:!0,type:"success",text:i.data.message};let d=[];d=i.data.profile.slave_ecode,r.value=i.data.profile.teams,r.value=[...r.value,...d],l.setProfile(i.data.profile).then(()=>{x(),setTimeout(()=>{b.value=!1,V.value=!0},2e3)})}).catch(i=>{})},E=n(!1),te=e=>{E.value=e.hasError},ae=e=>{let a={id:e.id,user_ecode:l.authProfile.ecode};p(l.authToken).post("/api/delete/employee-kpi-year",a).then(s=>{let i=[];i=s.data.profile.slave_ecode,r.value=s.data.profile.teams,r.value=[...r.value,...i],l.setProfile(s.data.profile).then(()=>{x(),h.value={status:!0,type:"success",text:s.data.message}})}).catch(s=>{})},se=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:l.authProfile.ecode};p(l.authToken).post("/api/create/employee-kpi-year",a).then(s=>{h.value={status:!0,type:"success",text:s.data.message};let i=[];i=s.data.profile.slave_ecode,r.value=s.data.profile.teams,r.value=[...r.value,...i],l.setProfile(s.data.profile).then(()=>{x()})}).catch(s=>{})},le=e=>{K(e)},K=async e=>{await p(l.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},B=n([]),ie=async()=>{await p(l.authToken).get("/api/fetch/measures/non-paginated").then(e=>{B.value=e.data}).catch(e=>{})},x=()=>{t.value={};let e=r.value.filter(a=>a.username==D.value);t.value=Object.assign({},e[0]),K(2023)},v=de(()=>W.filteredSetting(t.value.company_id)),oe=async()=>{await p(l.authToken).get("/api/fetch/team-members/"+l.authProfile.ecode).then(e=>{e.data&&e.data.length>0&&(r.value=e.data.filter(a=>a.reviews.length>0))}).catch(e=>{})};return ve(()=>{l.authToken&&oe().then(()=>{x(),q().then(()=>{G().then(()=>{J().then(()=>{ie()})})})})}),(e,a)=>(L(),A(me,{class:"pb-16",style:{"max-width":"95%"}},{default:c(()=>[u(U,{class:"my-5"},{default:c(()=>[o("div",xe,[u(pe,{modelValue:g.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>g.value=s),$],items:r.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),o("div",ke,[u(j,{class:"mb-3 elevation-0"},{default:c(()=>[u(O,null,{default:c(()=>[u(U,null,{default:c(()=>[o("div",Se,[u(ye,{profile:t.value},null,8,["profile"])]),o("div",Te,[Ve,o("div",Pe,f(fe(Y)),1)]),o("div",Ce,[De,o("div",Re,f(t.value.company&&t.value.company.title),1)]),o("div",Ie,[Me,o("div",Ee,f(v.value.year),1)]),o("div",Ke,[Be,o("div",Ne,f(H(t.value))+"/100 ",1)]),o("div",Ae,[!E.value&&R.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(L(),A(P,{key:0,size:"large",onClick:Z,loading:b.value,block:"",disabled:V.value,color:"secondary",class:"text-capitalize rounded-lg text-md-caption text-lg-body-2"},{default:c(()=>[S(f(t.value.is_regular&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading","disabled"])):_e("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),u(ge,{"selected-employee":t.value,"measures-list":B.value,"industry-list":w.value,"ecd-list":T.value,onSavedResponse:se,onErrorcheck:te,onYearchange:le,onRemoveKPI:ae,onRating:X,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list"]),u(he,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=s=>_.value=s),width:"450"},{default:c(()=>[u(j,{class:"rounded-lg"},{default:c(()=>[u(O,null,{default:c(()=>[S(f(C.value)+". Do you want to Submit? ",1)]),_:1}),o("div",Le,[u(P,{color:"primary",variant:"text",class:"mr-2",onClick:Q},{default:c(()=>[S("Close")]),_:1}),u(P,{color:"secondary",onClick:ee},{default:c(()=>[S("Confirm")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),u(be,{options:h.value},null,8,["options"])]),_:1}))}};export{Xe as default};
