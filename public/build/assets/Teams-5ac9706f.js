import{z as R,r as i,u as U,k as $,c as D,w as s,V as z,o as p,a as l,f as o,A as g,G,E as H,I as Y,H as h,C as c,i as C,b as w,F as J,n as W,g as k,h as S,B as q,J as K,d as M,e as Q}from"./app-a9279d98.js";import X from"./KpiProgress-7e1c33f9.js";import{_ as Z}from"./EmployeeCard-d6003ce5.js";import{c as V}from"./clientApi-206fdc8a.js";import{_ as ee}from"./SnackBar-3ffb6197.js";import"./printInitials-a54a9c4a.js";import"./mdi-a0a77bee.js";const te={class:"v-col-12 pb-0"},ae={class:"text-h6"},le={class:"v-col-12 v-col-md-3"},se={class:"v-col-12 v-col-md-3"},oe={class:"v-col-12 v-col-md-2"},ie=o("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[o("div",{class:"text-h6"},"Year: 2023")],-1),ne={key:0,class:"v-col-12"},re={class:"v-col-12 v-col-md-3"},de={class:"v-col-12 v-col-md-8"},ue={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},ce={key:0},me=o("div",{class:"text-caption text-grey"}," Total KPI ",-1),ve={key:1,class:"v-col-12"},pe={class:"pa-3 mt-3 d-flex justify-end"},fe={class:"pa-3 mt-3 d-flex justify-end"},Ce={__name:"Teams",setup(_e){const E=R(),P=(e,a=null)=>{let t=a?Object.assign({},a):!1;E.push({name:e,params:t}).catch(_=>{})},b=i({}),r=U(),f=$(),d=i([]),j=i(new Date().getFullYear()),B=i(new Date),F=i(["All","Regular","Probation"]),y=i("Employee doesn`t have a KPI review setup for this year."),n=i({data:{employee:"",employee_type:"All"}}),L=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((t,_)=>{a+=t.weightage}),a},T=i(!1),m=i({}),v=i(!1),u=i(!1),O=()=>{n.value.data.employee="",d.value=x.value},A=()=>{T.value=!0,b.value={status:!0,type:"info",text:"Creating KPI. Please wait..."},V(r.authToken).post("/api/create/employee-review/year",{ecode:m.value.ecode,is_regular:m.value.is_regular,setting:f.filteredSetting(m.value.company_id),year:j.value,author:r.authProfile.display_name+" "+r.authProfile.ecode}).then(e=>{setTimeout(()=>{b.value={status:!0,type:"success",text:e.data.message}},1500)}),V(r.authToken).get("/api/fetch/auth-profile/kpi/"+r.authProfile.ecode).then(e=>{r.setProfile(e.data.result).then(()=>{setTimeout(()=>{T.value=!1,P("SingleTeamMember",{id:m.value.ecode})},1500)})}).catch(e=>{})},N=e=>{let a="KPI review is currently closed",t=f.filteredSetting(e.company_id);if(m.value=Object.assign({},e),e.status=="Inactive")y.value="Employee is currently Inactive, kindly contact your HRBP if this is a mistake.",u.value=!0;else if(e.reviews&&e.reviews.length>0)e.is_regular==1&&e.reviews[0].status=="locked"&&e.reviews[0].state=="closed"?(y.value=a,u.value=!0):e.reviews[0].status=="open"?v.value=!0:P("SingleTeamMember",{id:e.ecode});else if(t.status=="open"&&t.state=="setting")v.value=!0;else if(e.is_regular==0){let _=new Date(e.doj);_.setDate(_.getDate()+parseInt(t.probation_kpi_setting)),_>=B.value?v.value=!0:u.value=!0}else t.status=="locked"&&t.state=="closed"&&(y.value=a),u.value=!0},I=()=>{let e=x.value.filter(function(a){return n.value.data.employee?a.display_name.toLowerCase().includes(n.value.data.employee.toLowerCase())?a:a.ecode==n.value.data.employee:n.value.data.employee_type=="Probation"?a.is_regular==0:n.value.data.employee_type=="Regular"?a.is_regular==1:a});d.value=e},x=i([]);return(()=>{V(r.authToken).get("/api/fetch/team-members/"+r.authProfile.ecode).then(e=>{d.value=e.data,x.value=e.data}).catch(e=>{})})(),(async()=>{await V(r.authToken).get("/api/pms-settings/all").then(e=>{f.setPmsSettings(e.data)})})(),(e,a)=>(p(),D(z,{class:"pb-16"},{default:s(()=>[l(C,{class:"mt-5"},{default:s(()=>[o("div",te,[o("div",ae," My Team "+g("("+d.value.length+")"),1)]),o("div",le,[l(G,{modelValue:n.value.data.employee,"onUpdate:modelValue":a[0]||(a[0]=t=>n.value.data.employee=t),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:H(I,["enter"]),"onClick:clear":O},null,8,["modelValue","onKeydown"])]),o("div",se,[l(Y,{modelValue:n.value.data.employee_type,"onUpdate:modelValue":a[1]||(a[1]=t=>n.value.data.employee_type=t),items:F.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),o("div",oe,[l(h,{onClick:I,block:"",color:"primary",class:"text-capitalize"},{default:s(()=>[c("Filter")]),_:1})]),ie]),_:1}),l(C,null,{default:s(()=>[d.value&&d.value.length>0?(p(),w("div",ne,[(p(!0),w(J,null,W(d.value,t=>(p(),D(k,{key:t.id,class:"mb-3 elevation-0",onClick:()=>N(t)},{default:s(()=>[l(S,null,{default:s(()=>[l(C,null,{default:s(()=>[o("div",re,[l(Z,{profile:t},null,8,["profile"])]),o("div",de,[l(X,{density:"compact","selected-employee":t},null,8,["selected-employee"])]),o("div",ue,[M(f).pmsSettings&&M(f).pmsSettings.state!="yearend"||t.reviews&&t.reviews.length>0&&t.reviews[0].type=="probation"&&t.reviews[0].state!="final_review"?(p(),w("div",ce,[o("div",null,g(L(t))+" / 100 ",1),me])):Q("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):(p(),w("div",ve,[l(k,null,{default:s(()=>[l(S,{class:"text-center"},{default:s(()=>[c(" No records found ")]),_:1})]),_:1})]))]),_:1}),l(K,{modelValue:v.value,"onUpdate:modelValue":a[3]||(a[3]=t=>v.value=t),width:"450"},{default:s(()=>[l(k,{class:"rounded-lg"},{default:s(()=>[l(q,null,{default:s(()=>[c(" Do you want to set KPI for "+g(m.value.username)+"? ",1)]),_:1}),o("div",pe,[l(h,{color:"primary",variant:"text",onClick:a[2]||(a[2]=t=>v.value=!1)},{default:s(()=>[c("Cancel")]),_:1}),l(h,{loading:T.value,color:"primary",class:"ml-2 px-8",onClick:A},{default:s(()=>[c("yes")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:u.value,"onUpdate:modelValue":a[5]||(a[5]=t=>u.value=t),width:"450"},{default:s(()=>[l(k,{class:"rounded-lg"},{default:s(()=>[l(S,null,{default:s(()=>[c(g(y.value),1)]),_:1}),o("div",fe,[l(h,{color:"primary",variant:"text",onClick:a[4]||(a[4]=t=>u.value=!1)},{default:s(()=>[c("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),l(ee,{options:b.value},null,8,["options"])]),_:1}))}};export{Ce as default};
