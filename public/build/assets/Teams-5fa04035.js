import{k as L,r as d,o as r,b as v,F as R,n as N,c as V,w as o,f as i,H as T,C as p,A as y,e as h,a as s,g as P,h as $,i as D,I as U,d as j,z as Z,u as ee,V as te,G as ae,E as le,J as se,K as B,s as ie}from"./app-525191c0.js";import H from"./KpiProgress-90ed327a.js";import{_ as G}from"./EmployeeCard-d1a346c9.js";import{c as I}from"./clientApi-64dd0185.js";import{_ as oe}from"./SnackBar-8d37a17f.js";import"./printInitials-a54a9c4a.js";import"./mdi-5e26928d.js";const ne={class:"d-flex align-center w-100"},re={style:{width:"25px"}},de={style:{width:"100%"}},ce={key:0,class:"mb-2",style:{color:"white","font-size":"8px","line-height":"8px",padding:"4px 10px",display:"inline-block","text-transform":"uppercase","background-color":"#2196f3",position:"absolute",top:"0",left:"0"}},ue={class:"v-col-12 v-col-md-8"},me={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},ve={key:0},pe=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),W={__name:"SubTeams",props:{user:{type:Object,default:null}},setup(F){const K=F,C=L(),S=n=>{let k=0;return n.reviews&&n.reviews.length>0&&n.reviews[0].key_review&&n.reviews[0].key_review.map((l,g)=>{k+=l.weightage}),k},c=d(K.user),f=n=>{n.sign?n.sign=="+"?n.sign="-":(n.sign="+",u(n)):n.sign="-"},u=n=>{Object.assign([],n).teams.map((l,g)=>{l.sign="+",l.teams&&l.teams.length>0&&u(l)})};return(n,k)=>(r(),v("div",null,[(r(!0),v(R,null,N(c.value.teams,l=>(r(),V(D,{class:"v-col-12 py-0 my-0 ml-3",key:l.id},{default:o(()=>[i("div",ne,[i("div",re,[l.teams&&l.teams.length>0?(r(),V(T,{key:0,onClick:g=>f(l),class:"",color:"primary",size:"25"},{default:o(()=>[p(y(l.sign?l.sign:"+"),1)]),_:2},1032,["onClick"])):h("",!0)]),i("div",de,[s(P,{width:"100%",class:"mb-1 elevation-0"},{default:o(()=>[s($,{style:{position:"relative"}},{default:o(()=>[l.is_regular==!1?(r(),v("div",ce," Probation Employee ")):h("",!0),s(D,null,{default:o(()=>[i("div",{class:U(`v-col-12 ${l.is_regular==!1?"pt-6":""} v-col-md-3`)},[s(G,{profile:l},null,8,["profile"])],2),i("div",ue,[s(H,{density:"compact","selected-employee":l},null,8,["selected-employee"])]),i("div",me,[j(C).pmsSettings&&j(C).pmsSettings.state!="yearend"||l.reviews&&l.reviews.length>0&&l.reviews[0].type=="probation"&&l.reviews[0].state!="final_review"?(r(),v("div",ve,[i("div",null,y(S(l))+" / 100 ",1),pe])):h("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),l.teams&&l.teams.length>0&&l.sign=="-"?(r(),V(W,{key:0,class:"w-100",user:l},null,8,["user"])):h("",!0)]),_:2},1024))),128))]))}},fe={class:"v-col-12 pb-0"},ge={class:"text-h6"},_e={class:"v-col-12 v-col-md-3"},ye={class:"v-col-12 v-col-md-3"},he={class:"v-col-12 v-col-md-2"},we=i("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[i("div",{class:"text-h6"},"Year: 2023")],-1),ke={key:0,class:"v-col-12"},xe={class:"d-flex align-center w-100"},be={style:{width:"25px"}},Te={style:{width:"100%"}},Ve={key:0,class:"mb-2",style:{color:"white","font-size":"8px","line-height":"8px",padding:"4px 10px",display:"inline-block","text-transform":"uppercase","background-color":"#2196f3",position:"absolute",top:"0",left:"0"}},Ce={class:"v-col-12 v-col-md-8"},Se={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},Pe={key:0},$e=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),De={key:1,class:"v-col-12"},Ie={class:"pa-3 mt-3 d-flex justify-end"},je={class:"pa-3 mt-3 d-flex justify-end"},Ne={__name:"Teams",setup(F){const K=Z(),C=(t,a=null)=>{let e=a?Object.assign({},a):!1;K.push({name:t,params:e}).catch(w=>{})},S=d({}),c=ee(),f=L(),u=d([]),n=d(new Date().getFullYear()),k=d(new Date),l=d(["All","Regular","Probation"]),g=d("Employee doesn`t have a KPI review setup for this year. Contact your HRBP for more info."),m=d({data:{employee:"",employee_type:"All"}}),Y=t=>{let a=0;return t.reviews&&t.reviews.length>0&&t.reviews[0].key_review&&t.reviews[0].key_review.map((e,w)=>{a+=e.weightage}),a},J=t=>{t.sign?t.sign=="+"?t.sign="-":(t.sign="+",M(t)):t.sign="-"},M=t=>{Object.assign([],t).teams.map((e,w)=>{e.sign="+",e.teams&&e.teams.length>0&&M(e)})},z=d(!1),x=d({}),b=d(!1),_=d(!1),q=()=>{m.value.data.employee="",u.value=O.value},Q=()=>{z.value=!0,S.value={status:!0,type:"info",text:"Initializing KPI. Please wait..."},I(c.authToken).post("/api/create/employee-review/year",{ecode:x.value.ecode,is_regular:x.value.is_regular,setting:f.filteredSetting(x.value.company_id),year:n.value,author:c.authProfile.display_name+" "+c.authProfile.ecode}).then(t=>{setTimeout(()=>{S.value={status:!0,type:"success",text:t.data.message}},800)}),I(c.authToken).get("/api/fetch/auth-profile/kpi/"+c.authProfile.ecode).then(t=>{c.setProfile(t.data.result).then(()=>{setTimeout(()=>{z.value=!1,C("SingleTeamMember",{id:x.value.ecode})},3e3)})}).catch(t=>{})},E=d(""),X=t=>{let a="KPI review is currently closed",e=f.filteredSetting(t.company_id);if(E.value="Do you want to set KPI for ",x.value=Object.assign({},t),t.status=="Inactive")g.value="Employee is currently Inactive, kindly contact your HRBP for more info.",_.value=!0;else if(t.reviews&&t.reviews.length>0)t.reviews[0].key_review==0&&t.reviews[0].state!="setting"?_.value=!0:t.is_regular==1&&(t.reviews[0].status=="locked"||t.reviews[0].status=="closed")?(g.value=a,_.value=!0):t.reviews[0].status=="open"?(b.value=!0,e.state!="setting"&&(E.value="Do you want to initialize the review for ")):C("SingleTeamMember",{id:t.ecode});else if(e.status=="open"&&e.state=="setting"&&t.is_regular==1)b.value=!0;else if(t.is_regular==0){let w=new Date(t.doj);w.setDate(w.getDate()+parseInt(e.probation_kpi_setting)),w>=k.value?b.value=!0:((e.status=="locked"||e.status=="closed")&&(g.value=a),_.value=!0)}else e.status=="locked"&&e.state=="closed"&&(g.value=a),_.value=!0},A=()=>{let t=O.value.filter(function(a){return m.value.data.employee?a.display_name.toLowerCase().includes(m.value.data.employee.toLowerCase())?a:a.ecode==m.value.data.employee:m.value.data.employee_type=="Probation"?a.is_regular==0:m.value.data.employee_type=="Regular"?a.is_regular==1:a});u.value=t},O=d([]);return(()=>{I(c.authToken).get("/api/fetch/team-members/"+c.authProfile.ecode).then(t=>{u.value=t.data,O.value=t.data}).catch(t=>{})})(),(async()=>{await I(c.authToken).get("/api/pms-settings/all").then(t=>{f.setPmsSettings(t.data),f.setAllSettings(t.data)})})(),(t,a)=>(r(),V(te,{class:"pb-16",style:{"max-width":"98%"}},{default:o(()=>[s(D,{class:"mt-5"},{default:o(()=>[i("div",fe,[i("div",ge," My Team "+y("("+u.value.length+")"),1)]),i("div",_e,[s(ae,{modelValue:m.value.data.employee,"onUpdate:modelValue":a[0]||(a[0]=e=>m.value.data.employee=e),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:le(A,["enter"]),"onClick:clear":q},null,8,["modelValue","onKeydown"])]),i("div",ye,[s(se,{modelValue:m.value.data.employee_type,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value.data.employee_type=e),items:l.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),i("div",he,[s(T,{onClick:A,block:"",color:"secondary",class:"text-capitalize"},{default:o(()=>[p("Filter")]),_:1})]),we]),_:1}),s(D,null,{default:o(()=>[u.value&&u.value.length>0?(r(),v("div",ke,[(r(!0),v(R,null,N(u.value,(e,w)=>(r(),v("div",{style:ie(`${e.sign&&e.sign=="-"?"border-bottom:1px solid #C6A92D;":""}`),key:e.id},[i("div",xe,[i("div",be,[e.teams&&e.teams.length>0?(r(),V(T,{key:0,onClick:Ee=>J(e),class:"",color:"primary",size:"25"},{default:o(()=>[p(y(e.sign?e.sign:"+"),1)]),_:2},1032,["onClick"])):h("",!0)]),i("div",Te,[s(P,{width:"100%",class:"mb-1 elevation-0",onClick:()=>X(e)},{default:o(()=>[s($,{style:{position:"relative"}},{default:o(()=>[e.is_regular==!1?(r(),v("div",Ve," Probation Employee ")):h("",!0),s(D,null,{default:o(()=>[i("div",{class:U(`v-col-12 ${e.is_regular==!1?"pt-6":""} v-col-md-3`)},[s(G,{profile:e},null,8,["profile"])],2),i("div",Ce,[s(H,{density:"compact","selected-employee":e},null,8,["selected-employee"])]),i("div",Se,[j(f).pmsSettings&&j(f).pmsSettings.state!="yearend"||e.reviews&&e.reviews.length>0&&e.reviews[0].type=="probation"&&e.reviews[0].state!="final_review"?(r(),v("div",Pe,[i("div",null,y(Y(e))+" / 100 ",1),$e])):h("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])]),e.teams&&e.teams.length>0&&e.sign=="-"?(r(),V(W,{key:0,user:e},null,8,["user"])):h("",!0)],4))),128))])):(r(),v("div",De,[s(P,null,{default:o(()=>[s($,{class:"text-center"},{default:o(()=>[p(" No records found ")]),_:1})]),_:1})]))]),_:1}),s(B,{modelValue:b.value,"onUpdate:modelValue":a[3]||(a[3]=e=>b.value=e),width:"450"},{default:o(()=>[s(P,{class:"rounded-lg"},{default:o(()=>[s($,null,{default:o(()=>[p(y(E.value)+" "+y(x.value.first_name)+"? ",1)]),_:1}),i("div",Ie,[s(T,{color:"primary",variant:"text",onClick:a[2]||(a[2]=e=>b.value=!1)},{default:o(()=>[p("Cancel")]),_:1}),s(T,{loading:z.value,color:"secondary",class:"ml-2 px-8",onClick:Q},{default:o(()=>[p("yes")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),s(B,{modelValue:_.value,"onUpdate:modelValue":a[5]||(a[5]=e=>_.value=e),width:"450"},{default:o(()=>[s(P,{class:"rounded-lg"},{default:o(()=>[s($,null,{default:o(()=>[p(y(g.value),1)]),_:1}),i("div",je,[s(T,{color:"secondary",variant:"text",onClick:a[4]||(a[4]=e=>_.value=!1)},{default:o(()=>[p("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),s(oe,{options:S.value},null,8,["options"])]),_:1}))}};export{Ne as default};
