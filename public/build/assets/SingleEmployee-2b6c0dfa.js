import{u as ve,l as pe,k as me,x as fe,r as u,O as he,Q,c as v,w as l,V as ge,o as c,a as o,f as r,U as O,s as X,y as U,d as S,W as E,b as _,C as Y,F as B,X as V,n as p,L as ye,v as I,t as m,e as R,i as F,g as _e,h as xe,Y as N,Z as ke}from"./app-c786321f.js";import{c as g}from"./clientApi-745d63d6.js";import{m as Z,a as we}from"./mdi-5e26928d.js";import{_ as be}from"./KpiContent-3285814d.js";import{_ as Ce}from"./EmployeeCard-c7580944.js";import{_ as Se}from"./ConfirmDialog-39e0c9ce.js";import{_ as Ee}from"./SnackBar-1575f1e0.js";import{u as Ve}from"./industry-63c12535.js";import"./vue-datepicker-83ed9b3b.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const Pe={class:"v-col-12 v-col-md-3 pb-0"},Te=r("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Ie={key:0,class:"v-col-12 v-col-md-3 text-right pb-0"},Re={class:"v-col-12 v-col-md-3 pb-0"},Ae=r("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Le={key:1,class:"v-col-12 v-col-md-2 text-right pb-0"},Ke=r("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"},"Employee Status",-1),Me={class:"v-col-12"},Oe={class:"v-col-12 v-col-md-3 d-flex align-center"},Ue={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ye=r("div",{class:"text-caption text-grey"},"Reporting To",-1),Be={class:"text-body-2"},Fe={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ne=r("div",{class:"text-caption text-grey"},"Business Unit",-1),$e={class:"text-body-2"},ze={class:"v-col-12 v-col-md-2 d-flex flex-column"},De=r("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),We={class:"text-body-2"},je={class:"v-col-12 v-col-md-1 d-flex flex-column"},Qe=r("div",{class:"text-caption text-grey"},"Total KPI",-1),Xe={class:"text-body-2"},Ze={key:0,class:"v-col-12 v-col-md-2 d-flex align-center"},ra={__name:"SingleEmployee",setup(qe){Ve();const d=ve(),q=pe(),G=me(),H=fe(),f=u({}),y=u(""),P=u("Active"),$=u(""),J=u([{title:"Active",color:"success"},{title:"Inactive",color:"error"}]);u([]);const ee=u([]),ae=u([]),te=u([]),z=u(new Date().getFullYear()),le=e=>{z.value=e,se(e)},se=async e=>{await g(d.authToken).get("/api/dashboard/my-kpi/"+a.value.id+"/"+e).then(t=>{t.data.result==null?a.value={...a.value,reviews:[]}:a.value={...a.value,reviews:[t.data.result]}}).catch(t=>{location.reload()})},oe=e=>{let t=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,n)=>{t+=s.weightage}),t},x=u(""),A=u(!1),ie=()=>{var s,n;let e=(n=(s=a.value)==null?void 0:s.reviews[0])==null?void 0:n.id;A.value=!0;let t={reviewID:e,state:x.value,title:y.value,profile_id:d.authProfile.id};g(d.authToken).post("/api/hr-change/state",t).then(C=>{f.value={status:!0,type:"success",text:C.data.message},k()}).catch(C=>{})},a=u({}),k=async()=>{await g(d.authToken).get("/api/hr/employee/ecode/"+H.params.ecode).then(e=>{var t,s,n,C;a.value=e.data,e.data.reviews[0].type=="regular"?(y.value="Mid Year",x.value="midyear",((s=(t=e.data)==null?void 0:t.reviews[0])==null?void 0:s.state)=="midyear"&&(y.value="Year End",x.value="yearend")):(y.value="First Review",x.value="first_review",((C=(n=e.data)==null?void 0:n.reviews[0])==null?void 0:C.state)=="first_review"&&(y.value="Final Review",x.value="final_review")),A.value=!1,P.value=e.data.status,h.value=e.data.slave_ecode}).catch(e=>{location.reload()})},L=he(()=>q.filteredSetting(a.value.company_id));d.authToken&&k();const ne=e=>{$.value=e.title,i.value={dialog:!0,title:"Confirm Status Update",text:"Please confirm that you want to update the status of "+a.value.display_name+" into "+e.title+".",btnColor:e.title=="Active"?"success":"error",btnTitle:"Confirm"}},ue=async()=>{let e={profile_id:d.authProfile.id,ecode:a.value.ecode,status:$.value};i.value={...i.value,loading:!0},await g(d.authToken).post("/api/hr/employee/status/update",e).then(t=>{k().then(()=>{i.value={...i.value,loading:!1,dialog:!1},f.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{console.log("getEmployee",t),i.value={...i.value,loading:!1},f.value={status:!0,type:"error",text:"Error while updating employee"}})},w=u(""),h=u(""),b=u(!1),K=u([]),M=u({}),D=async e=>{b.value=!0,await g(d.authToken).get("/api/hr/search/employee?&filter[search]="+e).then(t=>{b.value=!1,h.value?M.value=t.data:w.value&&(K.value=t.data)}).catch(t=>{b.value=!1,console.log("getEmployee",t)})},W=async(e,t)=>{let s={profile_id:d.authProfile.id,slave_ecode:t?"":e.ecode,ecode:a.value.ecode};i.value={...i.value,loading:!0},h.value=e==null?void 0:e.ecode,await g(d.authToken).post("/api/employee/secondary-manager/update",s).then(n=>{k().then(()=>{i.value={...i.value,loading:!1,dialog:!1},f.value={status:!0,type:"success",text:n.data.message}})}).catch(n=>{i.value={...i.value,loading:!1},f.value={status:!0,type:"error",text:"Error while updating employee"}})},re=e=>{a.value=e,P.value=e.status,G.push({name:"SingleEmployee",params:{ecode:e.ecode}}).catch(t=>{})};Q(w,(e,t)=>{e&&e!=t&&e.length>3&&D(w.value)}),Q(h,(e,t)=>{e&&e!=t&&e.length>3&&D(h.value)});const T=u({data:{},loading:!1}),j=()=>{i.value={dialog:!0,title:"Confirm to Open KPI",text:"Please confirm that you want to open the KPI for "+a.value.display_name+".",btnColor:"secondary",btnTitle:"Confirm"}},ce=async()=>{i.value={...i.value,loading:!0};let e={profile_id:d.authProfile.id,name:d.authProfile.display_name,ecode:a.value.ecode,year:z.value};await g(d.authToken).post("/api/hr/employee/reopen",e).then(t=>{i.value={...i.value,loading:!1,dialog:!1},T.value.loading=!0,k().then(()=>{T.value.loading=!1,f.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{i.value={...i.value,loading:!1},f.value={status:!0,type:"error",text:"Error while updating employee"}})},i=u(),de=e=>{i.value.title=="Confirm Status Update"?ue():i.value.title=="Confirm to Open KPI"&&ce()};return(e,t)=>(c(),v(ge,{class:"pb-16"},{default:l(()=>[o(F,{class:"mt-5 justify-space-between"},{default:l(()=>[r("div",Pe,[o(O,null,{activator:l(({props:s})=>[o(X,U(s,{modelValue:w.value,"onUpdate:modelValue":t[0]||(t[0]=n=>w.value=n),loading:b.value,variant:"outlined",density:"compact",class:"bg-white",label:"Search Employee","hide-details":"","append-inner-icon":S(Z)}),null,16,["modelValue","loading","append-inner-icon"])]),default:l(()=>[K.value.length>0?(c(),v(E,{key:0,density:"compact",style:{"max-height":"300px"}},{default:l(()=>[(c(!0),_(B,null,Y(K.value,(s,n)=>(c(),v(V,{key:n,onClick:()=>re(s)},{default:l(()=>[o(N,null,{default:l(()=>[p(m(s.display_name+" - "+s.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(c(),v(E,{key:1,density:"compact"},{default:l(()=>[o(V,null,{default:l(()=>[p(" No results found ")]),_:1})]),_:1}))]),_:1}),Te]),o(ye),a.value.status=="Active"&&a.value.reviews&&a.value.reviews.length>0&&a.value.reviews[0].status=="submitted"?(c(),_("div",Ie,[o(I,{color:"secondary",loading:A.value,onClick:ie},{default:l(()=>[p("Change to "+m(y.value),1)]),_:1},8,["loading"])])):R("",!0),r("div",Re,[o(O,null,{activator:l(({props:s})=>[o(X,U(s,{modelValue:h.value,"onUpdate:modelValue":t[1]||(t[1]=n=>h.value=n),loading:b.value,variant:"outlined",density:"compact",class:"bg-white",label:"Secondary Manager","hide-details":"","onClick:clear":t[2]||(t[2]=n=>W(e.item,"clear")),clearable:"","append-inner-icon":S(Z)}),null,16,["modelValue","loading","append-inner-icon"])]),default:l(()=>[M.value.length>0?(c(),v(E,{key:0,density:"compact",style:{"max-height":"300px"}},{default:l(()=>[(c(!0),_(B,null,Y(M.value,(s,n)=>(c(),v(V,{key:n,onClick:()=>W(s)},{default:l(()=>[o(N,null,{default:l(()=>[p(m(s.display_name+" - "+s.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(c(),v(E,{key:1,density:"compact"},{default:l(()=>[o(V,null,{default:l(()=>[p(" No results found ")]),_:1})]),_:1}))]),_:1}),Ae]),["hr_admin","app_admin","hrbp"].includes(S(d).authProfile.role)?(c(),_("div",Le,[r("div",null,[o(O,null,{activator:l(({props:s})=>[o(I,U(s,{color:`${P.value=="Active"?"success":"error"}`,width:"120"}),{default:l(()=>[p(m(P.value),1)]),_:2},1040,["color"])]),default:l(()=>[o(E,{density:"compact"},{default:l(()=>[(c(!0),_(B,null,Y(J.value,(s,n)=>(c(),v(V,{key:n,onClick:()=>ne(s)},{default:l(()=>[o(N,null,{default:l(()=>[o(ke,{size:"16",color:s.color,icon:S(we)},null,8,["color","icon"]),p(" "+m(s.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),Ke])):R("",!0)]),_:1}),o(F,null,{default:l(()=>[r("div",Me,[o(_e,{class:"elevation-0"},{default:l(()=>[o(xe,null,{default:l(()=>[o(F,null,{default:l(()=>[r("div",Oe,[o(Ce,{profile:a.value},null,8,["profile"])]),r("div",Ue,[Ye,r("div",Be,m(a.value.managed_by&&a.value.managed_by.display_name?a.value.managed_by.display_name:""),1)]),r("div",Fe,[Ne,r("div",$e,m(a.value&&a.value.company?a.value.company.title:""),1)]),r("div",ze,[De,r("div",We,m(L.value.year),1)]),r("div",je,[Qe,r("div",Xe,m(oe(a.value))+"/100",1)]),["hr_admin","app_admin","hrbp"].includes(S(d).authProfile.role)?(c(),_("div",Ze,[a.value.status=="Active"&&a.value.reviews&&(a.value.reviews.length>0&&(a.value.reviews[0].status=="closed"||a.value.reviews[0].status=="locked"||a.value.reviews[0].status=="submitted")||a.value.reviews.length==0&&(L.value.status=="closed"||L.value.status=="locked"))?(c(),v(I,{key:0,loading:T.value.loading,onClick:j,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:l(()=>[p("Reopen")]),_:1},8,["loading"])):a.value.status=="Active"&&a.value.reviews.length==0&&a.value.is_regular==0?(c(),v(I,{key:1,loading:T.value.loading,onClick:j,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:l(()=>[p("Open")]),_:1},8,["loading"])):R("",!0)])):R("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),o(be,{"selected-employee":a.value,"measures-list":ee.value,"industry-list":ae.value,"ecd-list":te.value,onErrorcheck:e.errorCheck,onYearchange:le,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list","onErrorcheck"]),o(Se,{options:i.value,onConfirm:de},null,8,["options"]),o(Ee,{options:f.value},null,8,["options"])]),_:1}))}};export{ra as default};
