import{u as ce,k as ue,z as re,K as de,r as c,L as ve,N as pe,c as m,w as l,V as me,o as r,a as s,f as o,R as $,G as he,S as z,d as S,T as I,b as E,n as F,F as Y,U as R,C as _,H as O,A as v,e as A,i as L,g as fe,h as _e,W,X as ye}from"./app-5563dbee.js";import{c as p}from"./clientApi-5a66f6ee.js";import{m as ge,a as xe}from"./mdi-7fd0807e.js";import{_ as ke}from"./KpiContent-e091ccfb.js";import{_ as we}from"./EmployeeCard-aceef2ce.js";import{_ as be}from"./ConfirmDialog-101296f4.js";import{_ as Ce}from"./SnackBar-d592c516.js";import{u as Se}from"./industry-4211a137.js";import"./vue-datepicker-b5cd143d.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const Ee={class:"v-col-12 v-col-md-3 pb-0"},Te=o("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Ve={key:0,class:"v-col-12 v-col-md-3 text-right pb-0"},Pe=o("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"},"Employee Status",-1),Ie={class:"v-col-12"},Re={class:"v-col-12 v-col-md-3 d-flex align-center"},Ae={class:"v-col-12 v-col-md-2 d-flex flex-column"},Le=o("div",{class:"text-caption text-grey"},"Reporting To",-1),Be={class:"text-body-2"},Ke={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ne=o("div",{class:"text-caption text-grey"},"Business Unit",-1),Ue={class:"text-body-2"},Me={class:"v-col-12 v-col-md-2 d-flex flex-column"},$e=o("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),ze={class:"text-body-2"},Fe={class:"v-col-12 v-col-md-1 d-flex flex-column"},Ye=o("div",{class:"text-caption text-grey"},"Total KPI",-1),Oe={class:"text-body-2"},We={key:0,class:"v-col-12 v-col-md-2 d-flex align-center"},ot={__name:"SingleEmployee",setup(De){const y=Se(),u=ce(),D=ue(),j=re(),G=de(),h=c({}),g=c("Active"),B=c(""),H=c([{title:"Active",color:"success"},{title:"Inactive",color:"error"}]),f=c([]),X=async()=>{y.industries.length==0?y.getIndustries(u.authToken).then(()=>{f.value=y.industries}):f.value=y.industries},K=c([]),q=async()=>{await p(u.authToken).get("/api/fetch/measures/non-paginated").then(e=>{K.value=e.data}).catch(e=>{})},x=c([]),N=c([]),U=c(new Date().getFullYear()),J=e=>{U.value=e,Q(e)},Q=async e=>{await p(u.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},Z=async()=>{await p(u.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{f.value&&f.value.length>0&&e.data&&e.data.length>0&&f.value.map((a,i)=>{x.value[i]=a,x.value[i].kpis=[];let d=0,M=0;e.data.map((C,je)=>{a.id==C.industry_id?(x.value[i].kpis[d]=C,d++):C.type=="ecd"&&(N.value[M]=C,M++)})})})},ee=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((i,d)=>{a+=i.weightage}),a},t=c({}),T=async()=>{await p(u.authToken).get("/api/hr/employee/ecode/"+G.params.ecode).then(e=>{t.value=e.data,g.value=e.data.status}).catch(e=>{console.log("getEmployee",e)})},V=ve(()=>D.filteredSetting(t.value.company_id));T(),X(),Z(),q();const te=e=>{B.value=e.title,n.value={dialog:!0,title:"Confirm Status Update",text:"Please confirm that you want to update the status of "+t.value.display_name+" into "+e.title+".",btnColor:e.title=="Active"?"success":"error",btnTitle:"Confirm"}},ae=async()=>{let e={profile_id:u.authProfile.id,ecode:t.value.ecode,status:B.value};n.value={...n.value,loading:!0},await p(u.authToken).post("/api/hr/employee/status/update",e).then(a=>{T().then(()=>{n.value={...n.value,loading:!1,dialog:!1},h.value={status:!0,type:"success",text:a.data.message}})}).catch(a=>{console.log("getEmployee",a),n.value={...n.value,loading:!1},h.value={status:!0,type:"error",text:"Error while updating employee"}})},k=c(""),w=c(!1),b=c([]),le=async e=>{w.value=!0,await p(u.authToken).get("/api/hr/search/employee?&filter[search]="+e).then(a=>{w.value=!1,b.value=a.data,console.log("results.value",b.value)}).catch(a=>{w.value=!1,console.log("getEmployee",a)})},se=e=>{t.value=e,g.value=e.status,j.push({name:"SingleEmployee",params:{ecode:e.ecode}}).catch(a=>{})};pe(k,(e,a)=>{e!=a&&e.length>3&&le(k.value)});const P=c({data:{},loading:!1}),oe=()=>{n.value={dialog:!0,title:"Confirm Reopen",text:"Please confirm that you want to reopen the KPI for "+u.authProfile.email+".",btnColor:"primary",btnTitle:"Confirm"}},ne=async()=>{n.value={...n.value,loading:!0};let e={profile_id:u.authProfile.id,ecode:t.value.ecode,year:U.value};await p(u.authToken).post("/api/hr/employee/reopen",e).then(a=>{n.value={...n.value,loading:!1,dialog:!1},P.value.loading=!0,T().then(()=>{P.value.loading=!1,h.value={status:!0,type:"success",text:a.data.message}})}).catch(a=>{n.value={...n.value,loading:!1},h.value={status:!0,type:"error",text:"Error while updating employee"},console.log("getEmployee",a)})},n=c(),ie=e=>{n.value.title=="Confirm Status Update"?ae():n.value.title=="Confirm Reopen"&&ne()};return(e,a)=>(r(),m(me,{class:"pb-16"},{default:l(()=>[s(L,{class:"mt-5 justify-space-between"},{default:l(()=>[o("div",Ee,[s($,null,{activator:l(({props:i})=>[s(he,z(i,{modelValue:k.value,"onUpdate:modelValue":a[0]||(a[0]=d=>k.value=d),loading:w.value,variant:"outlined",density:"compact",class:"bg-white",label:"Search Employee","hide-details":"","append-inner-icon":S(ge)}),null,16,["modelValue","loading","append-inner-icon"])]),default:l(()=>[b.value.length>0?(r(),m(I,{key:0,density:"compact",style:{"max-height":"300px"}},{default:l(()=>[(r(!0),E(Y,null,F(b.value,(i,d)=>(r(),m(R,{key:d,onClick:()=>se(i)},{default:l(()=>[s(W,null,{default:l(()=>[_(v(i.display_name+" - "+i.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(r(),m(I,{key:1,density:"compact"},{default:l(()=>[s(R,null,{default:l(()=>[_(" No results found ")]),_:1})]),_:1}))]),_:1}),Te]),["hr_admin","app_admin"].includes(S(u).authProfile.role)?(r(),E("div",Ve,[o("div",null,[s($,null,{activator:l(({props:i})=>[s(O,z(i,{color:`${g.value=="Active"?"success":"error"}`,width:"120"}),{default:l(()=>[_(v(g.value),1)]),_:2},1040,["color"])]),default:l(()=>[s(I,{density:"compact"},{default:l(()=>[(r(!0),E(Y,null,F(H.value,(i,d)=>(r(),m(R,{key:d,onClick:()=>te(i)},{default:l(()=>[s(W,null,{default:l(()=>[s(ye,{size:"16",color:i.color,icon:S(xe)},null,8,["color","icon"]),_(" "+v(i.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),Pe])):A("",!0)]),_:1}),s(L,null,{default:l(()=>[o("div",Ie,[s(fe,{class:"elevation-0"},{default:l(()=>[s(_e,null,{default:l(()=>[s(L,null,{default:l(()=>[o("div",Re,[s(we,{profile:t.value},null,8,["profile"])]),o("div",Ae,[Le,o("div",Be,v(t.value.managed_by&&t.value.managed_by.display_name?t.value.managed_by.display_name:""),1)]),o("div",Ke,[Ne,o("div",Ue,v(t.value&&t.value.company?t.value.company.title:""),1)]),o("div",Me,[$e,o("div",ze,v(V.value.year),1)]),o("div",Fe,[Ye,o("div",Oe,v(ee(t.value))+"/100",1)]),["hr_admin","app_admin"].includes(S(u).authProfile.role)?(r(),E("div",We,[t.value.status=="Active"&&t.value.reviews&&(t.value.reviews.length>0&&(t.value.reviews[0].status=="closed"||t.value.reviews[0].status=="locked"||t.value.reviews[0].status=="submitted")||t.value.reviews.length==0&&(V.value.status=="closed"||V.value.status=="locked"))?(r(),m(O,{key:0,loading:P.value.loading,onClick:oe,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:l(()=>[_("Reopen")]),_:1},8,["loading"])):A("",!0)])):A("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),s(ke,{"selected-employee":t.value,"measures-list":K.value,"industry-list":x.value,"ecd-list":N.value,onErrorcheck:e.errorCheck,onYearchange:J,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list","onErrorcheck"]),s(be,{options:n.value,onConfirm:ie},null,8,["options"]),s(Ce,{options:h.value},null,8,["options"])]),_:1}))}};export{ot as default};
