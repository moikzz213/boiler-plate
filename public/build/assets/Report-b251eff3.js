import{a8 as Q,o as C,b as R,p as j,s as ee,r as _,C as B,A as m,k as te,u as se,c as U,w as v,V as ae,a as h,f as l,d as D,J as le,H as A,X as O,e as G,i as z,g as H,h as J,a3 as K,F as X,n as q,ao as ne,Z as Y,ap as oe,K as ie,I as re}from"./app-210ffff2.js";import{c as ue}from"./clientApi-91ccf4fd.js";import{e as de}from"./vue-datepicker-65e5987b.js";import{h as ce,k as pe}from"./mdi-5e26928d.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";var fe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function he(a,o){return o={exports:{}},a(o,o.exports),o.exports}var me=he(function(a,o){(function(t,i){a.exports=i()})(fe,function(){return function t(i,d,f){var c=window,u="application/octet-stream",w=f||u,r=i,y=!d&&!f&&r,b=document.createElement("a"),E=function(s){return String(s)},V=c.Blob||c.MozBlob||c.WebKitBlob||E,N=d||"download",x,T;if(V=V.call?V.bind(c):Blob,String(this)==="true"&&(r=[r,w],w=r[0],r=r[1]),y&&y.length<2048&&(N=y.split("/").pop().split("?")[0],b.href=y,b.href.indexOf(y)!==-1)){var k=new XMLHttpRequest;return k.open("GET",y,!0),k.responseType="blob",k.onload=function(s){t(s.target.response,N,u)},setTimeout(function(){k.send()},0),k}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(r))if(r.length>1024*1024*1.999&&V!==E)r=g(r),w=r.type||u;else return navigator.msSaveBlob?navigator.msSaveBlob(g(r),N):e(r);else if(/([\x80-\xff])/.test(r)){var p=0,$=new Uint8Array(r.length),L=$.length;for(p;p<L;++p)$[p]=r.charCodeAt(p);r=new V([$],{type:w})}x=r instanceof V?r:new V([r],{type:w});function g(s){var n=s.split(/[:;,]/),S=n[1],Z=n[2]=="base64"?atob:decodeURIComponent,M=Z(n.pop()),P=M.length,F=0,W=new Uint8Array(P);for(F;F<P;++F)W[F]=M.charCodeAt(F);return new V([W],{type:S})}function e(s,n){if("download"in b)return b.href=s,b.setAttribute("download",N),b.className="download-js-link",b.innerHTML="downloading...",b.style.display="none",document.body.appendChild(b),setTimeout(function(){b.click(),document.body.removeChild(b),n===!0&&setTimeout(function(){c.URL.revokeObjectURL(b.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(s)&&(s="data:"+s.replace(/^data:([\w\/\-\+]+)/,u)),window.open(s)||confirm(`Displaying New Document

Use Save As... to download, then click back to return to this page.`)&&(location.href=s),!0;var S=document.createElement("iframe");document.body.appendChild(S),!n&&/^data:/.test(s)&&(s="data:"+s.replace(/^data:([\w\/\-\+]+)/,u)),S.src=s,setTimeout(function(){document.body.removeChild(S)},333)}if(navigator.msSaveBlob)return navigator.msSaveBlob(x,N);if(c.URL)e(c.URL.createObjectURL(x),!0);else{if(typeof x=="string"||x.constructor===E)try{return e("data:"+w+";base64,"+c.btoa(x))}catch{return e("data:"+w+","+encodeURIComponent(x))}T=new FileReader,T.onload=function(s){e(this.result)},T.readAsDataURL(x)}return!0}})}),I=Q({props:{emitBlob:{type:Boolean,default:!1},debounce:{type:Number,default:500},type:{type:String,default:"xls"},data:{type:Array,required:!1,default:null},fields:{type:Object,default:()=>null},exportFields:{type:Object,default:()=>null},defaultValue:{type:String,required:!1,default:""},header:{default:null},perColumnsHeaders:{default:null},footer:{default:null},name:{type:String,default:"data.xls"},fetch:{type:Function},meta:{type:Array,default:()=>[]},worksheet:{type:String,default:"Sheet1"},beforeGenerate:{type:Function},beforeFinish:{type:Function},escapeCsv:{type:Boolean,default:!0},stringifyLongNum:{type:Boolean,default:!1}},setup(){return{isDisabled:_(!1)}},computed:{idName(){var a=new Date().getTime();return"export_"+a},downloadFields(){if(this.fields)return this.fields;if(this.exportFields)return this.exportFields}},methods:{async generate(){if(this.isDisabled)return;this.isDisabled=!0;const a=this.$props.debounce;let o=null;return new Promise((t,i)=>{const d=async()=>{typeof this.beforeGenerate=="function"&&await this.beforeGenerate();let c=this.data;if((typeof this.fetch=="function"||!c)&&(c=await this.fetch()),!c||!c.length){typeof this.beforeFinish=="function"&&await this.beforeFinish();return}let u=await this.getProcessedJson(c,this.downloadFields);return this.type==="html"?this.export(this.jsonToXLS(u),this.name.replace(".xls",".html"),"text/html"):this.type==="csv"?this.export(this.jsonToCSV(u),this.name.replace(".xls",".csv"),"application/csv"):this.export(this.jsonToXLS(u),this.name,"application/vnd.ms-excel")};(()=>{let c=this;o&&clearTimeout(o),o=setTimeout(()=>{d().then(t).catch(i),c.isDisabled=!1},a)})()})},export:async function(a,o,t){let i=this.base64ToBlob(a,t);typeof this.beforeFinish=="function"&&await this.beforeFinish(),this.emitBlob?this.$emit("blob",i):me(i,o,t)},jsonToXLS(a){let o='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta name=ProgId content=Excel.Sheet> <meta name=Generator content="Microsoft Excel 11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>${worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><style>br {mso-data-placement: same-cell;}</style></head><body><table>${table}</table></body></html>',t="<thead>";const i=Object.keys(a[0]).length;let d=this;const f=this.header||this.$attrs.title;f&&(t+=this.parseExtraData(f,'<tr><th colspan="'+i+'">${data}</th></tr>'));const c=this.perColumnsHeaders;if(Array.isArray(c)){t+="<tr>";for(let u in c)t+="<th>"+c[u]+"</th>";t+="</tr>"}t+="<tr>";for(let u in a[0])t+="<th>"+u+"</th>";return t+="</tr>",t+="</thead>",t+="<tbody>",a.map(function(u,w){t+="<tr>";for(let r in u)t+="<td>"+d.preprocessLongNum(d.valueReformattedForMultilines(u[r]))+"</td>";t+="</tr>"}),t+="</tbody>",this.footer!=null&&(t+="<tfoot>",t+=this.parseExtraData(this.footer,'<tr><td colspan="'+i+'">${data}</td></tr>'),t+="</tfoot>"),o.replace("${table}",t).replace("${worksheet}",this.worksheet)},jsonToCSV(a){let o=this;var t=[];const i=this.header||this.$attrs.title;i&&t.push(this.parseExtraData(i,"${data}\r\n"));const d=this.perColumnsHeaders;if(Array.isArray(d)){for(let f in d)t.push(d[f]),t.push(",");t.pop(),t.push(`\r
`)}for(let f in a[0])t.push(f),t.push(",");return t.pop(),t.push(`\r
`),a.map(function(f){for(let c in f){let u=f[c]+"";o.escapeCsv&&(u='="'+u+'"',u.match(/[,"\n]/)&&(u='"'+u.replace(/\"/g,'""')+'"')),t.push(u),t.push(",")}t.pop(),t.push(`\r
`)}),this.footer!=null&&t.push(this.parseExtraData(this.footer,"${data}\r\n")),t.join("")},async getProcessedJson(a,o){let t=this.getKeys(a,o),i=[],d=this;return await a.reduce(async function(f,c){await f;let u={};for(let w in t){let r=t[w];u[w]=await d.getValue(r,c)}return i.push(u),!0},[]),i},getKeys(a,o){if(o)return o;let t={};for(let i in a[0])t[i]=i;return t},parseExtraData(a,o){let t="";if(Array.isArray(a))for(var i=0;i<a.length;i++)a[i]&&(t+=o.replace("${data}",a[i]));else t+=o.replace("${data}",a);return t},async getValue(a,o){const t=typeof a!="object"?a:a.field;let i=typeof t!="string"?[]:t.split("."),d=this.defaultValue;return t?i.length>1?d=await this.getValueFromNestedItem(o,i):d=this.parseValue(o[t]):d=o,a.hasOwnProperty("callback")&&(d=await this.getValueFromCallback(d,a.callback)),d},valueReformattedForMultilines(a){return typeof a=="string"?a.replace(/\n/gi,"<br/>"):a},preprocessLongNum(a){if(this.stringifyLongNum){if(String(a).startsWith("0x"))return a;if(!isNaN(a)&&a!=""&&(a>99999999999||a<1e-13))return'="'+a+'"'}return a},getValueFromNestedItem(a,o){let t=a;for(let i of o)t&&(t=t[i]);return this.parseValue(t)},async getValueFromCallback(a,o){if(typeof o!="function")return this.defaultValue;const t=await o(a);return this.parseValue(t)},parseValue(a){return a||a===0||typeof a=="boolean"?a:this.defaultValue},base64ToBlob(a,o){let t=window.btoa(window.unescape(encodeURIComponent(a))),i=atob(t),d=i.length,f=new Uint8ClampedArray(d);for(;d--;)f[d]=i.charCodeAt(d);return new Blob([f],{type:o})}}});const ve=["id"];function ye(a,o,t,i,d,f){return C(),R("div",{id:a.idName,onClick:o[0]||(o[0]=(...c)=>a.generate&&a.generate(...c)),style:ee(a.isDisabled?{opacity:"0.5","pointer-events":"none"}:{})},[j(a.$slots,"default",{},()=>[B(" Download "+m(a.name),1)])],12,ve)}I.render=ye;I.__file="JsonExcel.vue";const be={class:"v-col-12 v-col-md-2"},ge={class:"v-col-12 v-col-md-2"},we={class:"v-col-12 v-col-md-3"},ke={class:"d-flex justify-space-between"},_e={class:"v-col-12 v-col-md-2 my-auto text-right"},xe={class:"v-col-12"},Ce=l("thead",null,[l("tr",null,[l("th",{class:"text-center"},"#"),l("th",{class:"text-left"},"Entity"),l("th",{class:"text-center"},"Status"),l("th",{class:"text-center"},"Locked"),l("th",{class:"text-center"},"Open"),l("th",{class:"text-center"},"InProgress"),l("th",{class:"text-center"},"InReview"),l("th",{class:"text-center"},"Submitted")])],-1),Ve={key:0},Se={class:"text-center"},Ne={class:"text-left"},Re={class:"text-center text-capitalize py-2"},Te=["onClick"],Ee=["onClick"],$e=["onClick"],Fe=["onClick"],De=["onClick"],Ae=l("th",{colspan:"3",class:"text-right"},"Total",-1),Be={class:"text-center"},Ie={class:"text-center"},Le={class:"text-center"},Ue={class:"text-center"},Oe={class:"text-center"},Ge={key:1},Me=l("tr",null,[l("td",{colspan:"8",class:"text-center"}," No record found. ")],-1),Pe=[Me],We={class:"text-center"},ze={class:"text-uppercase"},He=l("thead",null,[l("tr",null,[l("th",null,"#"),l("th",null,"Emp.ID"),l("th",null,"Emp.Name"),l("th",null,"Manager"),l("th",null,"Job Title"),l("th",null,"Department"),l("th",null,"Email")])],-1),Je={key:0},je={__name:"Report",setup(a){const o=te(),t=se(),i=_(new Date().getFullYear()),d=_([{value:1,title:"Regular"},{value:0,title:"Probation"}]),f=_({loadingFilter:!1,data:{company_id:null,is_regular:1}}),c=async()=>{f.value.loadingFilter=!0,$().then(()=>{f.value.loadingFilter=!1}).catch(g=>{f.value.loadingFilter=!1})},u=_(!1),w=_(""),r=_([]),y=_([]),b=(g,e,s)=>{u.value=!0,w.value=e,r.value=g,r.value.statusReview=s},E=async()=>r.value,V=async()=>y.value,N=_({EmpID:"ecode",EmpName:"display_name",Manager:{field:"managed_by.display_name",callback:g=>`${g}`},JobTitle:"designation",Company:{field:"company.title",callback:g=>`${g}`},Department:"department",Email:"email",Status:"statusReview"}),x=_([]),T=_([]),k=_([]),p=_({lock:0,open:0,inprogress:0,inreview:0,submitted:0}),$=async()=>{let g="/api/reports/business-entity/kpi-employees?&filter[is_regular]="+f.value.data.is_regular+"&year="+i.value+"&filter[hrbp_email]="+t.authProfile.email;await ue(t.authToken).get(g).then(e=>{x.value=e.data,e.data&&e.data.length>0&&(e.data.map((s,n)=>{T.value.includes(s.company_id)||(T.value.push(s.company_id),k.value.push({id:s.company_id,title:s.company.title}))}),y.value=[],p.value={lock:0,open:0,inprogress:0,inreview:0,submitted:0},L())}).catch(e=>{console.log("getEmployees",e)})},L=()=>{let g={};k.value&&k.value.length>0&&k.value.map((e,s)=>{g=o.filterAllSettings(e.id,i.value),g.state?(e.state=g.state,e.status=g.status,e.sort=s):(e.state="no-setting",e.status="locked",e.sort=99),e.lock="-",e.open="-",e.inprogress="-",e.inreview="-",e.submitted="-",e.employees={open:[],locked:[],inprogress:[],inreview:[],submitted:[]},x.value.map(n=>{n.company_id==e.id&&(n.reviews.length>0?n.reviews[0].status&&(n.reviews[0].status=="locked"||n.reviews[0].status=="closed")?(e.lock=isNaN(e.lock)?0:e.lock,e.lock=parseInt(e.lock)+1,p.value.lock=p.value.lock+1,e.employees.locked.push(n),n.statusReview="locked",y.value.push(n)):n.reviews[0].status&&n.reviews[0].status=="open"?(e.open=isNaN(e.open)?0:e.open,e.open=parseInt(e.open)+1,p.value.open=p.value.open+1,e.employees.open.push(n),n.statusReview="open",y.value.push(n)):n.reviews[0].status&&n.reviews[0].status=="inprogress"?(e.inprogress=isNaN(e.inprogress)?0:e.inprogress,e.inprogress=parseInt(e.inprogress)+1,p.value.inprogress=p.value.inprogress+1,e.employees.inprogress.push(n),n.statusReview="inprogress",y.value.push(n)):n.reviews[0].status&&n.reviews[0].status=="inreview"?(e.inreview=isNaN(e.inreview)?0:e.inreview,e.inreview=parseInt(e.inreview)+1,p.value.inreview=p.value.inreview+1,e.employees.inreview.push(n),n.statusReview="inreview",y.value.push(n)):n.reviews[0].status&&n.reviews[0].status=="submitted"&&(e.submitted=isNaN(e.submitted)?0:e.submitted,e.submitted=parseInt(e.submitted)+1,p.value.submitted=p.value.submitted+1,e.employees.submitted.push(n),n.statusReview="submitted",y.value.push(n)):e.state=="no-setting"?(e.lock=isNaN(e.lock)?0:e.lock,e.lock=parseInt(e.lock)+1,p.value.lock=p.value.lock+1,e.employees.locked.push(n)):e.status=="closed"||e.status=="locked"?(e.lock=isNaN(e.lock)?0:e.lock,e.lock=parseInt(e.lock)+1,p.value.lock=p.value.lock+1,e.employees.locked.push(n),n.statusReview="locked",y.value.push(n)):(e.open=isNaN(e.open)?0:e.open,e.open=parseInt(e.open)+1,p.value.open=p.value.open+1,e.employees.open.push(n),n.statusReview="open",y.value.push(n)))})}),k.value.sort((e,s)=>e.sort-s.sort)};return(g,e)=>(C(),U(ae,{class:"pb-16"},{default:v(()=>[h(z,{class:"mt-5"},{default:v(()=>[l("div",be,[h(D(de),{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=s=>i.value=s),"year-picker":"",class:"pms-date-picker"},null,8,["modelValue"])]),l("div",ge,[h(le,{modelValue:f.value.data.is_regular,"onUpdate:modelValue":e[1]||(e[1]=s=>f.value.data.is_regular=s),items:d.value,"item-title":"title","item-value":"value",variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),l("div",we,[l("div",ke,[h(A,{onClick:c,height:"40px",color:"secondary",class:"text-capitalize",loading:f.value.loadingFilter},{default:v(()=>[B("Generate Report")]),_:1},8,["loading"])])]),h(O),l("div",_e,[y.value.length>0?(C(),U(D(I),{key:0,fetch:V,fields:N.value,worksheet:"Report",name:"PMS-Report.csv",type:"csv",disabled:""},{default:v(()=>[h(A,{size:"small",color:"green",disabled:Object.keys(y.value).length==0,dark:""},{default:v(()=>[B(" Download ")]),_:1},8,["disabled"])]),_:1},8,["fields"])):G("",!0)])]),_:1}),h(z,null,{default:v(()=>[l("div",xe,[h(H,{class:"mb-3 elevation-0"},{default:v(()=>[h(J,null,{default:v(()=>[h(K,{density:"compact"},{default:v(()=>[Ce,k.value.length>0?(C(),R("tbody",Ve,[(C(!0),R(X,null,q(k.value,(s,n)=>(C(),R("tr",{key:s.id},[l("td",Se,m(n+=1),1),l("td",Ne,m(s.title),1),l("td",Re,[l("span",{class:re(`${s.state=="no-setting"?"text-error":"text-info"}`)},m(s.state=="no-setting"?"( No Setting )":"( "+s.state+" - "+s.status+" )"),3)]),l("td",{class:"text-center cursor-pointer",onClick:S=>b(s.employees.locked,s.title,"locked")},m(s.lock),9,Te),l("td",{class:"text-center cursor-pointer",onClick:S=>b(s.employees.open,s.title,"open")},m(s.open),9,Ee),l("td",{class:"text-center cursor-pointer",onClick:S=>b(s.employees.inprogress,s.title,"inprogress")},m(s.inprogress),9,$e),l("td",{class:"text-center cursor-pointer",onClick:S=>b(s.employees.inreview,s.title,"inreview")},m(s.inreview),9,Fe),l("td",{class:"text-center cursor-pointer",onClick:S=>b(s.employees.submitted,s.title,"submitted")},m(s.submitted),9,De)]))),128)),l("tr",null,[Ae,l("td",Be,m(p.value.lock),1),l("td",Ie,m(p.value.open),1),l("td",Le,m(p.value.inprogress),1),l("td",Ue,m(p.value.inreview),1),l("td",Oe,m(p.value.submitted),1)])])):(C(),R("tbody",Ge,Pe))]),_:1})]),_:1})]),_:1})])]),_:1}),l("div",We,[h(ie,{modelValue:u.value,"onUpdate:modelValue":e[4]||(e[4]=s=>u.value=s),width:"auto"},{default:v(()=>[h(H,null,{default:v(()=>[h(ne,{dark:"",color:"primary"},{default:v(()=>[h(A,{icon:"",dark:"",onClick:e[2]||(e[2]=s=>u.value=!1)},{default:v(()=>[h(Y,{size:"16",icon:D(ce)},null,8,["icon"])]),_:1}),h(O),l("div",ze,m(w.value)+" - ( "+m(r.value.statusReview)+" )",1),h(O),r.value.length>0?(C(),U(D(I),{key:0,fetch:E,fields:N.value,worksheet:"Report",name:"PMS-Report.csv",type:"csv",disabled:"",class:"mr-3"},{default:v(()=>[h(A,{color:"green",icon:"",disabled:Object.keys(r.value).length==0,dark:""},{default:v(()=>[h(Y,{size:"32",icon:D(pe)},null,8,["icon"])]),_:1},8,["disabled"])]),_:1},8,["fields"])):G("",!0)]),_:1}),h(J,null,{default:v(()=>[h(K,{density:"compact"},{default:v(()=>[He,r.value&&r.value.length>0?(C(),R("tbody",Je,[(C(!0),R(X,null,q(r.value,(s,n)=>(C(),R("tr",{key:s.id},[l("td",null,m(n+1),1),l("td",null,m(s.ecode),1),l("td",null,m(s.display_name),1),l("td",null,m(s.managed_by?s.managed_by.display_name:""),1),l("td",null,m(s.designation),1),l("td",null,m(s.department),1),l("td",null,m(s.email),1)]))),128))])):G("",!0)]),_:1})]),_:1}),h(oe,null,{default:v(()=>[h(A,{color:"primary",block:"",onClick:e[3]||(e[3]=s=>u.value=!1)},{default:v(()=>[B("Close")]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),_:1}))}};export{je as default};
