import{z as G,L as J,r as o,u as Q,k as X,M as Z,l as ee,c as M,w as p,V as te,o as C,a as c,f as i,N as ae,g as se,h as le,i as E,A as f,d as ie,H as oe,C as ne,e as re}from"./app-56316e13.js";import{_ as ue}from"./KpiContent-fbbe8e2e.js";import{_ as ce}from"./EmployeeCard-54f24b1c.js";import{c as d}from"./clientApi-a50ddd96.js";import{u as de}from"./industry-cc1f9477.js";import{_ as ve}from"./SnackBar-dbbb3b67.js";import"./mdi-7fd0807e.js";import"./vue-datepicker-d6108a9f.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const me={class:"v-col-12 v-col-md-3"},pe={class:"v-col-12"},he={class:"v-col-12 v-col-md-3 d-flex align-center"},_e={class:"v-col-12 v-col-md-2 d-flex flex-column"},fe=i("div",{class:"text-caption text-grey"}," Reporting To ",-1),ge={class:"text-body-2"},ye={class:"v-col-12 v-col-md-2 d-flex flex-column"},we=i("div",{class:"text-caption text-grey"}," Business Unit ",-1),xe={class:"text-body-2"},be={class:"v-col-12 v-col-md-2 d-flex flex-column"},ke=i("div",{class:"text-caption text-grey"}," KPI's Target Year ",-1),Se={class:"text-body-2"},Pe={class:"v-col-12 v-col-md-1 d-flex flex-column"},Te=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),Ve={class:"text-body-2"},De={class:"v-col-12 v-col-md-2 d-flex align-center"},We={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(Ie){const R=G(),B=J(),S=o(B.params.id),s=Q(),K=X(),g=de(),h=o({}),N=s.authProfile.display_name,m=o([]),y=o(S.value),t=o({}),L=()=>{t.value=y.value,R.push({name:"SingleTeamMember",params:{id:y.value.ecode}}).catch(e=>{})},P=o(0),A=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((l,n)=>{a+=l.weightage}),P.value=a,a},u=o([]),O=async()=>{g.industries.length==0?g.getIndustries(s.authToken).then(()=>{u.value=g.industries}):u.value=g.industries},_=o([]),b=o([]),j=async()=>{await d(s.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{u.value&&u.value.length>0&&e.data&&e.data.length>0&&u.value.map((a,l)=>{_.value[l]=a,_.value[l].kpis=[];let n=0,v=0;e.data.map((x,Me)=>{a.id==x.industry_id?(_.value[l].kpis[n]=x,n++):x.type=="ecd"&&(b.value[v]=x,v++)})})})},z=async()=>{await d(s.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+s.authProfile.ecode).then(e=>{u.value&&u.value.length>0&&e.data&&e.data.length>0&&u.value.map((a,l)=>{let n=0;e.data.map(v=>{a.id==v.industry_id?a.kpis.unshift(v):v.type=="ecd"&&(b.value[n]=v,n++)})}),console.log("ecdList.value",_.value)})},k=o(!1),T=o(!1),W=()=>{k.value=!0;let e="inprogress",a=t.value.reviews[0].id;if(!a)return h.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.is_regular&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?e="inreview":e="submitted":(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(e="submitted");let l={reviewID:a,newStatus:e,user_ecode:s.authProfile.ecode,managerEmail:s.authProfile.email,managerName:s.authProfile.display_name,allowedDays:t.value.is_regular?r.value.employee_review_allowed_days:r.value.probation_kpi_setting,closingDateSetting:t.value.is_regular?r.value.annual_kpi_setting_end:r.value.probation_kpi_setting,closingDateMid:t.value.is_regular?r.value.mid_year_review_end:r.value.probation_first_review_end,closingDateFinal:t.value.is_regular?r.value.end_year_review_end:r.value.probation_final_review_end};d(s.authToken).post("/api/manager/employee-kpi/submit",l).then(n=>{h.value={status:!0,type:"success",text:n.data.message},m.value=n.data.profile.teams,s.setProfile(n.data.profile).then(()=>{w(),setTimeout(()=>{k.value=!1,T.value=!0},2e3)})}).catch(n=>{})},V=o(!1),Y=e=>{V.value=e.hasError},$=e=>{let a={id:e.id,user_ecode:s.authProfile.ecode};d(s.authToken).post("/api/delete/employee-kpi-year",a).then(l=>{m.value=l.data.profile.teams,s.setProfile(l.data.profile).then(()=>{w(),h.value={status:!0,type:"success",text:l.data.message}})}).catch(l=>{})},F=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:s.authProfile.ecode};d(s.authToken).post("/api/create/employee-kpi-year",a).then(l=>{h.value={status:!0,type:"success",text:l.data.message},m.value=l.data.profile.teams,s.setProfile(l.data.profile).then(()=>{w()})}).catch(l=>{})},U=e=>{D(e)},D=async e=>{await d(s.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},I=o([]),H=async()=>{await d(s.authToken).get("/api/fetch/measures/non-paginated").then(e=>{I.value=e.data}).catch(e=>{})},w=()=>{t.value={};let e=m.value.filter(a=>a.username==S.value);t.value=Object.assign({},e[0]),D(2023)},r=Z(()=>K.filteredSetting(t.value.company_id)),q=async()=>{await d(s.authToken).get("/api/fetch/team-members/"+s.authProfile.ecode).then(e=>{m.value=e.data}).catch(e=>{})};return ee(()=>{q().then(()=>{w(),O().then(()=>{j().then(()=>{z().then(()=>{H()})})})})}),(e,a)=>(C(),M(te,{class:"pb-16",style:{"max-width":"95%"}},{default:p(()=>[c(E,{class:"my-5"},{default:p(()=>[i("div",me,[c(ae,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=l=>y.value=l),L],items:m.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),i("div",pe,[c(se,{class:"mb-3 elevation-0"},{default:p(()=>[c(le,null,{default:p(()=>[c(E,null,{default:p(()=>[i("div",he,[c(ce,{profile:t.value},null,8,["profile"])]),i("div",_e,[fe,i("div",ge,f(ie(N)),1)]),i("div",ye,[we,i("div",xe,f(t.value.company&&t.value.company.title),1)]),i("div",be,[ke,i("div",Se,f(r.value.year),1)]),i("div",Pe,[Te,i("div",Ve,f(A(t.value))+"/100 ",1)]),i("div",De,[!V.value&&P.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(C(),M(oe,{key:0,size:"large",onClick:W,loading:k.value,block:"",disabled:T.value,color:"secondary",class:"text-capitalize rounded-lg text-md-caption text-lg-body-2"},{default:p(()=>[ne(f(t.value.is_regular&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading","disabled"])):re("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),c(ue,{"selected-employee":t.value,"measures-list":I.value,"industry-list":_.value,"ecd-list":b.value,onSavedResponse:F,onErrorcheck:Y,onYearchange:U,onRemoveKPI:$,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list"]),c(ve,{options:h.value},null,8,["options"])]),_:1}))}};export{We as default};
