import{u as Y,k as q,z as J,K as Q,r as c,L as Z,N as ee,c as p,w as a,V as te,o as u,a as l,f as o,R as P,G as ae,S as A,d as w,T as S,b as k,n as I,F as B,U as V,C as f,H as N,A as d,e as E,i as T,g as le,h as oe,W as U,X as se}from"./app-46de97c2.js";import{c as b}from"./clientApi-74ee0ab3.js";import{m as ne,a as ie}from"./mdi-a0a77bee.js";import{_ as ce}from"./KpiContent-79c1a0ef.js";import{_ as ue}from"./EmployeeCard-8bb85188.js";import{_ as re}from"./ConfirmDialog-79f19fcb.js";import{_ as de}from"./SnackBar-c22714db.js";import"./vue-datepicker-79e0f2c3.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const ve={class:"v-col-12 v-col-md-3 pb-0"},pe=o("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),me={key:0,class:"v-col-12 v-col-md-3 text-right pb-0"},_e=o("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"},"Employee Status",-1),fe={class:"v-col-12"},ge={class:"v-col-12 v-col-md-3 d-flex align-center"},he={class:"v-col-12 v-col-md-2 d-flex flex-column"},ye=o("div",{class:"text-caption text-grey"},"Reporting To",-1),xe={class:"text-body-2"},we={class:"v-col-12 v-col-md-2 d-flex flex-column"},ke=o("div",{class:"text-caption text-grey"},"Business Unit",-1),be={class:"text-body-2"},Ce={class:"v-col-12 v-col-md-2 d-flex flex-column"},Se=o("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),Ve={class:"text-body-2"},Ee={class:"v-col-12 v-col-md-1 d-flex flex-column"},Te=o("div",{class:"text-caption text-grey"},"Total KPI",-1),Re={class:"text-body-2"},Pe={key:0,class:"v-col-12 v-col-md-2 d-flex align-center"},We={__name:"SingleEmployee",setup(Ae){const r=Y(),L=q(),$=J(),z=Q(),m=c({}),g=c("Active"),R=c(""),K=c([{title:"Active",color:"success"},{title:"Inactive",color:"error"}]),F=e=>{let n=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((i,v)=>{n+=i.weightage}),n},t=c({}),C=async()=>{await b(r.authToken).get("/api/hr/employee/ecode/"+z.params.ecode).then(e=>{t.value=e.data,g.value=e.data.status}).catch(e=>{console.log("getEmployee",e)})},M=Z(()=>L.filteredSetting(t.value.company_id));C();const O=e=>{R.value=e.title,s.value={dialog:!0,title:"Confirm Status Update",text:"Please confirm that you want to update the status of "+t.value.display_name+" into "+e.title+".",btnColor:e.title=="Active"?"success":"error",btnTitle:"Confirm"}},W=async()=>{let e={ecode:t.value.ecode,status:R.value};s.value={...s.value,loading:!0},await b(r.authToken).post("/api/hr/employee/status/update",e).then(n=>{C().then(()=>{s.value={...s.value,loading:!1,dialog:!1},m.value={status:!0,type:"success",text:n.data.message}})}).catch(n=>{console.log("getEmployee",n),s.value={...s.value,loading:!1},m.value={status:!0,type:"error",text:"Error while updating employee"}})},h=c(""),y=c(!1),x=c([]),j=async e=>{y.value=!0,await b(r.authToken).get("/api/hr/search/employee?&filter[search]="+e).then(n=>{y.value=!1,x.value=n.data,console.log("results.value",x.value)}).catch(n=>{y.value=!1,console.log("getEmployee",n)})},D=e=>{t.value=e,g.value=e.status,$.push({name:"SingleEmployee",params:{ecode:e.ecode}}).catch(n=>{})};ee(h,(e,n)=>{e!=n&&e.length>3&&j(h.value)});const _=c({data:{},loading:!1}),G=()=>{s.value={dialog:!0,title:"Confirm Reopen",text:"Please confirm that you want to reopen the KPI for "+r.authProfile.email+".",btnColor:"primary",btnTitle:"Confirm"}},H=async()=>{_.value.data={ecode:t.value.ecode},s.value={...s.value,loading:!0},await b(r.authToken).post("/api/hr/employee/reopen",_.value.data).then(e=>{s.value={...s.value,loading:!1,dialog:!1},_.value.loading=!0,C().then(()=>{_.value.loading=!1,m.value={status:!0,type:"success",text:e.data.message}})}).catch(e=>{s.value={...s.value,loading:!1},m.value={status:!0,type:"error",text:"Error while updating employee"},console.log("getEmployee",e)})},s=c(),X=e=>{s.value.title=="Confirm Status Update"?W():s.value.title=="Confirm Reopen"&&H()};return(e,n)=>(u(),p(te,{class:"pb-16"},{default:a(()=>[l(T,{class:"mt-5 justify-space-between"},{default:a(()=>[o("div",ve,[l(P,null,{activator:a(({props:i})=>[l(ae,A(i,{modelValue:h.value,"onUpdate:modelValue":n[0]||(n[0]=v=>h.value=v),loading:y.value,variant:"outlined",density:"compact",class:"bg-white",label:"Search Employee","hide-details":"","append-inner-icon":w(ne)}),null,16,["modelValue","loading","append-inner-icon"])]),default:a(()=>[x.value.length>0?(u(),p(S,{key:0,density:"compact",style:{"max-height":"300px"}},{default:a(()=>[(u(!0),k(B,null,I(x.value,(i,v)=>(u(),p(V,{key:v,onClick:()=>D(i)},{default:a(()=>[l(U,null,{default:a(()=>[f(d(i.display_name+" - "+i.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(u(),p(S,{key:1,density:"compact"},{default:a(()=>[l(V,null,{default:a(()=>[f(" No results found ")]),_:1})]),_:1}))]),_:1}),pe]),["hr_admin","app_admin"].includes(w(r).authProfile.role)?(u(),k("div",me,[o("div",null,[l(P,null,{activator:a(({props:i})=>[l(N,A(i,{color:`${g.value=="Active"?"success":"error"}`,width:"120"}),{default:a(()=>[f(d(g.value),1)]),_:2},1040,["color"])]),default:a(()=>[l(S,{density:"compact"},{default:a(()=>[(u(!0),k(B,null,I(K.value,(i,v)=>(u(),p(V,{key:v,onClick:()=>O(i)},{default:a(()=>[l(U,null,{default:a(()=>[l(se,{size:"16",color:i.color,icon:w(ie)},null,8,["color","icon"]),f(" "+d(i.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_e])):E("",!0)]),_:1}),l(T,null,{default:a(()=>[o("div",fe,[l(le,{class:"elevation-0"},{default:a(()=>[l(oe,null,{default:a(()=>[l(T,null,{default:a(()=>[o("div",ge,[l(ue,{profile:t.value},null,8,["profile"])]),o("div",he,[ye,o("div",xe,d(t.value.managed_by&&t.value.managed_by.display_name?t.value.managed_by.display_name:""),1)]),o("div",we,[ke,o("div",be,d(t.value&&t.value.company?t.value.company.title:""),1)]),o("div",Ce,[Se,o("div",Ve,d(M.value.year),1)]),o("div",Ee,[Te,o("div",Re,d(F(t.value))+"/100",1)]),["hr_admin","app_admin"].includes(w(r).authProfile.role)?(u(),k("div",Pe,[t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="closed"||t.value.reviews[0].status=="locked"||t.value.reviews[0].status=="submitted")?(u(),p(N,{key:0,loading:_.value.loading,onClick:G,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:a(()=>[f("Reopen")]),_:1},8,["loading"])):E("",!0)])):E("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),l(ce,{"selected-employee":t.value},null,8,["selected-employee"]),l(re,{options:s.value,onConfirm:X},null,8,["options"]),l(de,{options:m.value},null,8,["options"])]),_:1}))}};export{We as default};
