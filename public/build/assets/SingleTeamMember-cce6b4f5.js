import{z as G,K as J,r as o,u as Q,k as X,L as Z,l as ee,c as M,w as p,V as te,o as E,a as c,f as i,M as ae,g as se,h as le,i as R,A as _,d as ie,H as oe,C as ne,e as re}from"./app-29ce0671.js";import{_ as ue}from"./KpiContent-40017988.js";import{_ as ce}from"./EmployeeCard-b0ccbc9a.js";import{c as d}from"./clientApi-dd495a93.js";import{u as de}from"./industry-fd010769.js";import{_ as ve}from"./SnackBar-164ead4f.js";import"./mdi-1daeeafa.js";import"./vue-datepicker-c06cb8b3.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const me={class:"v-col-12 v-col-md-3"},pe={class:"v-col-12"},he={class:"v-col-12 v-col-md-3 d-flex align-center"},_e={class:"v-col-12 v-col-md-2 d-flex flex-column"},ge=i("div",{class:"text-caption text-grey"}," Reporting To ",-1),fe={class:"text-body-2"},ye={class:"v-col-12 v-col-md-2 d-flex flex-column"},we=i("div",{class:"text-caption text-grey"}," Business Unit ",-1),xe={class:"text-body-2"},be={class:"v-col-12 v-col-md-2 d-flex flex-column"},ke=i("div",{class:"text-caption text-grey"}," KPI's Target Year ",-1),Se={class:"text-body-2"},Pe={class:"v-col-12 v-col-md-1 d-flex flex-column"},Te=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),Ve={class:"text-body-2"},De={class:"v-col-12 v-col-md-2 d-flex align-center"},We={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(Ie){const C=G(),K=J(),b=o(K.params.id),l=Q(),B=X(),g=de(),h=o({}),N=l.authProfile.display_name,v=o([]),f=o(b.value),t=o({}),A=()=>{t.value=f.value,C.push({name:"SingleTeamMember",params:{id:f.value.ecode}}).catch(e=>{})},k=o(0),L=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,n)=>{a+=s.weightage}),k.value=a,a},u=o([]),O=async()=>{g.industries.length==0?g.getIndustries(l.authToken).then(()=>{u.value=g.industries}):u.value=g.industries},m=o([]),S=o([]),j=async()=>{await d(l.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{u.value&&u.value.length>0&&e.data&&e.data.length>0&&u.value.map((a,s)=>{m.value[s]=a,m.value[s].kpis=[];let n=0,I=0;e.data.map((w,Me)=>{a.id==w.industry_id?(m.value[s].kpis[n]=w,n++):w.type=="ecd"&&(S.value[I]=w,I++)})})})},z=async()=>{await d(l.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+l.authProfile.ecode).then(e=>{u.value&&u.value.length>0&&e.data&&e.data.length>0&&u.value.map((a,s)=>{e.data.map(n=>{a.id==n.industry_id&&(m.value[s].kpis[m.value[s].kpis.length]=n)})})})},x=o(!1),P=o(!1),W=()=>{x.value=!0;let e="inprogress",a=t.value.reviews[0].id;if(!a)return h.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.is_regular&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?e="inreview":e="submitted":(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(e="submitted");let s={reviewID:a,newStatus:e,user_ecode:l.authProfile.ecode,managerEmail:l.authProfile.email,managerName:l.authProfile.display_name,allowedDays:t.value.is_regular?r.value.employee_review_allowed_days:r.value.probation_kpi_setting,closingDateSetting:t.value.is_regular?r.value.annual_kpi_setting_end:r.value.probation_kpi_setting,closingDateMid:t.value.is_regular?r.value.mid_year_review_end:r.value.probation_first_review_end,closingDateFinal:t.value.is_regular?r.value.end_year_review_end:r.value.probation_final_review_end};d(l.authToken).post("/api/manager/employee-kpi/submit",s).then(n=>{h.value={status:!0,type:"success",text:n.data.message},v.value=n.data.profile.teams,l.setProfile(n.data.profile).then(()=>{y(),setTimeout(()=>{x.value=!1,P.value=!0},2e3)})}).catch(n=>{})},T=o(!1),Y=e=>{T.value=e.hasError},$=e=>{let a={id:e.id,user_ecode:l.authProfile.ecode};d(l.authToken).post("/api/delete/employee-kpi-year",a).then(s=>{v.value=s.data.profile.teams,l.setProfile(s.data.profile).then(()=>{y(),h.value={status:!0,type:"success",text:s.data.message}})}).catch(s=>{})},F=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:l.authProfile.ecode};d(l.authToken).post("/api/create/employee-kpi-year",a).then(s=>{h.value={status:!0,type:"success",text:s.data.message},v.value=s.data.profile.teams,l.setProfile(s.data.profile).then(()=>{y()})}).catch(s=>{})},U=e=>{V(e)},V=async e=>{await d(l.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},D=o([]),H=async()=>{await d(l.authToken).get("/api/fetch/measures/non-paginated").then(e=>{D.value=e.data}).catch(e=>{})},y=()=>{t.value={};let e=v.value.filter(a=>a.username==b.value);t.value=Object.assign({},e[0]),V(2023)},r=Z(()=>B.filteredSetting(t.value.company_id)),q=async()=>{await d(l.authToken).get("/api/fetch/team-members/"+l.authProfile.ecode).then(e=>{v.value=e.data}).catch(e=>{})};return ee(()=>{q().then(()=>{y(),O().then(()=>{j().then(()=>{z().then(()=>{H()})})})})}),(e,a)=>(E(),M(te,{class:"pb-16",style:{"max-width":"95%"}},{default:p(()=>[c(R,{class:"my-5"},{default:p(()=>[i("div",me,[c(ae,{modelValue:f.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>f.value=s),A],items:v.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),i("div",pe,[c(se,{class:"mb-3 elevation-0"},{default:p(()=>[c(le,null,{default:p(()=>[c(R,null,{default:p(()=>[i("div",he,[c(ce,{profile:t.value},null,8,["profile"])]),i("div",_e,[ge,i("div",fe,_(ie(N)),1)]),i("div",ye,[we,i("div",xe,_(t.value.company&&t.value.company.title),1)]),i("div",be,[ke,i("div",Se,_(r.value.year),1)]),i("div",Pe,[Te,i("div",Ve,_(L(t.value))+"/100 ",1)]),i("div",De,[!T.value&&k.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(E(),M(oe,{key:0,size:"large",onClick:W,loading:x.value,block:"",disabled:P.value,color:"secondary",class:"text-capitalize rounded-lg text-md-caption text-lg-body-2"},{default:p(()=>[ne(_(t.value.is_regular&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading","disabled"])):re("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),c(ue,{"selected-employee":t.value,"measures-list":D.value,"industry-list":m.value,"ecd-list":S.value,onSavedResponse:F,onErrorcheck:Y,onYearchange:U,onRemoveKPI:$,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list"]),c(ve,{options:h.value},null,8,["options"])]),_:1}))}};export{We as default};
