import{k as L,r as d,o as r,b as m,F as R,n as N,c as T,w as i,f as o,H as b,C as p,A as g,e as _,a as s,g as S,h as P,i as $,I as U,d as j,z as Z,u as ee,V as te,G as le,E as ae,J as se,K as A,s as oe}from"./app-56316e13.js";import H from"./KpiProgress-2783f471.js";import{_ as G}from"./EmployeeCard-54f24b1c.js";import{c as I}from"./clientApi-a50ddd96.js";import{_ as ie}from"./SnackBar-dbbb3b67.js";import"./printInitials-a54a9c4a.js";import"./mdi-7fd0807e.js";const ne={class:"d-flex align-center w-100"},re={style:{width:"25px"}},de={style:{width:"100%"}},ce={key:0,class:"mb-2",style:{color:"white","font-size":"8px","line-height":"8px",padding:"4px 10px",display:"inline-block","text-transform":"uppercase","background-color":"#2196f3",position:"absolute",top:"0",left:"0"}},ue={class:"v-col-12 v-col-md-8"},me={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},ve={key:0},pe=o("div",{class:"text-caption text-grey"}," Total KPI ",-1),W={__name:"SubTeams",props:{user:{type:Object,default:null}},setup(F){const K=F,V=L(),C=n=>{let w=0;return n.reviews&&n.reviews.length>0&&n.reviews[0].key_review&&n.reviews[0].key_review.map((l,c)=>{w+=l.weightage}),w},u=d(K.user),f=d(0),v=n=>{n.sign?n.sign=="+"?(n.sign="-",f.value+=1):(n.sign="+",D(n)):(n.sign="-",f.value+=1),console.log(u.value)},D=n=>{Object.assign([],n).teams.map((l,c)=>{l.sign="+",l.teams&&l.teams.length>0&&D(l)})};return(n,w)=>(r(),m("div",null,[(r(!0),m(R,null,N(u.value.teams,l=>(r(),T($,{class:"v-col-12 py-0 my-0 ml-3",key:l.id},{default:i(()=>[o("div",ne,[o("div",re,[l.teams&&l.teams.length>0?(r(),T(b,{key:0,onClick:c=>v(l),class:"",color:"primary",size:"25"},{default:i(()=>[p(g(l.sign?l.sign:"+"),1)]),_:2},1032,["onClick"])):_("",!0)]),o("div",de,[s(S,{width:"100%",class:"mb-1 elevation-0"},{default:i(()=>[s(P,{style:{position:"relative"}},{default:i(()=>[l.is_regular==!1?(r(),m("div",ce," Probation Employee ")):_("",!0),s($,null,{default:i(()=>[o("div",{class:U(`v-col-12 ${l.is_regular==!1?"pt-6":""} v-col-md-3`)},[s(G,{profile:l},null,8,["profile"])],2),o("div",ue,[s(H,{density:"compact","selected-employee":l},null,8,["selected-employee"])]),o("div",me,[j(V).pmsSettings&&j(V).pmsSettings.state!="yearend"||l.reviews&&l.reviews.length>0&&l.reviews[0].type=="probation"&&l.reviews[0].state!="final_review"?(r(),m("div",ve,[o("div",null,g(C(l))+" / 100 ",1),pe])):_("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),l.teams&&l.teams.length>0&&l.sign=="-"?(r(),T(W,{key:0,class:"w-100",user:l},null,8,["user"])):_("",!0)]),_:2},1024))),128))]))}},fe={class:"v-col-12 pb-0"},ge={class:"text-h6"},_e={class:"v-col-12 v-col-md-3"},ye={class:"v-col-12 v-col-md-3"},he={class:"v-col-12 v-col-md-2"},we=o("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[o("div",{class:"text-h6"},"Year: 2023")],-1),ke={key:0,class:"v-col-12"},xe={class:"d-flex align-center w-100"},be={style:{width:"25px"}},Te={style:{width:"100%"}},Ve={key:0,class:"mb-2",style:{color:"white","font-size":"8px","line-height":"8px",padding:"4px 10px",display:"inline-block","text-transform":"uppercase","background-color":"#2196f3",position:"absolute",top:"0",left:"0"}},Ce={class:"v-col-12 v-col-md-8"},Se={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},Pe={key:0},$e=o("div",{class:"text-caption text-grey"}," Total KPI ",-1),De={key:1,class:"v-col-12"},Ie={class:"pa-3 mt-3 d-flex justify-end"},je={class:"pa-3 mt-3 d-flex justify-end"},Ne={__name:"Teams",setup(F){const K=Z(),V=(t,a=null)=>{let e=a?Object.assign({},a):!1;K.push({name:t,params:e}).catch(h=>{})},C=d({}),u=ee(),f=L(),v=d([]),D=d(new Date().getFullYear()),n=d(new Date),w=d(["All","Regular","Probation"]),l=d("Employee doesn`t have a KPI review setup for this year. Contact your HRBP for more info."),c=d({data:{employee:"",employee_type:"All"}}),Y=t=>{let a=0;return t.reviews&&t.reviews.length>0&&t.reviews[0].key_review&&t.reviews[0].key_review.map((e,h)=>{a+=e.weightage}),a},J=t=>{t.sign?t.sign=="+"?t.sign="-":(t.sign="+",M(t)):t.sign="-"},M=t=>{Object.assign([],t).teams.map((e,h)=>{e.sign="+",e.teams&&e.teams.length>0&&M(e)})},z=d(!1),k=d({}),x=d(!1),y=d(!1),q=()=>{c.value.data.employee="",v.value=O.value},Q=()=>{z.value=!0,C.value={status:!0,type:"info",text:"Initializing KPI. Please wait..."},I(u.authToken).post("/api/create/employee-review/year",{ecode:k.value.ecode,is_regular:k.value.is_regular,setting:f.filteredSetting(k.value.company_id),year:D.value,author:u.authProfile.display_name+" "+u.authProfile.ecode}).then(t=>{setTimeout(()=>{C.value={status:!0,type:"success",text:t.data.message}},800)}),I(u.authToken).get("/api/fetch/auth-profile/kpi/"+u.authProfile.ecode).then(t=>{u.setProfile(t.data.result).then(()=>{setTimeout(()=>{z.value=!1,V("SingleTeamMember",{id:k.value.ecode})},3e3)})}).catch(t=>{})},E=d(""),X=t=>{let a="KPI review is currently closed",e=f.filteredSetting(t.company_id);if(E.value="Do you want to set KPI for ",k.value=Object.assign({},t),t.status=="Inactive")l.value="Employee is currently Inactive, kindly contact your HRBP for more info.",y.value=!0;else if(t.reviews&&t.reviews.length>0)t.is_regular==1&&t.reviews[0].status=="locked"&&t.reviews[0].state=="closed"?(l.value=a,y.value=!0):t.reviews[0].status=="open"?(x.value=!0,e.state!="setting"&&(E.value="Do you want to initialize the review for ")):V("SingleTeamMember",{id:t.ecode});else if(e.status=="open"&&e.state=="setting"&&t.is_regular==1)x.value=!0;else if(t.is_regular==0){let h=new Date(t.doj);h.setDate(h.getDate()+parseInt(e.probation_kpi_setting)),h>=n.value?x.value=!0:y.value=!0}else e.status=="locked"&&e.state=="closed"&&(l.value=a),y.value=!0},B=()=>{let t=O.value.filter(function(a){return c.value.data.employee?a.display_name.toLowerCase().includes(c.value.data.employee.toLowerCase())?a:a.ecode==c.value.data.employee:c.value.data.employee_type=="Probation"?a.is_regular==0:c.value.data.employee_type=="Regular"?a.is_regular==1:a});v.value=t},O=d([]);return(()=>{I(u.authToken).get("/api/fetch/team-members/"+u.authProfile.ecode).then(t=>{v.value=t.data,O.value=t.data}).catch(t=>{})})(),(async()=>{await I(u.authToken).get("/api/pms-settings/all").then(t=>{f.setPmsSettings(t.data)})})(),(t,a)=>(r(),T(te,{class:"pb-16",style:{"max-width":"98%"}},{default:i(()=>[s($,{class:"mt-5"},{default:i(()=>[o("div",fe,[o("div",ge," My Team "+g("("+v.value.length+")"),1)]),o("div",_e,[s(le,{modelValue:c.value.data.employee,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value.data.employee=e),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:ae(B,["enter"]),"onClick:clear":q},null,8,["modelValue","onKeydown"])]),o("div",ye,[s(se,{modelValue:c.value.data.employee_type,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value.data.employee_type=e),items:w.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),o("div",he,[s(b,{onClick:B,block:"",color:"secondary",class:"text-capitalize"},{default:i(()=>[p("Filter")]),_:1})]),we]),_:1}),s($,null,{default:i(()=>[v.value&&v.value.length>0?(r(),m("div",ke,[(r(!0),m(R,null,N(v.value,(e,h)=>(r(),m("div",{style:oe(`${e.sign&&e.sign=="-"?"border-bottom:1px solid #C6A92D;":""}`),key:e.id},[o("div",xe,[o("div",be,[e.teams&&e.teams.length>0?(r(),T(b,{key:0,onClick:Ee=>J(e),class:"",color:"primary",size:"25"},{default:i(()=>[p(g(e.sign?e.sign:"+"),1)]),_:2},1032,["onClick"])):_("",!0)]),o("div",Te,[s(S,{width:"100%",class:"mb-1 elevation-0",onClick:()=>X(e)},{default:i(()=>[s(P,{style:{position:"relative"}},{default:i(()=>[e.is_regular==!1?(r(),m("div",Ve," Probation Employee ")):_("",!0),s($,null,{default:i(()=>[o("div",{class:U(`v-col-12 ${e.is_regular==!1?"pt-6":""} v-col-md-3`)},[s(G,{profile:e},null,8,["profile"])],2),o("div",Ce,[s(H,{density:"compact","selected-employee":e},null,8,["selected-employee"])]),o("div",Se,[j(f).pmsSettings&&j(f).pmsSettings.state!="yearend"||e.reviews&&e.reviews.length>0&&e.reviews[0].type=="probation"&&e.reviews[0].state!="final_review"?(r(),m("div",Pe,[o("div",null,g(Y(e))+" / 100 ",1),$e])):_("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])]),e.teams&&e.teams.length>0&&e.sign=="-"?(r(),T(W,{key:0,user:e},null,8,["user"])):_("",!0)],4))),128))])):(r(),m("div",De,[s(S,null,{default:i(()=>[s(P,{class:"text-center"},{default:i(()=>[p(" No records found ")]),_:1})]),_:1})]))]),_:1}),s(A,{modelValue:x.value,"onUpdate:modelValue":a[3]||(a[3]=e=>x.value=e),width:"450"},{default:i(()=>[s(S,{class:"rounded-lg"},{default:i(()=>[s(P,null,{default:i(()=>[p(g(E.value)+" "+g(k.value.first_name)+"? ",1)]),_:1}),o("div",Ie,[s(b,{color:"primary",variant:"text",onClick:a[2]||(a[2]=e=>x.value=!1)},{default:i(()=>[p("Cancel")]),_:1}),s(b,{loading:z.value,color:"secondary",class:"ml-2 px-8",onClick:Q},{default:i(()=>[p("yes")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),s(A,{modelValue:y.value,"onUpdate:modelValue":a[5]||(a[5]=e=>y.value=e),width:"450"},{default:i(()=>[s(S,{class:"rounded-lg"},{default:i(()=>[s(P,null,{default:i(()=>[p(g(l.value),1)]),_:1}),o("div",je,[s(b,{color:"secondary",variant:"text",onClick:a[4]||(a[4]=e=>y.value=!1)},{default:i(()=>[p("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),s(ie,{options:C.value},null,8,["options"])]),_:1}))}};export{Ne as default};
