import{z as N,r as i,u as R,k as U,c as G,w as s,V as H,o as c,a as l,f as o,A as g,G as Y,E as J,I as W,H as w,C as v,i as P,b as f,F as q,n as Q,g as b,h as k,J as E,s as X,e as K,d as M}from"./app-110be25f.js";import Z from"./KpiProgress-b5a7cca5.js";import{_ as ee}from"./EmployeeCard-25eaba77.js";import{c as x}from"./clientApi-fa07ba7b.js";import{_ as te}from"./SnackBar-1422656c.js";import"./printInitials-a54a9c4a.js";import"./mdi-7fd0807e.js";const ae={class:"v-col-12 pb-0"},le={class:"text-h6"},se={class:"v-col-12 v-col-md-3"},oe={class:"v-col-12 v-col-md-3"},ie={class:"v-col-12 v-col-md-2"},ne=o("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[o("div",{class:"text-h6"},"Year: 2023")],-1),re={key:0,class:"v-col-12"},de={class:"v-col-12 v-col-md-3"},ue={class:"v-col-12 v-col-md-8"},ce={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},ve={key:0},me=o("div",{class:"text-caption text-grey"}," Total KPI ",-1),pe={key:1,class:"v-col-12"},fe={class:"pa-3 mt-3 d-flex justify-end"},ye={class:"pa-3 mt-3 d-flex justify-end"},Se={__name:"Teams",setup(_e){const F=N(),I=(e,a=null)=>{let t=a?Object.assign({},a):!1;F.push({name:e,params:t}).catch(_=>{})},V=i({}),r=R(),y=U(),d=i([]),j=i(new Date().getFullYear()),z=i(new Date),B=i(["All","Regular","Probation"]),h=i("Employee doesn`t have a KPI review setup for this year."),n=i({data:{employee:"",employee_type:"All"}}),L=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((t,_)=>{a+=t.weightage}),a},T=i(!1),m=i({}),p=i(!1),u=i(!1),O=()=>{n.value.data.employee="",d.value=S.value},$=()=>{T.value=!0,V.value={status:!0,type:"info",text:"Initializing KPI. Please wait..."},x(r.authToken).post("/api/create/employee-review/year",{ecode:m.value.ecode,is_regular:m.value.is_regular,setting:y.filteredSetting(m.value.company_id),year:j.value,author:r.authProfile.display_name+" "+r.authProfile.ecode}).then(e=>{setTimeout(()=>{V.value={status:!0,type:"success",text:e.data.message}},800)}),x(r.authToken).get("/api/fetch/auth-profile/kpi/"+r.authProfile.ecode).then(e=>{r.setProfile(e.data.result).then(()=>{setTimeout(()=>{T.value=!1,I("SingleTeamMember",{id:m.value.ecode})},3e3)})}).catch(e=>{})},C=i(""),A=e=>{let a="KPI review is currently closed",t=y.filteredSetting(e.company_id);if(C.value="Do you want to set KPI for ",m.value=Object.assign({},e),e.status=="Inactive")h.value="Employee is currently Inactive, kindly contact your HRBP if this is a mistake.",u.value=!0;else if(e.reviews&&e.reviews.length>0)e.is_regular==1&&e.reviews[0].status=="locked"&&e.reviews[0].state=="closed"?(h.value=a,u.value=!0):e.reviews[0].status=="open"?(p.value=!0,t.state!="setting"&&(C.value="Do you want to initialize the review for ")):I("SingleTeamMember",{id:e.ecode});else if(t.status=="open"&&t.state=="setting")p.value=!0;else if(e.is_regular==0){let _=new Date(e.doj);_.setDate(_.getDate()+parseInt(t.probation_kpi_setting)),_>=z.value?p.value=!0:u.value=!0}else t.status=="locked"&&t.state=="closed"&&(h.value=a),u.value=!0},D=()=>{let e=S.value.filter(function(a){return n.value.data.employee?a.display_name.toLowerCase().includes(n.value.data.employee.toLowerCase())?a:a.ecode==n.value.data.employee:n.value.data.employee_type=="Probation"?a.is_regular==0:n.value.data.employee_type=="Regular"?a.is_regular==1:a});d.value=e},S=i([]);return(()=>{x(r.authToken).get("/api/fetch/team-members/"+r.authProfile.ecode).then(e=>{d.value=e.data,S.value=e.data}).catch(e=>{})})(),(async()=>{await x(r.authToken).get("/api/pms-settings/all").then(e=>{y.setPmsSettings(e.data)})})(),(e,a)=>(c(),G(H,{class:"pb-16",style:{"max-width":"98%"}},{default:s(()=>[l(P,{class:"mt-5"},{default:s(()=>[o("div",ae,[o("div",le," My Team "+g("("+d.value.length+")"),1)]),o("div",se,[l(Y,{modelValue:n.value.data.employee,"onUpdate:modelValue":a[0]||(a[0]=t=>n.value.data.employee=t),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:J(D,["enter"]),"onClick:clear":O},null,8,["modelValue","onKeydown"])]),o("div",oe,[l(W,{modelValue:n.value.data.employee_type,"onUpdate:modelValue":a[1]||(a[1]=t=>n.value.data.employee_type=t),items:B.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),o("div",ie,[l(w,{onClick:D,block:"",color:"secondary",class:"text-capitalize"},{default:s(()=>[v("Filter")]),_:1})]),ne]),_:1}),l(P,null,{default:s(()=>[d.value&&d.value.length>0?(c(),f("div",re,[(c(!0),f(q,null,Q(d.value,t=>(c(),f("div",{key:t.id},[t.is_regular==!1?(c(),f("div",{key:0,class:"",style:X(`
                            color: white;
                            font-size: 8px;
                            line-height: 8px;
                            margin-left: 15px;
                            padding: 4px 10px;
                            display: inline-block;
                            border-top-left-radius: 8px;
                            border-top-right-radius: 8px;
                            text-transform: uppercase;
                            background-color: ${t.is_regular==!0?"#000":"#2196F3"};
                            `)}," Probation Employee ",4)):K("",!0),l(b,{class:"mb-1 elevation-0",onClick:()=>A(t)},{default:s(()=>[l(k,null,{default:s(()=>[l(P,null,{default:s(()=>[o("div",de,[l(ee,{profile:t},null,8,["profile"])]),o("div",ue,[l(Z,{density:"compact","selected-employee":t},null,8,["selected-employee"])]),o("div",ce,[M(y).pmsSettings&&M(y).pmsSettings.state!="yearend"||t.reviews&&t.reviews.length>0&&t.reviews[0].type=="probation"&&t.reviews[0].state!="final_review"?(c(),f("div",ve,[o("div",null,g(L(t))+" / 100 ",1),me])):K("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])):(c(),f("div",pe,[l(b,null,{default:s(()=>[l(k,{class:"text-center"},{default:s(()=>[v(" No records found ")]),_:1})]),_:1})]))]),_:1}),l(E,{modelValue:p.value,"onUpdate:modelValue":a[3]||(a[3]=t=>p.value=t),width:"450"},{default:s(()=>[l(b,{class:"rounded-lg"},{default:s(()=>[l(k,null,{default:s(()=>[v(g(C.value)+" "+g(m.value.first_name)+"? ",1)]),_:1}),o("div",fe,[l(w,{color:"primary",variant:"text",onClick:a[2]||(a[2]=t=>p.value=!1)},{default:s(()=>[v("Cancel")]),_:1}),l(w,{loading:T.value,color:"secondary",class:"ml-2 px-8",onClick:$},{default:s(()=>[v("yes")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),l(E,{modelValue:u.value,"onUpdate:modelValue":a[5]||(a[5]=t=>u.value=t),width:"450"},{default:s(()=>[l(b,{class:"rounded-lg"},{default:s(()=>[l(k,null,{default:s(()=>[v(g(h.value),1)]),_:1}),o("div",ye,[l(w,{color:"secondary",variant:"text",onClick:a[4]||(a[4]=t=>u.value=!1)},{default:s(()=>[v("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),l(te,{options:V.value},null,8,["options"])]),_:1}))}};export{Se as default};
