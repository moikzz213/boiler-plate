import{k as A,o as r,c as S,w as o,f as s,b as m,F as L,n as N,H as k,C as p,A as f,e as y,a,g as T,h as V,i as C,d as D,z as Q,r as d,u as X,V as Z,G as ee,E as te,I as le,J as R,s as ae}from"./app-f17a5130.js";import U from"./KpiProgress-49e3a971.js";import{_ as W}from"./EmployeeCard-2c96f3bd.js";import{c as I}from"./clientApi-dacc1c4c.js";import{_ as se}from"./SnackBar-155eb92e.js";import"./printInitials-a54a9c4a.js";import"./mdi-7fd0807e.js";const oe={class:"v-col-12 ml-3"},ie={style:{width:"2%"},class:"my-auto"},ne=["onClick"],re={style:{width:"97%"}},de={key:0,class:"",style:{color:"white","font-size":"8px","line-height":"8px","margin-left":"15px",padding:"4px 10px",display:"inline-block","border-top-left-radius":"8px","border-top-right-radius":"8px","text-transform":"uppercase","background-color":"#2196f3"}},ce={class:"v-col-12 v-col-md-3"},ue={class:"v-col-12 v-col-md-8"},me={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},ve={key:0},pe=s("div",{class:"text-caption text-grey"}," Total KPI ",-1),ge={__name:"SubTeams",props:{user:{type:Object,default:null}},emits:["ratingOrWeightage"],setup(j,{emit:O}){const h=A(),b=n=>{O("ratingOrWeightage",n)},c=n=>{console.log(n),n.sign?n.sign=="+"?n.sign="-":n.sign="+":n.sign="-"};return(n,g)=>(r(),S(C,null,{default:o(()=>[s("div",oe,[(r(!0),m(L,null,N(j.user.teams,i=>(r(),m("div",{class:"d-flex",key:i.id},[s("div",ie,[s("div",{onClick:z=>c(i),style:{width:"2%",position:"absolute"},class:""},[i.teams&&i.teams.length>0?(r(),S(k,{key:0,color:`${i.sign&&i.sign=="-"?"grey":"primary"}`,class:"pr-4",size:"x-small"},{default:o(()=>[p(f(i.sign?i.sign:"+"),1)]),_:2},1032,["color"])):y("",!0)],8,ne)]),s("div",re,[i.is_regular==!1?(r(),m("div",de," Probation Employee ")):y("",!0),a(T,{width:"100%",class:"mb-1 elevation-0"},{default:o(()=>[a(V,null,{default:o(()=>[a(C,null,{default:o(()=>[s("div",ce,[a(W,{profile:i},null,8,["profile"])]),s("div",ue,[a(U,{density:"compact","selected-employee":i},null,8,["selected-employee"])]),s("div",me,[D(h).pmsSettings&&D(h).pmsSettings.state!="yearend"||i.reviews&&i.reviews.length>0&&i.reviews[0].type=="probation"&&i.reviews[0].state!="final_review"?(r(),m("div",ve,[s("div",null,f(b(i))+" / 100 ",1),pe])):y("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]))),128))])]),_:1}))}},fe={class:"v-col-12 pb-0"},_e={class:"text-h6"},ye={class:"v-col-12 v-col-md-3"},he={class:"v-col-12 v-col-md-3"},we={class:"v-col-12 v-col-md-2"},xe=s("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[s("div",{class:"text-h6"},"Year: 2023")],-1),ke={key:0,class:"v-col-12"},be=["onClick"],Te={style:{"padding-left":"2%"}},Ve={key:0,class:"",style:{color:"white","font-size":"8px","line-height":"8px","margin-left":"15px",padding:"4px 10px",display:"inline-block","border-top-left-radius":"8px","border-top-right-radius":"8px","text-transform":"uppercase","background-color":"#2196f3"}},Se={class:"v-col-12 v-col-md-3"},Ce={class:"v-col-12 v-col-md-8"},$e={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},Pe={key:0},Ie=s("div",{class:"text-caption text-grey"}," Total KPI ",-1),De={key:1,class:"v-col-12"},Oe={class:"pa-3 mt-3 d-flex justify-end"},Ee={class:"pa-3 mt-3 d-flex justify-end"},Ne={__name:"Teams",setup(j){const O=Q(),h=(e,l=null)=>{let t=l?Object.assign({},l):!1;O.push({name:e,params:t}).catch(v=>{})},b=d({}),c=X(),n=A(),g=d([]),i=d(new Date().getFullYear()),z=d(new Date),H=d(["All","Regular","Probation"]),$=d("Employee doesn`t have a KPI review setup for this year. Contact your HRBP for more info."),u=d({data:{employee:"",employee_type:"All"}}),F=e=>{let l=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((t,v)=>{l+=t.weightage}),l},G=e=>{e.sign?e.sign=="+"?e.sign="-":e.sign="+":e.sign="-"},E=d(!1),w=d({}),x=d(!1),_=d(!1),Y=()=>{u.value.data.employee="",g.value=M.value},J=()=>{E.value=!0,b.value={status:!0,type:"info",text:"Initializing KPI. Please wait..."},I(c.authToken).post("/api/create/employee-review/year",{ecode:w.value.ecode,is_regular:w.value.is_regular,setting:n.filteredSetting(w.value.company_id),year:i.value,author:c.authProfile.display_name+" "+c.authProfile.ecode}).then(e=>{setTimeout(()=>{b.value={status:!0,type:"success",text:e.data.message}},800)}),I(c.authToken).get("/api/fetch/auth-profile/kpi/"+c.authProfile.ecode).then(e=>{c.setProfile(e.data.result).then(()=>{setTimeout(()=>{E.value=!1,h("SingleTeamMember",{id:w.value.ecode})},3e3)})}).catch(e=>{})},K=d(""),q=(e,l)=>{let t="KPI review is currently closed",v=n.filteredSetting(e.company_id);if(K.value="Do you want to set KPI for ",w.value=Object.assign({},e),l)h("SingleTeamMember",{id:e.ecode});else if(e.status=="Inactive")$.value="Employee is currently Inactive, kindly contact your HRBP for more info.",_.value=!0;else if(e.reviews&&e.reviews.length>0)e.is_regular==1&&e.reviews[0].status=="locked"&&e.reviews[0].state=="closed"?($.value=t,_.value=!0):e.reviews[0].status=="open"?(x.value=!0,v.state!="setting"&&(K.value="Do you want to initialize the review for ")):h("SingleTeamMember",{id:e.ecode});else if(v.status=="open"&&v.state=="setting"&&e.is_regular==1)x.value=!0;else if(e.is_regular==0){let P=new Date(e.doj);P.setDate(P.getDate()+parseInt(v.probation_kpi_setting)),P>=z.value?x.value=!0:_.value=!0}else v.status=="locked"&&v.state=="closed"&&($.value=t),_.value=!0},B=()=>{let e=M.value.filter(function(l){return u.value.data.employee?l.display_name.toLowerCase().includes(u.value.data.employee.toLowerCase())?l:l.ecode==u.value.data.employee:u.value.data.employee_type=="Probation"?l.is_regular==0:u.value.data.employee_type=="Regular"?l.is_regular==1:l});g.value=e},M=d([]);return(()=>{I(c.authToken).get("/api/fetch/team-members/"+c.authProfile.ecode).then(e=>{g.value=e.data,M.value=e.data}).catch(e=>{})})(),(async()=>{await I(c.authToken).get("/api/pms-settings/all").then(e=>{n.setPmsSettings(e.data)})})(),(e,l)=>(r(),S(Z,{class:"pb-16",style:{"max-width":"98%"}},{default:o(()=>[a(C,{class:"mt-5"},{default:o(()=>[s("div",fe,[s("div",_e," My Team "+f("("+g.value.length+")"),1)]),s("div",ye,[a(ee,{modelValue:u.value.data.employee,"onUpdate:modelValue":l[0]||(l[0]=t=>u.value.data.employee=t),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:te(B,["enter"]),"onClick:clear":Y},null,8,["modelValue","onKeydown"])]),s("div",he,[a(le,{modelValue:u.value.data.employee_type,"onUpdate:modelValue":l[1]||(l[1]=t=>u.value.data.employee_type=t),items:H.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),s("div",we,[a(k,{onClick:B,block:"",color:"secondary",class:"text-capitalize"},{default:o(()=>[p("Filter")]),_:1})]),xe]),_:1}),a(C,null,{default:o(()=>[g.value&&g.value.length>0?(r(),m("div",ke,[(r(!0),m(L,null,N(g.value,(t,v)=>(r(),m("div",{style:ae(`${t.sign&&t.sign=="-"?"border-bottom:1px solid #C6A92D;":""}`),key:t.id},[s("div",{onClick:P=>G(t),style:{width:"2%",position:"absolute"},class:"my-7"},[t.teams&&t.teams.length>0?(r(),S(k,{key:0,color:`${t.sign&&t.sign=="-"?"grey":"primary"}`,class:"pr-4",size:"x-small"},{default:o(()=>[p(f(t.sign?t.sign:"+"),1)]),_:2},1032,["color"])):y("",!0)],8,be),s("div",Te,[t.is_regular==!1?(r(),m("div",Ve," Probation Employee ")):y("",!0),a(T,{width:"100%",class:"mb-1 elevation-0",onClick:()=>q(t)},{default:o(()=>[a(V,null,{default:o(()=>[a(C,null,{default:o(()=>[s("div",Se,[a(W,{profile:t},null,8,["profile"])]),s("div",Ce,[a(U,{density:"compact","selected-employee":t},null,8,["selected-employee"])]),s("div",$e,[D(n).pmsSettings&&D(n).pmsSettings.state!="yearend"||t.reviews&&t.reviews.length>0&&t.reviews[0].type=="probation"&&t.reviews[0].state!="final_review"?(r(),m("div",Pe,[s("div",null,f(F(t))+" / 100 ",1),Ie])):y("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]),t.teams&&t.teams.length>0&&t.sign=="-"?(r(),S(ge,{key:0,user:t,onRatingOrWeightage:F},null,8,["user"])):y("",!0)],4))),128))])):(r(),m("div",De,[a(T,null,{default:o(()=>[a(V,{class:"text-center"},{default:o(()=>[p(" No records found ")]),_:1})]),_:1})]))]),_:1}),a(R,{modelValue:x.value,"onUpdate:modelValue":l[3]||(l[3]=t=>x.value=t),width:"450"},{default:o(()=>[a(T,{class:"rounded-lg"},{default:o(()=>[a(V,null,{default:o(()=>[p(f(K.value)+" "+f(w.value.first_name)+"? ",1)]),_:1}),s("div",Oe,[a(k,{color:"primary",variant:"text",onClick:l[2]||(l[2]=t=>x.value=!1)},{default:o(()=>[p("Cancel")]),_:1}),a(k,{loading:E.value,color:"secondary",class:"ml-2 px-8",onClick:J},{default:o(()=>[p("yes")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),a(R,{modelValue:_.value,"onUpdate:modelValue":l[5]||(l[5]=t=>_.value=t),width:"450"},{default:o(()=>[a(T,{class:"rounded-lg"},{default:o(()=>[a(V,null,{default:o(()=>[p(f($.value),1)]),_:1}),s("div",Ee,[a(k,{color:"secondary",variant:"text",onClick:l[4]||(l[4]=t=>_.value=!1)},{default:o(()=>[p("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),a(se,{options:b.value},null,8,["options"])]),_:1}))}};export{Ne as default};
