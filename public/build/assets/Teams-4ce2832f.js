import{l as A,r as c,o as r,b as p,F as R,C as N,c as V,w as o,f as i,v as b,n as f,t as h,e as w,a as s,g as $,h as S,i as D,z as U,d as j,k as Z,u as ee,V as te,s as le,q as ae,L as se,M as L,H as ie}from"./app-cd5d535f.js";import H from"./KpiProgress-5ec1002e.js";import{_ as W}from"./EmployeeCard-a24ccc38.js";import{c as I}from"./clientApi-8a9bbd48.js";import{_ as oe}from"./SnackBar-1113efc5.js";import"./printInitials-a54a9c4a.js";import"./mdi-5e26928d.js";const ne={class:"d-flex align-center w-100"},de={style:{width:"25px"}},re={style:{width:"100%"}},ce={key:0,class:"mb-2",style:{color:"white","font-size":"8px","line-height":"8px",padding:"4px 10px",display:"inline-block","text-transform":"uppercase","background-color":"#2196f3",position:"absolute",top:"0",left:"0"}},ue={class:"v-col-12 v-col-md-8"},ve={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},me={key:0},pe=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),Y={__name:"SubTeams",props:{user:{type:Object,default:null}},setup(E){const z=E,C=A(),P=d=>{let k=0;return d.reviews&&d.reviews.length>0&&d.reviews[0].key_review&&d.reviews[0].key_review.map((a,_)=>{k+=a.weightage}),k},n=c(z.user),g=d=>{d.sign?d.sign=="+"?d.sign="-":(d.sign="+",v(d)):d.sign="-"},v=d=>{Object.assign([],d).teams.map((a,_)=>{a.sign="+",a.teams&&a.teams.length>0&&v(a)})};return(d,k)=>(r(),p("div",null,[(r(!0),p(R,null,N(n.value.teams,a=>(r(),V(D,{class:"v-col-12 py-0 my-0 ml-3",key:a.id},{default:o(()=>[i("div",ne,[i("div",de,[a.teams&&a.teams.length>0?(r(),V(b,{key:0,onClick:_=>g(a),class:"",color:"primary",size:"25"},{default:o(()=>[f(h(a.sign?a.sign:"+"),1)]),_:2},1032,["onClick"])):w("",!0)]),i("div",re,[s($,{width:"100%",class:"mb-1 elevation-0"},{default:o(()=>[s(S,{style:{position:"relative"}},{default:o(()=>[a.is_regular==!1?(r(),p("div",ce," Probation Employee ")):w("",!0),s(D,null,{default:o(()=>[i("div",{class:U(`v-col-12 ${a.is_regular==!1?"pt-6":""} v-col-md-3`)},[s(W,{profile:a},null,8,["profile"])],2),i("div",ue,[s(H,{density:"compact","selected-employee":a},null,8,["selected-employee"])]),i("div",ve,[j(C).pmsSettings&&j(C).pmsSettings.state!="yearend"||a.reviews&&a.reviews.length>0&&a.reviews[0].type=="probation"&&a.reviews[0].state!="final_review"?(r(),p("div",me,[i("div",null,h(P(a))+" / 100 ",1),pe])):w("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),a.teams&&a.teams.length>0&&a.sign=="-"?(r(),V(Y,{key:0,class:"w-100",user:a},null,8,["user"])):w("",!0)]),_:2},1024))),128))]))}},fe={class:"v-col-12 pb-0"},ge={class:"text-h6"},_e={class:"v-col-12 v-col-md-3"},ye={class:"v-col-12 v-col-md-3"},he={class:"v-col-12 v-col-md-2"},we=i("div",{class:"v-col-12 v-col-md-2 ml-auto d-flex align-center justify-end"},[i("div",{class:"text-h6"},"Year: 2023")],-1),ke={key:0,class:"v-col-12"},xe={class:"d-flex align-center w-100"},Te={style:{width:"25px"}},be={style:{width:"100%"}},Ve={key:0,class:"mb-2",style:{color:"white","font-size":"8px","line-height":"8px",padding:"4px 10px",display:"inline-block","text-transform":"uppercase","background-color":"#2196f3",position:"absolute",top:"0",left:"0"}},Ce={class:"v-col-12 v-col-md-8"},Pe={class:"v-col-12 v-col-md-1 d-flex justify-end align-center"},$e={key:0},Se=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),De={key:1,class:"v-col-12"},Ie={class:"pa-3 mt-3 d-flex justify-end"},je={class:"pa-3 mt-3 d-flex justify-end"},Ne={__name:"Teams",setup(E){const z=Z(),C=(t,l=null)=>{let e=l?Object.assign({},l):!1;z.push({name:t,params:e}).catch(u=>{})},P=c({}),n=ee(),g=A(),v=c([]),d=c(new Date().getFullYear()),k=c(new Date),a=c(["All","Regular","Probation"]),_=c("Employee doesn`t have a KPI review setup for this year. Contact your HRBP for more info."),m=c({data:{employee:"",employee_type:"All"}}),q=t=>{let l=0;return t.reviews&&t.reviews.length>0&&t.reviews[0].key_review&&t.reviews[0].key_review.map((e,u)=>{l+=e.weightage}),l},G=t=>{t.sign?t.sign=="+"?t.sign="-":(t.sign="+",F(t)):t.sign="-"},F=t=>{Object.assign([],t).teams.map((e,u)=>{e.sign="+",e.teams&&e.teams.length>0&&F(e)})},K=c(!1),x=c({}),T=c(!1),y=c(!1),J=()=>{m.value.data.employee="",v.value=O.value},Q=()=>{var t,l,e;K.value=!0,P.value={status:!0,type:"info",text:"Initializing KPI. Please wait..."},I(n.authToken).post("/api/create/employee-review/year",{ecode:x.value.ecode,is_regular:x.value.is_regular,setting:g.filteredSetting(x.value.company_id),year:d.value,author:((t=n==null?void 0:n.authProfile)==null?void 0:t.display_name)+" "+((l=n==null?void 0:n.authProfile)==null?void 0:l.ecode)}).then(u=>{setTimeout(()=>{P.value={status:!0,type:"success",text:u.data.message}},800)}),I(n.authToken).get("/api/fetch/auth-profile/kpi/"+((e=n==null?void 0:n.authProfile)==null?void 0:e.ecode)).then(u=>{n.setProfile(u.data.result).then(()=>{setTimeout(()=>{K.value=!1,C("SingleTeamMember",{id:x.value.ecode})},3e3)})}).catch(u=>{})},M=c(""),X=t=>{let l="KPI review is currently closed",e=g.filteredSetting(t.company_id);if(M.value="Do you want to set KPI for ",x.value=Object.assign({},t),t.status=="Inactive")_.value="Employee is currently Inactive, kindly contact your HRBP for more info.",y.value=!0;else if(t.reviews&&t.reviews.length>0)t.reviews[0].key_review==0&&t.reviews[0].state!="setting"?y.value=!0:t.is_regular==1&&(t.reviews[0].status=="locked"||t.reviews[0].status=="closed")?(_.value=l,y.value=!0):t.reviews[0].status=="open"?(T.value=!0,e.state!="setting"&&(M.value="Do you want to initialize the review for ")):C("SingleTeamMember",{id:t.ecode});else if(e.status=="open"&&e.state=="setting"&&t.is_regular==1)T.value=!0;else if(t.is_regular==0){let u=new Date(t.doj);u.setDate(u.getDate()+parseInt(e.probation_kpi_setting)),u>=k.value?T.value=!0:((e.status=="locked"||e.status=="closed")&&(_.value=l),y.value=!0)}else e.status=="locked"&&e.state=="closed"&&(_.value=l),y.value=!0},B=()=>{let t=O.value.filter(function(l){return m.value.data.employee?l.display_name.toLowerCase().includes(m.value.data.employee.toLowerCase())?l:l.ecode==m.value.data.employee:m.value.data.employee_type=="Probation"?l.is_regular==0:m.value.data.employee_type=="Regular"?l.is_regular==1:l});v.value=t},O=c([]);return(()=>{var t;n&&n.authToken&&I(n.authToken).get("/api/fetch/team-members/"+((t=n==null?void 0:n.authProfile)==null?void 0:t.ecode)).then(l=>{v.value=l.data,O.value=l.data}).catch(l=>{})})(),(async()=>{n&&n.authToken&&await I(n.authToken).get("/api/pms-settings/all").then(t=>{g.setPmsSettings(t.data),g.setAllSettings(t.data)})})(),(t,l)=>(r(),V(te,{class:"pb-16",style:{"max-width":"98%"}},{default:o(()=>[s(D,{class:"mt-5"},{default:o(()=>[i("div",fe,[i("div",ge," My Team "+h("("+v.value.length+")"),1)]),i("div",_e,[s(le,{modelValue:m.value.data.employee,"onUpdate:modelValue":l[0]||(l[0]=e=>m.value.data.employee=e),variant:"outlined",density:"compact",class:"bg-white","hide-details":"",clearable:"",label:"Input Employee Code",onKeydown:ae(B,["enter"]),"onClick:clear":J},null,8,["modelValue","onKeydown"])]),i("div",ye,[s(se,{modelValue:m.value.data.employee_type,"onUpdate:modelValue":l[1]||(l[1]=e=>m.value.data.employee_type=e),items:a.value,variant:"outlined",density:"compact",class:"bg-white","hide-details":"",label:"Select Employee Type"},null,8,["modelValue","items"])]),i("div",he,[s(b,{onClick:B,block:"",color:"secondary",class:"text-capitalize"},{default:o(()=>[f("Filter")]),_:1})]),we]),_:1}),s(D,null,{default:o(()=>[v.value&&v.value.length>0?(r(),p("div",ke,[(r(!0),p(R,null,N(v.value,(e,u)=>(r(),p("div",{style:ie(`${e.sign&&e.sign=="-"?"border-bottom:1px solid #C6A92D;":""}`),key:e.id},[i("div",xe,[i("div",Te,[e.teams&&e.teams.length>0?(r(),V(b,{key:0,onClick:Me=>G(e),class:"",color:"primary",size:"25"},{default:o(()=>[f(h(e.sign?e.sign:"+"),1)]),_:2},1032,["onClick"])):w("",!0)]),i("div",be,[s($,{width:"100%",class:"mb-1 elevation-0",onClick:()=>X(e)},{default:o(()=>[s(S,{style:{position:"relative"}},{default:o(()=>[e.is_regular==!1?(r(),p("div",Ve," Probation Employee ")):w("",!0),s(D,null,{default:o(()=>[i("div",{class:U(`v-col-12 ${e.is_regular==!1?"pt-6":""} v-col-md-3`)},[s(W,{profile:e},null,8,["profile"])],2),i("div",Ce,[s(H,{density:"compact","selected-employee":e},null,8,["selected-employee"])]),i("div",Pe,[j(g).pmsSettings&&j(g).pmsSettings.state!="yearend"||e.reviews&&e.reviews.length>0&&e.reviews[0].type=="probation"&&e.reviews[0].state!="final_review"?(r(),p("div",$e,[i("div",null,h(q(e))+" / 100 ",1),Se])):w("",!0)])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])])]),e.teams&&e.teams.length>0&&e.sign=="-"?(r(),V(Y,{key:0,user:e},null,8,["user"])):w("",!0)],4))),128))])):(r(),p("div",De,[s($,null,{default:o(()=>[s(S,{class:"text-center"},{default:o(()=>[f(" No records found ")]),_:1})]),_:1})]))]),_:1}),s(L,{modelValue:T.value,"onUpdate:modelValue":l[3]||(l[3]=e=>T.value=e),width:"450"},{default:o(()=>[s($,{class:"rounded-lg"},{default:o(()=>[s(S,null,{default:o(()=>[f(h(M.value)+" "+h(x.value.first_name)+"? ",1)]),_:1}),i("div",Ie,[s(b,{color:"primary",variant:"text",onClick:l[2]||(l[2]=e=>T.value=!1)},{default:o(()=>[f("Cancel")]),_:1}),s(b,{loading:K.value,color:"secondary",class:"ml-2 px-8",onClick:Q},{default:o(()=>[f("yes")]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),s(L,{modelValue:y.value,"onUpdate:modelValue":l[5]||(l[5]=e=>y.value=e),width:"450"},{default:o(()=>[s($,{class:"rounded-lg"},{default:o(()=>[s(S,null,{default:o(()=>[f(h(_.value),1)]),_:1}),i("div",je,[s(b,{color:"secondary",variant:"text",onClick:l[4]||(l[4]=e=>y.value=!1)},{default:o(()=>[f("Close")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),s(oe,{options:P.value},null,8,["options"])]),_:1}))}};export{Ne as default};
