import{z as oe,L as ne,r as o,u as re,k as ue,M as ce,l as de,c as N,w as u,V as ve,o as A,a as n,f as i,N as me,g as L,h as j,i as O,A as f,d as pe,H as V,C as S,e as fe,K as _e}from"./app-2321e933.js";import{_ as he}from"./KpiContent-678a7921.js";import{_ as ge}from"./EmployeeCard-b8b3b9ed.js";import{c as v}from"./clientApi-833190a3.js";import{u as ye}from"./industry-10db8b53.js";import{_ as we}from"./SnackBar-4a5f34ae.js";import"./mdi-5e26928d.js";import"./vue-datepicker-fc1ec1df.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const be={class:"v-col-12 v-col-md-3"},xe={class:"v-col-12"},ke={class:"v-col-12 v-col-md-3 d-flex align-center"},Se={class:"v-col-12 v-col-md-2 d-flex flex-column"},Pe=i("div",{class:"text-caption text-grey"}," Reporting To ",-1),Te={class:"text-body-2"},Ve={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ce=i("div",{class:"text-caption text-grey"}," Business Unit ",-1),De={class:"text-body-2"},Re={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ie=i("div",{class:"text-caption text-grey"}," KPI's Target Year ",-1),Me={class:"text-body-2"},Ee={class:"v-col-12 v-col-md-1 d-flex flex-column"},Ke=i("div",{class:"text-caption text-grey"}," Total KPI ",-1),Be={class:"text-body-2"},Ne={class:"v-col-12 v-col-md-2 d-flex align-center"},Ae={class:"pa-3 mt-3 d-flex justify-end"},Qe={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(Le){const U=oe(),z=ne(),_=o(!1),C=o(""),D=o(z.params.id),l=re(),F=ue(),g=ye(),h=o({}),W=l.authProfile.display_name,p=o([]),y=o(D.value),t=o({}),Y=()=>{t.value=y.value,U.push({name:"SingleTeamMember",params:{id:y.value.ecode}}).catch(e=>{})},R=o(0),$=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,r)=>{a+=s.weightage}),R.value=a,a},d=o([]),H=async()=>{g.industries.length==0?g.getIndustries(l.authToken).then(()=>{d.value=g.industries}):d.value=g.industries},w=o([]),P=o([]),q=async()=>{await v(l.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{d.value&&d.value.length>0&&e.data&&e.data.length>0&&d.value.map((a,s)=>{w.value[s]=a,w.value[s].kpis=[];let r=0,m=0;e.data.map((k,je)=>{a.id==k.industry_id?(w.value[s].kpis[r]=k,r++):k.type=="ecd"&&(P.value[m]=k,m++)})})})},G=async()=>{await v(l.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+l.authProfile.ecode).then(e=>{d.value&&d.value.length>0&&e.data&&e.data.length>0&&d.value.map((a,s)=>{let r=0;e.data.map(m=>{a.id==m.industry_id?a.kpis.unshift(m):m.type=="ecd"&&(P.value[r]=m,r++)})})})},J=()=>{_.value=!1,b.value=!1,T.value=!1},I=o(""),Q=e=>{I.value=e},b=o(!1),T=o(!1),X=()=>{b.value=!0;let e=!1,a="inprogress",s=t.value.reviews[0].id;if(!s)return h.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.is_regular&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?a="inreview":a="submitted":((t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(a="submitted"),t.value.reviews[0].state=="yearend"&&(e=!0,_.value=!0,C.value="The Final PMS rating of "+t.value.first_name+" for the year "+t.value.reviews[0].year+" is: "+I.value)),e||M(s,a)},Z=()=>{M(t.value.reviews[0].id,"submitted"),_.value=!1},M=(e,a)=>{let s={reviewID:e,newStatus:a,user_ecode:l.authProfile.ecode,managerEmail:l.authProfile.email,managerName:l.authProfile.display_name,allowedDays:t.value.is_regular?c.value.employee_review_allowed_days:c.value.probation_kpi_setting,closingDateSetting:t.value.is_regular?c.value.annual_kpi_setting_end:c.value.probation_kpi_setting,closingDateMid:t.value.is_regular?c.value.mid_year_review_end:c.value.probation_first_review_end,closingDateFinal:t.value.is_regular?c.value.end_year_review_end:c.value.probation_final_review_end};v(l.authToken).post("/api/manager/employee-kpi/submit",s).then(r=>{h.value={status:!0,type:"success",text:r.data.message},p.value=r.data.profile.teams,l.setProfile(r.data.profile).then(()=>{x(),setTimeout(()=>{b.value=!1,T.value=!0},2e3)})}).catch(r=>{})},E=o(!1),ee=e=>{E.value=e.hasError},te=e=>{let a={id:e.id,user_ecode:l.authProfile.ecode};v(l.authToken).post("/api/delete/employee-kpi-year",a).then(s=>{p.value=s.data.profile.teams,l.setProfile(s.data.profile).then(()=>{x(),h.value={status:!0,type:"success",text:s.data.message}})}).catch(s=>{})},ae=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:l.authProfile.ecode};v(l.authToken).post("/api/create/employee-kpi-year",a).then(s=>{h.value={status:!0,type:"success",text:s.data.message},p.value=s.data.profile.teams,l.setProfile(s.data.profile).then(()=>{x()})}).catch(s=>{})},se=e=>{K(e)},K=async e=>{await v(l.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},B=o([]),le=async()=>{await v(l.authToken).get("/api/fetch/measures/non-paginated").then(e=>{B.value=e.data}).catch(e=>{})},x=()=>{t.value={};let e=p.value.filter(a=>a.username==D.value);t.value=Object.assign({},e[0]),K(2023)},c=ce(()=>F.filteredSetting(t.value.company_id)),ie=async()=>{await v(l.authToken).get("/api/fetch/team-members/"+l.authProfile.ecode).then(e=>{e.data&&e.data.length>0&&(p.value=e.data.filter(a=>a.reviews.length>0))}).catch(e=>{})};return de(()=>{ie().then(()=>{x(),H().then(()=>{q().then(()=>{G().then(()=>{le()})})})})}),(e,a)=>(A(),N(ve,{class:"pb-16",style:{"max-width":"95%"}},{default:u(()=>[n(O,{class:"my-5"},{default:u(()=>[i("div",be,[n(me,{modelValue:y.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>y.value=s),Y],items:p.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),i("div",xe,[n(L,{class:"mb-3 elevation-0"},{default:u(()=>[n(j,null,{default:u(()=>[n(O,null,{default:u(()=>[i("div",ke,[n(ge,{profile:t.value},null,8,["profile"])]),i("div",Se,[Pe,i("div",Te,f(pe(W)),1)]),i("div",Ve,[Ce,i("div",De,f(t.value.company&&t.value.company.title),1)]),i("div",Re,[Ie,i("div",Me,f(c.value.year),1)]),i("div",Ee,[Ke,i("div",Be,f($(t.value))+"/100 ",1)]),i("div",Ne,[!E.value&&R.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(A(),N(V,{key:0,size:"large",onClick:X,loading:b.value,block:"",disabled:T.value,color:"secondary",class:"text-capitalize rounded-lg text-md-caption text-lg-body-2"},{default:u(()=>[S(f(t.value.is_regular&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading","disabled"])):fe("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),n(he,{"selected-employee":t.value,"measures-list":B.value,"industry-list":w.value,"ecd-list":P.value,onSavedResponse:ae,onErrorcheck:ee,onYearchange:se,onRemoveKPI:te,onRating:Q,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list"]),n(_e,{modelValue:_.value,"onUpdate:modelValue":a[1]||(a[1]=s=>_.value=s),width:"450"},{default:u(()=>[n(L,{class:"rounded-lg"},{default:u(()=>[n(j,null,{default:u(()=>[S(f(C.value)+". Do you want to Submit? ",1)]),_:1}),i("div",Ae,[n(V,{color:"primary",variant:"text",class:"mr-2",onClick:J},{default:u(()=>[S("Close")]),_:1}),n(V,{color:"secondary",onClick:Z},{default:u(()=>[S("Confirm")]),_:1})])]),_:1})]),_:1},8,["modelValue"]),n(we,{options:h.value},null,8,["options"])]),_:1}))}};export{Qe as default};
