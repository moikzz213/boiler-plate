import{z as q,K as G,r as o,u as J,k as Q,L as V,l as X,c as I,w as v,V as Z,o as E,a as u,f as i,M as ee,g as te,h as ae,i as R,A as p,d as se,H as le,C as ie,e as oe}from"./app-d2fb1262.js";import{_ as ne}from"./KpiContent-32da05e5.js";import{_ as re}from"./EmployeeCard-d6e2f4e2.js";import{c}from"./clientApi-2b4a321a.js";import{u as ue}from"./industry-cdd62490.js";import{_ as ce}from"./SnackBar-28e14e9f.js";import"./mdi-a0a77bee.js";import"./vue-datepicker-b8277478.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const de={class:"v-col-12 v-col-md-3"},ve={class:"v-col-12"},me={class:"v-col-12 v-col-md-3 d-flex align-center"},pe={class:"v-col-12 v-col-md-2 d-flex flex-column"},he=i("div",{class:"text-caption text-grey"},"Reporting To",-1),fe={class:"text-body-2"},ge={class:"v-col-12 v-col-md-2 d-flex flex-column"},_e=i("div",{class:"text-caption text-grey"},"Business Unit",-1),ye={class:"text-body-2"},we={class:"v-col-12 v-col-md-2 d-flex flex-column"},xe=i("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),ke={class:"text-body-2"},be={class:"v-col-12 v-col-md-1 d-flex flex-column"},Pe=i("div",{class:"text-caption text-grey"},"Total KPI",-1),Se={class:"text-body-2"},Te={class:"v-col-12 v-col-md-2 d-flex align-center"},Ye={__name:"SingleTeamMember",props:{manager:{type:String,default:null}},setup(Ve){const C=q(),D=G(),w=o(D.params.id),l=J(),M=Q(),h=ue(),m=o({}),K=l.authProfile.display_name,x=V(()=>l.authProfile.teams),f=o(w.value),t=o({}),g=()=>{let e=x.value.filter(a=>a.username==w.value);t.value=Object.assign({},e[0])},B=()=>{t.value=f.value,C.push({name:"SingleTeamMember",params:{id:f.value.ecode}}).catch(e=>{})},k=o(0),N=e=>{let a=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,n)=>{a+=s.weightage}),k.value=a,a},r=o([]),A=async()=>{h.industries.length==0?h.getIndustries(l.authToken).then(()=>{r.value=h.industries}):r.value=h.industries},d=o([]),b=o([]),L=async()=>{await c(l.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{r.value&&r.value.length>0&&e.data&&e.data.length>0&&r.value.map((a,s)=>{d.value[s]=a,d.value[s].kpis=[];let n=0,T=0;e.data.map((_,Ie)=>{a.id==_.industry_id?(d.value[s].kpis[n]=_,n++):_.type=="ecd"&&(b.value[T]=_,T++)})})})},O=async()=>{await c(l.authToken).get("/api/fetch/master-custom-kpi/non-paginate/"+l.authProfile.ecode).then(e=>{r.value&&r.value.length>0&&e.data&&e.data.length>0&&r.value.map((a,s)=>{e.data.map(n=>{a.id==n.industry_id&&(d.value[s].kpis[d.value[s].kpis.length]=n)})})})},y=o(!1),Y=()=>{y.value=!0;let e="inprogress",a=t.value.reviews[0].id;if(!a)return m.value={status:!0,type:"error",text:"Error: kindly refresh page and submit again."},!1;t.value.reviews[0].state=="setting"?t.value.is_regular&&(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")?e="inreview":e="submitted":(t.value.reviews[0].status=="open"||t.value.reviews[0].status=="inprogress")&&(e="submitted");let s={reviewID:a,newStatus:e,user_ecode:l.authProfile.ecode,managerEmail:l.authProfile.email,managerName:l.authProfile.display_name};c(l.authToken).post("/api/manager/employee-kpi/submit",s).then(n=>{m.value={status:!0,type:"success",text:n.data.message},l.setProfile(n.data.profile).then(()=>{g(),setTimeout(()=>{y.value=!1},1e3)})}).catch(n=>{})},P=o(!1),j=e=>{P.value=e.hasError},z=e=>{let a={id:e.id,user_ecode:l.authProfile.ecode};c(l.authToken).post("/api/delete/employee-kpi-year",a).then(s=>{l.setProfile(s.data.profile).then(()=>{g(),m.value={status:!0,type:"success",text:s.data.message}})}).catch(s=>{})},W=e=>{let a={action:e.action,reviewID:e.reviewID,data:e.data,type:e.type,user_ecode:l.authProfile.ecode};c(l.authToken).post("/api/create/employee-kpi-year",a).then(s=>{m.value={status:!0,type:"success",text:s.data.message},l.setProfile(s.data.profile).then(()=>{g()})}).catch(s=>{})},$=e=>{U(e)},U=async e=>{await c(l.authToken).get("/api/dashboard/my-kpi/"+t.value.id+"/"+e).then(a=>{a.data.result==null?t.value={...t.value,reviews:[]}:t.value={...t.value,reviews:[a.data.result]}}).catch(a=>{})},S=o([]),F=async()=>{c(l.authToken).get("/api/fetch/measures/non-paginated").then(e=>{S.value=e.data}).catch(e=>{})},H=V(()=>M.filteredSetting(t.value.company_id).year);return X(()=>{g(),A().then(()=>{L().then(()=>{O().then(()=>{F()})})})}),(e,a)=>(E(),I(Z,{class:"pb-16"},{default:v(()=>[u(R,{class:"my-5"},{default:v(()=>[i("div",de,[u(ee,{modelValue:f.value,"onUpdate:modelValue":[a[0]||(a[0]=s=>f.value=s),B],items:x.value,"item-title":"username","item-value":"id",variant:"outlined",density:"compact",class:"bg-white","return-object":"","hide-details":"",label:"Select Employee"},null,8,["modelValue","items"])]),i("div",ve,[u(te,{class:"mb-3 elevation-0"},{default:v(()=>[u(ae,null,{default:v(()=>[u(R,null,{default:v(()=>[i("div",me,[u(re,{profile:t.value},null,8,["profile"])]),i("div",pe,[he,i("div",fe,p(se(K)),1)]),i("div",ge,[_e,i("div",ye,p(t.value.company&&t.value.company.title),1)]),i("div",we,[xe,i("div",ke,p(H.value),1)]),i("div",be,[Pe,i("div",Se,p(N(t.value))+"/100",1)]),i("div",Te,[!P.value&&k.value==100&&t.value.reviews&&t.value.reviews.length>0&&(t.value.reviews[0].status=="inprogress"||t.value.reviews[0].status=="inreview"||t.value.reviews[0].status=="open")?(E(),I(le,{key:0,size:"large",onClick:Y,loading:y.value,block:"",color:"secondary",class:"text-capitalize rounded-lg"},{default:v(()=>[ie(p(t.value.is_regular&&t.value.reviews[0].state=="setting"&&t.value.reviews[0].status=="inprogress"?"Submit for Review":"Submit"),1)]),_:1},8,["loading"])):oe("",!0)])]),_:1})]),_:1})]),_:1})])]),_:1}),u(ne,{"measures-list":S.value,"selected-employee":t.value,"industry-list":d.value,"ecd-list":b.value,onSavedResponse:W,onErrorcheck:j,onYearchange:$,onRemoveKPI:z,"is-manager":!0},null,8,["measures-list","selected-employee","industry-list","ecd-list"]),u(ce,{options:m.value},null,8,["options"])]),_:1}))}};export{Ye as default};
