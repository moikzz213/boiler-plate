import{u as me,k as he,z as fe,L as ye,r as c,M as ge,O as Z,c as v,w as l,V as _e,o as d,a as n,f as i,S as L,G as q,T as K,d as x,U as w,b,n as O,F as U,W as C,C as p,X as ke,H as z,A as m,e as B,i as N,g as xe,h as we,Y as $,Z as be}from"./app-6f483914.js";import{c as h}from"./clientApi-1c160f7d.js";import{m as J,a as Ce}from"./mdi-5e26928d.js";import{_ as Se}from"./KpiContent-4dbc44d3.js";import{_ as Ee}from"./EmployeeCard-194f5518.js";import{_ as Te}from"./ConfirmDialog-ede04e7b.js";import{_ as Ve}from"./SnackBar-ea66d07d.js";import{u as Pe}from"./industry-b0bbe113.js";import"./vue-datepicker-57af9824.js";import"./typeof-7fd5df1e.js";import"./defineProperty-fcf2a4a8.js";import"./printInitials-a54a9c4a.js";const Ie={class:"v-col-12 v-col-md-3 pb-0"},Ae=i("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Me={class:"v-col-12 v-col-md-3 pb-0"},Re=i("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"}," Enter ecode, name, or email ",-1),Le={key:0,class:"v-col-12 v-col-md-2 text-right pb-0"},Ke=i("div",{class:"text-caption px-3 text-grey-darken-1 pt-1"},"Employee Status",-1),Oe={class:"v-col-12"},Ue={class:"v-col-12 v-col-md-3 d-flex align-center"},ze={class:"v-col-12 v-col-md-2 d-flex flex-column"},Be=i("div",{class:"text-caption text-grey"},"Reporting To",-1),Ne={class:"text-body-2"},$e={class:"v-col-12 v-col-md-2 d-flex flex-column"},Ye=i("div",{class:"text-caption text-grey"},"Business Unit",-1),Fe={class:"text-body-2"},We={class:"v-col-12 v-col-md-2 d-flex flex-column"},De=i("div",{class:"text-caption text-grey"},"KPI's Target Year",-1),je={class:"text-body-2"},Ge={class:"v-col-12 v-col-md-1 d-flex flex-column"},He=i("div",{class:"text-caption text-grey"},"Total KPI",-1),Xe={class:"text-body-2"},Ze={key:0,class:"v-col-12 v-col-md-2 d-flex align-center"},dt={__name:"SingleEmployee",setup(qe){const S=Pe(),r=me(),Q=he(),ee=fe(),te=ye(),f=c({}),E=c("Active"),Y=c(""),ae=c([{title:"Active",color:"success"},{title:"Inactive",color:"error"}]),g=c([]),le=async()=>{S.industries.length==0?S.getIndustries(r.authToken).then(()=>{g.value=S.industries}):g.value=S.industries},F=c([]),se=async()=>{await h(r.authToken).get("/api/fetch/measures/non-paginated").then(e=>{F.value=e.data}).catch(e=>{})},T=c([]),W=c([]),D=c(new Date().getFullYear()),oe=e=>{D.value=e,ne(e)},ne=async e=>{await h(r.authToken).get("/api/dashboard/my-kpi/"+a.value.id+"/"+e).then(t=>{t.data.result==null?a.value={...a.value,reviews:[]}:a.value={...a.value,reviews:[t.data.result]}}).catch(t=>{})},ie=async()=>{await h(r.authToken).get("/api/fetch/master-kpi/non-paginate").then(e=>{g.value&&g.value.length>0&&e.data&&e.data.length>0&&g.value.map((t,s)=>{T.value[s]=t,T.value[s].kpis=[];let u=0,X=0;e.data.map((I,Je)=>{t.id==I.industry_id?(T.value[s].kpis[u]=I,u++):I.type=="ecd"&&(W.value[X]=I,X++)})})})},ue=e=>{let t=0;return e.reviews&&e.reviews.length>0&&e.reviews[0].key_review&&e.reviews[0].key_review.map((s,u)=>{t+=s.weightage}),t},a=c({}),V=async()=>{await h(r.authToken).get("/api/hr/employee/ecode/"+te.params.ecode).then(e=>{a.value=e.data,E.value=e.data.status,y.value=e.data.slave_ecode}).catch(e=>{console.log("getEmployee",e)})},A=ge(()=>Q.filteredSetting(a.value.company_id));r.authToken&&(V(),le(),ie(),se());const ce=e=>{Y.value=e.title,o.value={dialog:!0,title:"Confirm Status Update",text:"Please confirm that you want to update the status of "+a.value.display_name+" into "+e.title+".",btnColor:e.title=="Active"?"success":"error",btnTitle:"Confirm"}},re=async()=>{let e={profile_id:r.authProfile.id,ecode:a.value.ecode,status:Y.value};o.value={...o.value,loading:!0},await h(r.authToken).post("/api/hr/employee/status/update",e).then(t=>{V().then(()=>{o.value={...o.value,loading:!1,dialog:!1},f.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{console.log("getEmployee",t),o.value={...o.value,loading:!1},f.value={status:!0,type:"error",text:"Error while updating employee"}})},_=c(""),y=c(""),k=c(!1),M=c([]),R=c({}),j=async e=>{k.value=!0,await h(r.authToken).get("/api/hr/search/employee?&filter[search]="+e).then(t=>{k.value=!1,y.value?R.value=t.data:_.value&&(M.value=t.data)}).catch(t=>{k.value=!1,console.log("getEmployee",t)})},G=async(e,t)=>{let s={profile_id:r.authProfile.id,slave_ecode:t?"":e.ecode,ecode:a.value.ecode};o.value={...o.value,loading:!0},y.value=e==null?void 0:e.ecode,await h(r.authToken).post("/api/employee/secondary-manager/update",s).then(u=>{V().then(()=>{o.value={...o.value,loading:!1,dialog:!1},f.value={status:!0,type:"success",text:u.data.message}})}).catch(u=>{o.value={...o.value,loading:!1},f.value={status:!0,type:"error",text:"Error while updating employee"}})},de=e=>{a.value=e,E.value=e.status,ee.push({name:"SingleEmployee",params:{ecode:e.ecode}}).catch(t=>{})};Z(_,(e,t)=>{e&&e!=t&&e.length>3&&j(_.value)}),Z(y,(e,t)=>{e&&e!=t&&e.length>3&&j(y.value)});const P=c({data:{},loading:!1}),H=()=>{o.value={dialog:!0,title:"Confirm to Open KPI",text:"Please confirm that you want to open the KPI for "+a.value.display_name+".",btnColor:"secondary",btnTitle:"Confirm"}},ve=async()=>{o.value={...o.value,loading:!0};let e={profile_id:r.authProfile.id,name:r.authProfile.display_name,ecode:a.value.ecode,year:D.value};await h(r.authToken).post("/api/hr/employee/reopen",e).then(t=>{o.value={...o.value,loading:!1,dialog:!1},P.value.loading=!0,V().then(()=>{P.value.loading=!1,f.value={status:!0,type:"success",text:t.data.message}})}).catch(t=>{o.value={...o.value,loading:!1},f.value={status:!0,type:"error",text:"Error while updating employee"}})},o=c(),pe=e=>{o.value.title=="Confirm Status Update"?re():o.value.title=="Confirm to Open KPI"&&ve()};return(e,t)=>(d(),v(_e,{class:"pb-16"},{default:l(()=>[n(N,{class:"mt-5 justify-space-between"},{default:l(()=>[i("div",Ie,[n(L,null,{activator:l(({props:s})=>[n(q,K(s,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=u=>_.value=u),loading:k.value,variant:"outlined",density:"compact",class:"bg-white",label:"Search Employee","hide-details":"","append-inner-icon":x(J)}),null,16,["modelValue","loading","append-inner-icon"])]),default:l(()=>[M.value.length>0?(d(),v(w,{key:0,density:"compact",style:{"max-height":"300px"}},{default:l(()=>[(d(!0),b(U,null,O(M.value,(s,u)=>(d(),v(C,{key:u,onClick:()=>de(s)},{default:l(()=>[n($,null,{default:l(()=>[p(m(s.display_name+" - "+s.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(d(),v(w,{key:1,density:"compact"},{default:l(()=>[n(C,null,{default:l(()=>[p(" No results found ")]),_:1})]),_:1}))]),_:1}),Ae]),n(ke),i("div",Me,[n(L,null,{activator:l(({props:s})=>[n(q,K(s,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=u=>y.value=u),loading:k.value,variant:"outlined",density:"compact",class:"bg-white",label:"Secondary Manager","hide-details":"","onClick:clear":t[2]||(t[2]=u=>G(e.item,"clear")),clearable:"","append-inner-icon":x(J)}),null,16,["modelValue","loading","append-inner-icon"])]),default:l(()=>[R.value.length>0?(d(),v(w,{key:0,density:"compact",style:{"max-height":"300px"}},{default:l(()=>[(d(!0),b(U,null,O(R.value,(s,u)=>(d(),v(C,{key:u,onClick:()=>G(s)},{default:l(()=>[n($,null,{default:l(()=>[p(m(s.display_name+" - "+s.ecode),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})):(d(),v(w,{key:1,density:"compact"},{default:l(()=>[n(C,null,{default:l(()=>[p(" No results found ")]),_:1})]),_:1}))]),_:1}),Re]),["hr_admin","app_admin","hrbp"].includes(x(r).authProfile.role)?(d(),b("div",Le,[i("div",null,[n(L,null,{activator:l(({props:s})=>[n(z,K(s,{color:`${E.value=="Active"?"success":"error"}`,width:"120"}),{default:l(()=>[p(m(E.value),1)]),_:2},1040,["color"])]),default:l(()=>[n(w,{density:"compact"},{default:l(()=>[(d(!0),b(U,null,O(ae.value,(s,u)=>(d(),v(C,{key:u,onClick:()=>ce(s)},{default:l(()=>[n($,null,{default:l(()=>[n(be,{size:"16",color:s.color,icon:x(Ce)},null,8,["color","icon"]),p(" "+m(s.title),1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),Ke])):B("",!0)]),_:1}),n(N,null,{default:l(()=>[i("div",Oe,[n(xe,{class:"elevation-0"},{default:l(()=>[n(we,null,{default:l(()=>[n(N,null,{default:l(()=>[i("div",Ue,[n(Ee,{profile:a.value},null,8,["profile"])]),i("div",ze,[Be,i("div",Ne,m(a.value.managed_by&&a.value.managed_by.display_name?a.value.managed_by.display_name:""),1)]),i("div",$e,[Ye,i("div",Fe,m(a.value&&a.value.company?a.value.company.title:""),1)]),i("div",We,[De,i("div",je,m(A.value.year),1)]),i("div",Ge,[He,i("div",Xe,m(ue(a.value))+"/100",1)]),["hr_admin","app_admin","hrbp"].includes(x(r).authProfile.role)?(d(),b("div",Ze,[a.value.status=="Active"&&a.value.reviews&&(a.value.reviews.length>0&&(a.value.reviews[0].status=="closed"||a.value.reviews[0].status=="locked"||a.value.reviews[0].status=="submitted")||a.value.reviews.length==0&&(A.value.status=="closed"||A.value.status=="locked"))?(d(),v(z,{key:0,loading:P.value.loading,onClick:H,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:l(()=>[p("Reopen")]),_:1},8,["loading"])):a.value.status=="Active"&&a.value.reviews.length==0&&a.value.is_regular==0?(d(),v(z,{key:1,loading:P.value.loading,onClick:H,block:"",size:"large",color:"secondary",class:"text-capitalize rounded-lg"},{default:l(()=>[p("Open")]),_:1},8,["loading"])):B("",!0)])):B("",!0)]),_:1})]),_:1})]),_:1})])]),_:1}),n(Se,{"selected-employee":a.value,"measures-list":F.value,"industry-list":T.value,"ecd-list":W.value,onErrorcheck:e.errorCheck,onYearchange:oe,"is-manager":!0},null,8,["selected-employee","measures-list","industry-list","ecd-list","onErrorcheck"]),n(Te,{options:o.value,onConfirm:pe},null,8,["options"]),n(Ve,{options:f.value},null,8,["options"])]),_:1}))}};export{dt as default};
